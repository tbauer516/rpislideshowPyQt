
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Simple Tree Model Example &#8212; Qt for Python (Technology Preview)</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.11.0~a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="search" title="Search" href="../search.html" />
  <link rel="stylesheet" type="text/css" href="/style/pyside.css" />
  <link rel="icon" type="image/png" href="/style/pyside-32px.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/style/pyside-16px.png" sizes="16x16" />
  <script type="text/javascript"> wpThemeFolder = 'http://qt.io/wp-content/themes/oneqt'; </script>
  <script type="text/javascript" src="/scripts/main.js"></script>
  <script type="text/javascript" src="/scripts/extras.js"></script>
  <script type="text/javascript">
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-54043535-2', 'qt.io');
    ga('set', 'forceSSL', true);
    ga('send', 'pageview');
  </script>

  </head>
  <body>
<div id="container">
    <div class="header">
        <div class="header_container">
            <header id="navbar">
            </header>
        </div>
    </div>
    <div class="main">
        <div class="main-rounded">
            <div class="navigationbar">
                <ul class="sub-navigation">
                    <li><a href="http://wiki.qt.io/">Wiki</a></li>
                    <li><a href="https://doc.qt.io/">Documentation</a></li>
                    <li><a href="http://forum.qt.io/">Forum</a></li>
                    <li><a href="https://bugreports.qt.io/">Bug Reports</a></li>
                    <li><a href="https://codereview.qt-project.org/">Code Review</a></li>
                </ul>
                <div id="main_title_bar"><h1>Qt Documentation</h1></div>
                <div class="related">
                    <ul>
                        <li><a href="../index.html">Qt for Python (Technology Preview)</a></li> 
                    </ul>
                </div>
            </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Simple Tree Model Example</a><ul>
<li><a class="reference internal" href="#design-and-concepts">Design and Concepts</a></li>
<li><a class="reference internal" href="#treeitem-class-definition">TreeItem Class Definition</a></li>
<li><a class="reference internal" href="#treeitem-class-implementation">TreeItem Class Implementation</a></li>
<li><a class="reference internal" href="#treemodel-class-definition">TreeModel Class Definition</a></li>
<li><a class="reference internal" href="#treemodel-class-implementation">TreeModel Class Implementation</a></li>
<li><a class="reference internal" href="#setting-up-the-data-in-the-model">Setting Up the Data in the Model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#treeitem-cpp-example-file">treeitem.cpp Example File</a></li>
<li><a class="reference internal" href="#treeitem-h-example-file">treeitem.h Example File</a></li>
<li><a class="reference internal" href="#treemodel-cpp-example-file">treemodel.cpp Example File</a></li>
<li><a class="reference internal" href="#treemodel-h-example-file">treemodel.h Example File</a></li>
<li><a class="reference internal" href="#main-cpp-example-file">main.cpp Example File</a></li>
<li><a class="reference internal" href="#simpletreemodel-pro-example-file">simpletreemodel.pro Example File</a></li>
<li><a class="reference internal" href="#simpletreemodel-qrc-example-file">simpletreemodel.qrc Example File</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" id="q" size="18" />
      <input type="submit" value="Go" id="search_button" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="simple-tree-model-example">
<span id="id1"></span><h1>Simple Tree Model Example<a class="headerlink" href="#simple-tree-model-example" title="Permalink to this headline">¶</a></h1>
<p>Simple Tree Model example shows how to use a hierarchical model with Qt’s standard view classes</p>
<blockquote>
<div><p id="simpletreemodelstructure">The Simple Tree Model example shows how to use a hierarchical model with Qt’s standard view classes.</p>
<p>The Simple Tree Model example shows how to create a basic, read-only hierarchical model to use with Qt’s standard view classes. For a description of simple non-hierarchical list and table models, see the <a class="reference internal" href="model-view-programming.html#model-view-programming"><span class="std std-ref">Model/View Programming</span></a> overview.</p>
<p>Qt’s model/view architecture provides a standard way for views to manipulate information in a data source, using an abstract model of the data to simplify and standardize the way it is accessed. Simple models represent data as a table of items, and allow views to access this data via an <a class="reference internal" href="model-view-programming.html#model-view-programming"><span class="std std-ref">index-based</span></a> system. More generally, models can be used to represent data in the form of a tree structure by allowing each item to act as a parent to a table of child items.</p>
<p>Before attempting to implement a tree model, it is worth considering whether the data is supplied by an external source, or whether it is going to be maintained within the model itself. In this example, we will implement an internal structure to hold data rather than discuss how to package data from an external source.</p>
</div></blockquote>
<div class="section" id="design-and-concepts">
<span id="id2"></span><h2>Design and Concepts<a class="headerlink" href="#design-and-concepts" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The data structure that we use to represent the structure of the data takes the form of a tree built from <code class="docutils literal"><span class="pre">TreeItem</span></code> objects. Each <code class="docutils literal"><span class="pre">TreeItem</span></code> represents an item in a tree view, and contains several columns of data.</p>
<p id="id3">++—————————————————————————————————————————————————————————————————————————————————————————————————————————————–+
||**Simple Tree Model Structure**                                                                                                                                                                                                                                                                                                          |
||                                                                                                                                                                                                                                                                                                                                         |
||    The data is stored internally in the model using <code class="docutils literal"><span class="pre">TreeItem</span></code> objects that are linked together in a pointer-based tree structure. Generally, each <code class="docutils literal"><span class="pre">TreeItem</span></code> has a parent item, and can have a number of child items. However, the root item in the tree structure has no parent item and it is never referenced outside the model.|
||                                                                                                                                                                                                                                                                                                                                         |
||    Each <code class="docutils literal"><span class="pre">TreeItem</span></code> contains information about its place in the tree structure; it can return its parent item and its row number. Having this information readily available makes implementing the model easier.                                                                                                                       |
||                                                                                                                                                                                                                                                                                                                                         |
||    Since each item in a tree view usually contains several columns of data (a title and a summary in this example), it is natural to store this information in each item. For simplicity, we will use a list of <code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QVariant</span></code> objects to store the data for each column in the item.                                 |
++—————————————————————————————————————————————————————————————————————————————————————————————————————————————–+</p>
<p>The use of a pointer-based tree structure means that, when passing a model index to a view, we can record the address of the corresponding item in the index (see <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.createIndex()</span></code> ) and retrieve it later with <code class="xref py py-func docutils literal"><span class="pre">QModelIndex.internalPointer()</span></code> . This makes writing the model easier and ensures that all model indexes that refer to the same item have the same internal data pointer.</p>
<p>With the appropriate data structure in place, we can create a tree model with a minimal amount of extra code to supply model indexes and data to other components.</p>
</div></blockquote>
</div>
<div class="section" id="treeitem-class-definition">
<span id="id4"></span><h2>TreeItem Class Definition<a class="headerlink" href="#treeitem-class-definition" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The <code class="docutils literal"><span class="pre">TreeItem</span></code> class is defined as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TreeItem</span>
<span class="p">{</span>
<span class="n">public</span><span class="p">:</span>
    <span class="n">explicit</span> <span class="n">TreeItem</span><span class="p">(</span><span class="n">const</span> <span class="n">QList</span><span class="o">&lt;</span><span class="n">QVariant</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">TreeItem</span> <span class="o">*</span><span class="n">parentItem</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
    <span class="o">~</span><span class="n">TreeItem</span><span class="p">();</span>

    <span class="n">void</span> <span class="n">appendChild</span><span class="p">(</span><span class="n">TreeItem</span> <span class="o">*</span><span class="n">child</span><span class="p">);</span>

    <span class="n">TreeItem</span> <span class="o">*</span><span class="n">child</span><span class="p">(</span><span class="nb">int</span> <span class="n">row</span><span class="p">);</span>
    <span class="nb">int</span> <span class="n">childCount</span><span class="p">()</span> <span class="n">const</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">columnCount</span><span class="p">()</span> <span class="n">const</span><span class="p">;</span>
    <span class="n">QVariant</span> <span class="n">data</span><span class="p">(</span><span class="nb">int</span> <span class="n">column</span><span class="p">)</span> <span class="n">const</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">row</span><span class="p">()</span> <span class="n">const</span><span class="p">;</span>
    <span class="n">TreeItem</span> <span class="o">*</span><span class="n">parentItem</span><span class="p">();</span>

<span class="n">private</span><span class="p">:</span>
    <span class="n">QList</span><span class="o">&lt;</span><span class="n">TreeItem</span><span class="o">*&gt;</span> <span class="n">m_childItems</span><span class="p">;</span>
    <span class="n">QList</span><span class="o">&lt;</span><span class="n">QVariant</span><span class="o">&gt;</span> <span class="n">m_itemData</span><span class="p">;</span>
    <span class="n">TreeItem</span> <span class="o">*</span><span class="n">m_parentItem</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The class is a basic C++ class. It does not inherit from <a class="reference internal" href="../PySide2/QtCore/QObject.html#PySide2.QtCore.QObject" title="PySide2.QtCore.QObject"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QObject</span></code></a> or provide signals and slots. It is used to hold a list of QVariants, containing column data, and information about its position in the tree structure. The functions provide the following features:</p>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">appendChildItem()</span></code> is used to add data when the model is first constructed and is not used during normal use.</li>
<li>The <code class="docutils literal"><span class="pre">child()</span></code> and <code class="docutils literal"><span class="pre">childCount()</span></code> functions allow the model to obtain information about any child items.</li>
<li>Information about the number of columns associated with the item is provided by <code class="docutils literal"><span class="pre">columnCount()</span></code>, and the data in each column can be obtained with the <a class="reference internal" href="qtdatavisualization-qmlbars-example.html#qt-quick-2-bars-example"><span class="std std-ref">data()</span></a> function.</li>
<li>The <code class="docutils literal"><span class="pre">row()</span></code> and <code class="docutils literal"><span class="pre">parent()</span></code> functions are used to obtain the item’s row number and parent item.</li>
</ul>
<p>The parent item and column data are stored in the <code class="docutils literal"><span class="pre">parentItem</span></code> and <code class="docutils literal"><span class="pre">itemData</span></code> private member variables. The <code class="docutils literal"><span class="pre">childItems</span></code> variable contains a list of pointers to the item’s own child items.</p>
</div></blockquote>
</div>
<div class="section" id="treeitem-class-implementation">
<span id="id5"></span><h2>TreeItem Class Implementation<a class="headerlink" href="#treeitem-class-implementation" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The constructor is only used to record the item’s parent and the data associated with each column.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TreeItem</span><span class="p">::</span><span class="n">TreeItem</span><span class="p">(</span><span class="n">const</span> <span class="n">QList</span><span class="o">&lt;</span><span class="n">QVariant</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">TreeItem</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">m_parentItem</span> <span class="o">=</span> <span class="n">parent</span><span class="p">;</span>
    <span class="n">m_itemData</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A pointer to each of the child items belonging to this item will be stored in the <code class="docutils literal"><span class="pre">childItems</span></code> private member variable. When the class’s destructor is called, it must delete each of these to ensure that their memory is reused:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TreeItem</span><span class="p">::</span><span class="o">~</span><span class="n">TreeItem</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">qDeleteAll</span><span class="p">(</span><span class="n">m_childItems</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Since each of the child items are constructed when the model is initially populated with data, the function to add child items is straightforward:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">TreeItem</span><span class="p">::</span><span class="n">appendChild</span><span class="p">(</span><span class="n">TreeItem</span> <span class="o">*</span><span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">m_childItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Each item is able to return any of its child items when given a suitable row number. For example, in the <a class="reference internal" href="#simple-tree-model-example"><span class="std std-ref">above diagram</span></a> , the item marked with the letter “A” corresponds to the child of the root item with <code class="docutils literal"><span class="pre">row</span> <span class="pre">=</span> <span class="pre">0</span></code> , the “B” item is a child of the “A” item with <code class="docutils literal"><span class="pre">row</span> <span class="pre">=</span> <span class="pre">1</span></code> , and the “C” item is a child of the root item with <code class="docutils literal"><span class="pre">row</span> <span class="pre">=</span> <span class="pre">1</span></code> .</p>
<p>The <code class="docutils literal"><span class="pre">child()</span></code> function returns the child that corresponds to the specified row number in the item’s list of child items:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TreeItem</span> <span class="o">*</span><span class="n">TreeItem</span><span class="p">::</span><span class="n">child</span><span class="p">(</span><span class="nb">int</span> <span class="n">row</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">m_childItems</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">row</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The number of child items held can be found with <code class="docutils literal"><span class="pre">childCount()</span></code> :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">TreeItem</span><span class="p">::</span><span class="n">childCount</span><span class="p">()</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">m_childItems</span><span class="o">.</span><span class="n">count</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">TreeModel</span></code> uses this function to determine the number of rows that exist for a given parent item.</p>
<p>The <code class="docutils literal"><span class="pre">row()</span></code> function reports the item’s location within its parent’s list of items:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">TreeItem</span><span class="p">::</span><span class="n">row</span><span class="p">()</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">m_parentItem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m_parentItem</span><span class="o">-&gt;</span><span class="n">m_childItems</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="n">const_cast</span><span class="o">&lt;</span><span class="n">TreeItem</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">this</span><span class="p">));</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that, although the root item (with no parent item) is automatically assigned a row number of 0, this information is never used by the model.</p>
<p>The number of columns of data in the item is trivially returned by the <code class="docutils literal"><span class="pre">columnCount()</span></code> function.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">TreeItem</span><span class="p">::</span><span class="n">columnCount</span><span class="p">()</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">m_itemData</span><span class="o">.</span><span class="n">count</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Column data is returned by the <code class="docutils literal"><span class="pre">data()</span></code> function, taking advantage of <code class="xref py py-class docutils literal"><span class="pre">QList</span></code> ‘s ability to provide sensible default values if the column number is out of range:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">QVariant</span> <span class="n">TreeItem</span><span class="p">::</span><span class="n">data</span><span class="p">(</span><span class="nb">int</span> <span class="n">column</span><span class="p">)</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">m_itemData</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">column</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The item’s parent is found with <code class="docutils literal"><span class="pre">parent()</span></code> :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TreeItem</span> <span class="o">*</span><span class="n">TreeItem</span><span class="p">::</span><span class="n">parentItem</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">m_parentItem</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that, since the root item in the model will not have a parent, this function will return zero in that case. We need to ensure that the model handles this case correctly when we implement the <code class="docutils literal"><span class="pre">TreeModel::parent()</span></code> function.</p>
</div></blockquote>
</div>
<div class="section" id="treemodel-class-definition">
<span id="id6"></span><h2>TreeModel Class Definition<a class="headerlink" href="#treemodel-class-definition" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The <code class="docutils literal"><span class="pre">TreeModel</span></code> class is defined as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TreeModel</span> <span class="p">:</span> <span class="n">public</span> <span class="n">QAbstractItemModel</span>
<span class="p">{</span>
    <span class="n">Q_OBJECT</span>

<span class="n">public</span><span class="p">:</span>
    <span class="n">explicit</span> <span class="n">TreeModel</span><span class="p">(</span><span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">QObject</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
    <span class="o">~</span><span class="n">TreeModel</span><span class="p">();</span>

    <span class="n">QVariant</span> <span class="n">data</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span> <span class="n">role</span><span class="p">)</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
    <span class="n">Qt</span><span class="p">::</span><span class="n">ItemFlags</span> <span class="n">flags</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">)</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
    <span class="n">QVariant</span> <span class="n">headerData</span><span class="p">(</span><span class="nb">int</span> <span class="n">section</span><span class="p">,</span> <span class="n">Qt</span><span class="p">::</span><span class="n">Orientation</span> <span class="n">orientation</span><span class="p">,</span>
                        <span class="nb">int</span> <span class="n">role</span> <span class="o">=</span> <span class="n">Qt</span><span class="p">::</span><span class="n">DisplayRole</span><span class="p">)</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
    <span class="n">QModelIndex</span> <span class="n">index</span><span class="p">(</span><span class="nb">int</span> <span class="n">row</span><span class="p">,</span> <span class="nb">int</span> <span class="n">column</span><span class="p">,</span>
                      <span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="p">())</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
    <span class="n">QModelIndex</span> <span class="n">parent</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">)</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">rowCount</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="p">())</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">columnCount</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="p">())</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>

<span class="n">private</span><span class="p">:</span>
    <span class="n">void</span> <span class="n">setupModelData</span><span class="p">(</span><span class="n">const</span> <span class="n">QStringList</span> <span class="o">&amp;</span><span class="n">lines</span><span class="p">,</span> <span class="n">TreeItem</span> <span class="o">*</span><span class="n">parent</span><span class="p">);</span>

    <span class="n">TreeItem</span> <span class="o">*</span><span class="n">rootItem</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>This class is similar to most other subclasses of <a class="reference internal" href="../PySide2/QtCore/QAbstractItemModel.html#PySide2.QtCore.QAbstractItemModel" title="PySide2.QtCore.QAbstractItemModel"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QAbstractItemModel</span></code></a> that provide read-only models. Only the form of the constructor and the <code class="docutils literal"><span class="pre">setupModelData()</span></code> function are specific to this model. In addition, we provide a destructor to clean up when the model is destroyed.</p>
</div></blockquote>
</div>
<div class="section" id="treemodel-class-implementation">
<span id="id7"></span><h2>TreeModel Class Implementation<a class="headerlink" href="#treemodel-class-implementation" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>For simplicity, the model does not allow its data to be edited. As a result, the constructor takes an argument containing the data that the model will share with views and delegates:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TreeModel</span><span class="p">::</span><span class="n">TreeModel</span><span class="p">(</span><span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">QObject</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
    <span class="p">:</span> <span class="n">QAbstractItemModel</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">QList</span><span class="o">&lt;</span><span class="n">QVariant</span><span class="o">&gt;</span> <span class="n">rootData</span><span class="p">;</span>
    <span class="n">rootData</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Title&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Summary&quot;</span><span class="p">;</span>
    <span class="n">rootItem</span> <span class="o">=</span> <span class="n">new</span> <span class="n">TreeItem</span><span class="p">(</span><span class="n">rootData</span><span class="p">);</span>
    <span class="n">setupModelData</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">QString</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)),</span> <span class="n">rootItem</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is up to the constructor to create a root item for the model. This item only contains vertical header data for convenience. We also use it to reference the internal data structure that contains the model data, and it is used to represent an imaginary parent of top-level items in the model.</p>
<p>The model’s internal data structure is populated with items by the <code class="docutils literal"><span class="pre">setupModelData()</span></code> function. We will examine this function separately at the end of this document.</p>
<p>The destructor ensures that the root item and all of its descendants are deleted when the model is destroyed:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TreeModel</span><span class="p">::</span><span class="o">~</span><span class="n">TreeModel</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">delete</span> <span class="n">rootItem</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Since we cannot add data to the model after it is constructed and set up, this simplifies the way that the internal tree of items is managed.</p>
<p>Models must implement an <code class="docutils literal"><span class="pre">index()</span></code> function to provide indexes for views and delegates to use when accessing data. Indexes are created for other components when they are referenced by their row and column numbers, and their parent model index. If an invalid model index is specified as the parent, it is up to the model to return an index that corresponds to a top-level item in the model.</p>
<p>When supplied with a model index, we first check whether it is valid. If it is not, we assume that a top-level item is being referred to; otherwise, we obtain the data pointer from the model index with its <code class="xref py py-func docutils literal"><span class="pre">QModelIndex.internalPointer()</span></code> function and use it to reference a <code class="docutils literal"><span class="pre">TreeItem</span></code> object. Note that all the model indexes that we construct will contain a pointer to an existing <code class="docutils literal"><span class="pre">TreeItem</span></code> , so we can guarantee that any valid model indexes that we receive will contain a valid data pointer.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>QModelIndex TreeModel::index(int row, int column, const QModelIndex &amp;parent)
            const
{
    if (!hasIndex(row, column, parent))
        return QModelIndex();

    TreeItem *parentItem;

    if (!parent.isValid())
        parentItem = rootItem;
    else
        parentItem = static_cast&lt;TreeItem*&gt;(parent.internalPointer());

    TreeItem *childItem = parentItem-&gt;child(row);
    if (childItem)
        return createIndex(row, column, childItem);
    else
        return QModelIndex();
}
</pre></div>
</div>
<p>Since the row and column arguments to this function refer to a child item of the corresponding parent item, we obtain the item using the <code class="docutils literal"><span class="pre">TreeItem::child()</span></code> function. The <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.createIndex()</span></code> function is used to create a model index to be returned. We specify the row and column numbers, and a pointer to the item itself. The model index can be used later to obtain the item’s data.</p>
<p>The way that the <code class="docutils literal"><span class="pre">TreeItem</span></code> objects are defined makes writing the <code class="docutils literal"><span class="pre">parent()</span></code> function easy:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>QModelIndex TreeModel::parent(const QModelIndex &amp;index) const
{
    if (!index.isValid())
        return QModelIndex();

    TreeItem *childItem = static_cast&lt;TreeItem*&gt;(index.internalPointer());
    TreeItem *parentItem = childItem-&gt;parentItem();

    if (parentItem == rootItem)
        return QModelIndex();

    return createIndex(parentItem-&gt;row(), 0, parentItem);
}
</pre></div>
</div>
<p>We only need to ensure that we never return a model index corresponding to the root item. To be consistent with the way that the <code class="docutils literal"><span class="pre">index()</span></code> function is implemented, we return an invalid model index for the parent of any top-level items in the model.</p>
<p>When creating a model index to return, we must specify the row and column numbers of the parent item within its own parent. We can easily discover the row number with the <code class="docutils literal"><span class="pre">TreeItem::row()</span></code> function, but we follow a convention of specifying 0 as the column number of the parent. The model index is created with <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.createIndex()</span></code> in the same way as in the <code class="docutils literal"><span class="pre">index()</span></code> function.</p>
<p>The <code class="docutils literal"><span class="pre">rowCount()</span></code> function simply returns the number of child items for the <code class="docutils literal"><span class="pre">TreeItem</span></code> that corresponds to a given model index, or the number of top-level items if an invalid index is specified:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>int TreeModel::rowCount(const QModelIndex &amp;parent) const
{
    TreeItem *parentItem;
    if (parent.column() &gt; 0)
        return 0;

    if (!parent.isValid())
        parentItem = rootItem;
    else
        parentItem = static_cast&lt;TreeItem*&gt;(parent.internalPointer());

    return parentItem-&gt;childCount();
}
</pre></div>
</div>
<p>Since each item manages its own column data, the <code class="docutils literal"><span class="pre">columnCount()</span></code> function has to call the item’s own <code class="docutils literal"><span class="pre">columnCount()</span></code> function to determine how many columns are present for a given model index. As with the <code class="docutils literal"><span class="pre">rowCount()</span></code> function, if an invalid model index is specified, the number of columns returned is determined from the root item:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">TreeModel</span><span class="p">::</span><span class="n">columnCount</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">parent</span><span class="p">)</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">isValid</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="n">TreeItem</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">())</span><span class="o">-&gt;</span><span class="n">columnCount</span><span class="p">();</span>
    <span class="k">else</span>
        <span class="k">return</span> <span class="n">rootItem</span><span class="o">-&gt;</span><span class="n">columnCount</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Data is obtained from the model via <code class="docutils literal"><span class="pre">data()</span></code> . Since the item manages its own columns, we need to use the column number to retrieve the data with the <code class="docutils literal"><span class="pre">TreeItem::data()</span></code> function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>QVariant TreeModel::data(const QModelIndex &amp;index, int role) const
{
    if (!index.isValid())
        return QVariant();

    if (role != Qt::DisplayRole)
        return QVariant();

    TreeItem *item = static_cast&lt;TreeItem*&gt;(index.internalPointer());

    return item-&gt;data(index.column());
}
</pre></div>
</div>
<p>Note that we only support the <code class="xref py py-attr docutils literal"><span class="pre">DisplayRole</span></code> in this implementation, and we also return invalid <code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QVariant</span></code> objects for invalid model indexes.</p>
<p>We use the <code class="docutils literal"><span class="pre">flags()</span></code> function to ensure that views know that the model is read-only:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Qt::ItemFlags TreeModel::flags(const QModelIndex &amp;index) const
{
    if (!index.isValid())
        return 0;

    return QAbstractItemModel::flags(index);
}
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">headerData()</span></code> function returns data that we conveniently stored in the root item:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">QVariant</span> <span class="n">TreeModel</span><span class="p">::</span><span class="n">headerData</span><span class="p">(</span><span class="nb">int</span> <span class="n">section</span><span class="p">,</span> <span class="n">Qt</span><span class="p">::</span><span class="n">Orientation</span> <span class="n">orientation</span><span class="p">,</span>
                               <span class="nb">int</span> <span class="n">role</span><span class="p">)</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">orientation</span> <span class="o">==</span> <span class="n">Qt</span><span class="p">::</span><span class="n">Horizontal</span> <span class="o">&amp;&amp;</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="p">::</span><span class="n">DisplayRole</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rootItem</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">(</span><span class="n">section</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">QVariant</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This information could have been supplied in a different way: either specified in the constructor, or hard coded into the <code class="docutils literal"><span class="pre">headerData()</span></code> function.</p>
</div></blockquote>
</div>
<div class="section" id="setting-up-the-data-in-the-model">
<span id="id8"></span><h2>Setting Up the Data in the Model<a class="headerlink" href="#setting-up-the-data-in-the-model" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>We use the <code class="docutils literal"><span class="pre">setupModelData()</span></code> function to set up the initial data in the model. This function parses a text file, extracting strings of text to use in the model, and creates item objects that record both the data and the overall model structure. Naturally, this function works in a way that is very specific to this model. We provide the following description of its behavior, and refer the reader to the example code itself for more information.</p>
<p>We begin with a text file in the following format:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Getting</span> <span class="n">Started</span>                         <span class="n">How</span> <span class="n">to</span> <span class="n">familiarize</span> <span class="n">yourself</span> <span class="k">with</span> <span class="n">Qt</span> <span class="n">Designer</span>
    <span class="n">Launching</span> <span class="n">Designer</span>                  <span class="n">Running</span> <span class="n">the</span> <span class="n">Qt</span> <span class="n">Designer</span> <span class="n">application</span>
    <span class="n">The</span> <span class="n">User</span> <span class="n">Interface</span>                  <span class="n">How</span> <span class="n">to</span> <span class="n">interact</span> <span class="k">with</span> <span class="n">Qt</span> <span class="n">Designer</span>
    <span class="o">...</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">...</span>
</pre></div>
</div>
<p>We process the text file with the following two rules:</p>
<ul class="simple">
<li>For each pair of strings on each line, create an item (or node) in a tree structure, and place each string in a column of data in the item.</li>
<li>When the first string on a line is indented with respect to the first string on the previous line, make the item a child of the previous item created.</li>
</ul>
<p>To ensure that the model works correctly, it is only necessary to create instances of <code class="docutils literal"><span class="pre">TreeItem</span></code> with the correct data and parent item.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="treeitem-cpp-example-file">
<h1>treeitem.cpp Example File<a class="headerlink" href="#treeitem-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="treeitem-h-example-file">
<h1>treeitem.h Example File<a class="headerlink" href="#treeitem-h-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="treemodel-cpp-example-file">
<h1>treemodel.cpp Example File<a class="headerlink" href="#treemodel-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="treemodel-h-example-file">
<h1>treemodel.h Example File<a class="headerlink" href="#treemodel-h-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="main-cpp-example-file">
<h1>main.cpp Example File<a class="headerlink" href="#main-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="simpletreemodel-pro-example-file">
<h1>simpletreemodel.pro Example File<a class="headerlink" href="#simpletreemodel-pro-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="simpletreemodel-qrc-example-file">
<h1>simpletreemodel.qrc Example File<a class="headerlink" href="#simpletreemodel-qrc-example-file" title="Permalink to this headline">¶</a></h1>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <p>© 2018 The Qt Company Ltd. Documentation contributions included herein are the copyrights of their respective owners. The documentation provided herein is licensed under the terms of the <a href="http://www.gnu.org/license/fdl.html">GNU Free Documentation License version 1.3</a> as published by the Free Software Foundation. Qt and respective logos are trademarks of The Qt Company Ltd. in Finland and/or other countries worldwide. All other trademarks are property of their respective owners.</p>
    </div></div>
    <div id="footer" class="footer">
    </div>
</div>
  </body>
</html>