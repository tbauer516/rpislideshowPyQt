
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Syntax Highlighter Example &#8212; Qt for Python (Technology Preview)</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.11.0~a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="search" title="Search" href="../search.html" />
  <link rel="stylesheet" type="text/css" href="/style/pyside.css" />
  <link rel="icon" type="image/png" href="/style/pyside-32px.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/style/pyside-16px.png" sizes="16x16" />
  <script type="text/javascript"> wpThemeFolder = 'http://qt.io/wp-content/themes/oneqt'; </script>
  <script type="text/javascript" src="/scripts/main.js"></script>
  <script type="text/javascript" src="/scripts/extras.js"></script>
  <script type="text/javascript">
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-54043535-2', 'qt.io');
    ga('set', 'forceSSL', true);
    ga('send', 'pageview');
  </script>

  </head>
  <body>
<div id="container">
    <div class="header">
        <div class="header_container">
            <header id="navbar">
            </header>
        </div>
    </div>
    <div class="main">
        <div class="main-rounded">
            <div class="navigationbar">
                <ul class="sub-navigation">
                    <li><a href="http://wiki.qt.io/">Wiki</a></li>
                    <li><a href="https://doc.qt.io/">Documentation</a></li>
                    <li><a href="http://forum.qt.io/">Forum</a></li>
                    <li><a href="https://bugreports.qt.io/">Bug Reports</a></li>
                    <li><a href="https://codereview.qt-project.org/">Code Review</a></li>
                </ul>
                <div id="main_title_bar"><h1>Qt Documentation</h1></div>
                <div class="related">
                    <ul>
                        <li><a href="../index.html">Qt for Python (Technology Preview)</a></li> 
                    </ul>
                </div>
            </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Syntax Highlighter Example</a><ul>
<li><a class="reference internal" href="#highlighter-class-definition">Highlighter Class Definition</a></li>
<li><a class="reference internal" href="#highlighter-class-implementation">Highlighter Class Implementation</a></li>
<li><a class="reference internal" href="#mainwindow-class-definition">MainWindow Class Definition</a></li>
<li><a class="reference internal" href="#mainwindow-class-implementation">MainWindow Class Implementation</a></li>
<li><a class="reference internal" href="#other-code-editor-features">Other Code Editor Features</a></li>
</ul>
</li>
<li><a class="reference internal" href="#highlighter-cpp-example-file">highlighter.cpp Example File</a></li>
<li><a class="reference internal" href="#highlighter-h-example-file">highlighter.h Example File</a></li>
<li><a class="reference internal" href="#mainwindow-cpp-example-file">mainwindow.cpp Example File</a></li>
<li><a class="reference internal" href="#mainwindow-h-example-file">mainwindow.h Example File</a></li>
<li><a class="reference internal" href="#main-cpp-example-file">main.cpp Example File</a></li>
<li><a class="reference internal" href="#syntaxhighlighter-pro-example-file">syntaxhighlighter.pro Example File</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" id="q" size="18" />
      <input type="submit" value="Go" id="search_button" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="syntax-highlighter-example">
<span id="id1"></span><h1>Syntax Highlighter Example<a class="headerlink" href="#syntax-highlighter-example" title="Permalink to this headline">¶</a></h1>
<p>Syntax Highlighter example shows how to perform simple syntax highlighting</p>
<blockquote>
<div><p>The Syntax Highlighter example shows how to perform simple syntax highlighting.</p>
<p>The Syntax Highlighter example shows how to perform simple syntax highlighting by subclassing the <a class="reference internal" href="../PySide2/QtGui/QSyntaxHighlighter.html#PySide2.QtGui.QSyntaxHighlighter" title="PySide2.QtGui.QSyntaxHighlighter"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QSyntaxHighlighter</span></code></a> class.</p>
<p>The Syntax Highlighter application displays C++ files with custom syntax highlighting.</p>
<p>The example consists of two classes:</p>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">Highlighter</span></code> class defines and applies the highlighting rules.</li>
<li>The <code class="docutils literal"><span class="pre">MainWindow</span></code> widget is the application’s main window.</li>
</ul>
<p>We will first review the <code class="docutils literal"><span class="pre">Highlighter</span></code> class to see how you can customize the <a class="reference internal" href="../PySide2/QtGui/QSyntaxHighlighter.html#PySide2.QtGui.QSyntaxHighlighter" title="PySide2.QtGui.QSyntaxHighlighter"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QSyntaxHighlighter</span></code></a> class to fit your preferences, then we will take a look at the relevant parts of the <code class="docutils literal"><span class="pre">MainWindow</span></code> class to see how you can use your custom highlighter class in an application.</p>
</div></blockquote>
<div class="section" id="highlighter-class-definition">
<span id="id2"></span><h2>Highlighter Class Definition<a class="headerlink" href="#highlighter-class-definition" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Highlighter</span> <span class="p">:</span> <span class="n">public</span> <span class="n">QSyntaxHighlighter</span>
<span class="p">{</span>
    <span class="n">Q_OBJECT</span>

<span class="n">public</span><span class="p">:</span>
    <span class="n">Highlighter</span><span class="p">(</span><span class="n">QTextDocument</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>

<span class="n">protected</span><span class="p">:</span>
    <span class="n">void</span> <span class="n">highlightBlock</span><span class="p">(</span><span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="n">override</span><span class="p">;</span>

<span class="n">private</span><span class="p">:</span>
    <span class="n">struct</span> <span class="n">HighlightingRule</span>
    <span class="p">{</span>
        <span class="n">QRegularExpression</span> <span class="n">pattern</span><span class="p">;</span>
        <span class="n">QTextCharFormat</span> <span class="nb">format</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="n">QVector</span><span class="o">&lt;</span><span class="n">HighlightingRule</span><span class="o">&gt;</span> <span class="n">highlightingRules</span><span class="p">;</span>

    <span class="n">QRegularExpression</span> <span class="n">commentStartExpression</span><span class="p">;</span>
    <span class="n">QRegularExpression</span> <span class="n">commentEndExpression</span><span class="p">;</span>

    <span class="n">QTextCharFormat</span> <span class="n">keywordFormat</span><span class="p">;</span>
    <span class="n">QTextCharFormat</span> <span class="n">classFormat</span><span class="p">;</span>
    <span class="n">QTextCharFormat</span> <span class="n">singleLineCommentFormat</span><span class="p">;</span>
    <span class="n">QTextCharFormat</span> <span class="n">multiLineCommentFormat</span><span class="p">;</span>
    <span class="n">QTextCharFormat</span> <span class="n">quotationFormat</span><span class="p">;</span>
    <span class="n">QTextCharFormat</span> <span class="n">functionFormat</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>To provide your own syntax highlighting, you must subclass <a class="reference internal" href="../PySide2/QtGui/QSyntaxHighlighter.html#PySide2.QtGui.QSyntaxHighlighter" title="PySide2.QtGui.QSyntaxHighlighter"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QSyntaxHighlighter</span></code></a> , reimplement the <code class="xref py py-func docutils literal"><span class="pre">QSyntaxHighlighter.highlightBlock()</span></code> function, and define your own highlighting rules.</p>
<p>We have chosen to store our highlighting rules using a private struct: A rule consists of a <a class="reference internal" href="../PySide2/QtCore/QRegularExpression.html#PySide2.QtCore.QRegularExpression" title="PySide2.QtCore.QRegularExpression"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QRegularExpression</span></code></a> pattern and a <a class="reference internal" href="../PySide2/QtGui/QTextCharFormat.html#PySide2.QtGui.QTextCharFormat" title="PySide2.QtGui.QTextCharFormat"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QTextCharFormat</span></code></a> instance. The various rules are then stored using a <code class="xref py py-class docutils literal"><span class="pre">QVector</span></code> .</p>
<p>The <a class="reference internal" href="../PySide2/QtGui/QTextCharFormat.html#PySide2.QtGui.QTextCharFormat" title="PySide2.QtGui.QTextCharFormat"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QTextCharFormat</span></code></a> class provides formatting information for characters in a <a class="reference internal" href="../PySide2/QtGui/QTextDocument.html#PySide2.QtGui.QTextDocument" title="PySide2.QtGui.QTextDocument"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QTextDocument</span></code></a> specifying the visual properties of the text, as well as information about its role in a hypertext document. In this example, we will only define the font weight and color using the <code class="xref py py-func docutils literal"><span class="pre">QTextCharFormat.setFontWeight()</span></code> and <code class="xref py py-func docutils literal"><span class="pre">QTextCharFormat.setForeground()</span></code> functions.</p>
</div></blockquote>
</div>
<div class="section" id="highlighter-class-implementation">
<span id="id3"></span><h2>Highlighter Class Implementation<a class="headerlink" href="#highlighter-class-implementation" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>When subclassing the <a class="reference internal" href="../PySide2/QtGui/QSyntaxHighlighter.html#PySide2.QtGui.QSyntaxHighlighter" title="PySide2.QtGui.QSyntaxHighlighter"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QSyntaxHighlighter</span></code></a> class you must pass the parent parameter to the base class constructor. The parent is the text document upon which the syntax highlighting will be applied. In this example, we have also chosen to define our highlighting rules in the constructor:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Highlighter</span><span class="p">::</span><span class="n">Highlighter</span><span class="p">(</span><span class="n">QTextDocument</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
    <span class="p">:</span> <span class="n">QSyntaxHighlighter</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">HighlightingRule</span> <span class="n">rule</span><span class="p">;</span>

    <span class="n">keywordFormat</span><span class="o">.</span><span class="n">setForeground</span><span class="p">(</span><span class="n">Qt</span><span class="p">::</span><span class="n">darkBlue</span><span class="p">);</span>
    <span class="n">keywordFormat</span><span class="o">.</span><span class="n">setFontWeight</span><span class="p">(</span><span class="n">QFont</span><span class="p">::</span><span class="n">Bold</span><span class="p">);</span>
    <span class="n">QStringList</span> <span class="n">keywordPatterns</span><span class="p">;</span>
    <span class="n">keywordPatterns</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bchar</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bclass</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bconst</span><span class="se">\\</span><span class="s2">b&quot;</span>
                    <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bdouble</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">benum</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bexplicit</span><span class="se">\\</span><span class="s2">b&quot;</span>
                    <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bfriend</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">binline</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bint</span><span class="se">\\</span><span class="s2">b&quot;</span>
                    <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">blong</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bnamespace</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">boperator</span><span class="se">\\</span><span class="s2">b&quot;</span>
                    <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bprivate</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bprotected</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bpublic</span><span class="se">\\</span><span class="s2">b&quot;</span>
                    <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bshort</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bsignals</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bsigned</span><span class="se">\\</span><span class="s2">b&quot;</span>
                    <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bslots</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bstatic</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bstruct</span><span class="se">\\</span><span class="s2">b&quot;</span>
                    <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">btemplate</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">btypedef</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">btypename</span><span class="se">\\</span><span class="s2">b&quot;</span>
                    <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bunion</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bunsigned</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bvirtual</span><span class="se">\\</span><span class="s2">b&quot;</span>
                    <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bvoid</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bvolatile</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bbool</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">;</span>
    <span class="n">foreach</span> <span class="p">(</span><span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pattern</span><span class="p">,</span> <span class="n">keywordPatterns</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">rule</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">QRegularExpression</span><span class="p">(</span><span class="n">pattern</span><span class="p">);</span>
        <span class="n">rule</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">keywordFormat</span><span class="p">;</span>
        <span class="n">highlightingRules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>First we define a keyword rule which recognizes the most common C++ keywords. We give the <code class="docutils literal"><span class="pre">keywordFormat</span></code> a bold, dark blue font. For each keyword, we assign the keyword and the specified format to a HighlightingRule object and append the object to our list of rules.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">classFormat</span><span class="o">.</span><span class="n">setFontWeight</span><span class="p">(</span><span class="n">QFont</span><span class="p">::</span><span class="n">Bold</span><span class="p">);</span>
<span class="n">classFormat</span><span class="o">.</span><span class="n">setForeground</span><span class="p">(</span><span class="n">Qt</span><span class="p">::</span><span class="n">darkMagenta</span><span class="p">);</span>
<span class="n">rule</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">QRegularExpression</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bQ[A-Za-z]+</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">);</span>
<span class="n">rule</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">classFormat</span><span class="p">;</span>
<span class="n">highlightingRules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">);</span>

<span class="n">quotationFormat</span><span class="o">.</span><span class="n">setForeground</span><span class="p">(</span><span class="n">Qt</span><span class="p">::</span><span class="n">darkGreen</span><span class="p">);</span>
<span class="n">rule</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">QRegularExpression</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">.*</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="n">rule</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">quotationFormat</span><span class="p">;</span>
<span class="n">highlightingRules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">);</span>

<span class="n">functionFormat</span><span class="o">.</span><span class="n">setFontItalic</span><span class="p">(</span><span class="n">true</span><span class="p">);</span>
<span class="n">functionFormat</span><span class="o">.</span><span class="n">setForeground</span><span class="p">(</span><span class="n">Qt</span><span class="p">::</span><span class="n">blue</span><span class="p">);</span>
<span class="n">rule</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">QRegularExpression</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">b[A-Za-z0-9_]+(?=</span><span class="se">\\</span><span class="s2">()&quot;</span><span class="p">);</span>
<span class="n">rule</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">functionFormat</span><span class="p">;</span>
<span class="n">highlightingRules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">);</span>
</pre></div>
</div>
<p>Then we create a format that we will apply to Qt class names. The class names will be rendered with a dark magenta color and a bold style. We specify a string pattern that is actually a regular expression capturing all Qt class names. Then we assign the regular expression and the specified format to a HighlightingRule object and append the object to our list of rules.</p>
<p>We also define highlighting rules for quotations and functions using the same approach: The patterns have the form of regular expressions and are stored in HighlightingRule objects with the associated format.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">singleLineCommentFormat</span><span class="o">.</span><span class="n">setForeground</span><span class="p">(</span><span class="n">Qt</span><span class="p">::</span><span class="n">red</span><span class="p">);</span>
    <span class="n">rule</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">QRegularExpression</span><span class="p">(</span><span class="s2">&quot;//[^</span><span class="se">\n</span><span class="s2">]*&quot;</span><span class="p">);</span>
    <span class="n">rule</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">singleLineCommentFormat</span><span class="p">;</span>
    <span class="n">highlightingRules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">);</span>

    <span class="n">multiLineCommentFormat</span><span class="o">.</span><span class="n">setForeground</span><span class="p">(</span><span class="n">Qt</span><span class="p">::</span><span class="n">red</span><span class="p">);</span>

    <span class="n">commentStartExpression</span> <span class="o">=</span> <span class="n">QRegularExpression</span><span class="p">(</span><span class="s2">&quot;/</span><span class="se">\\</span><span class="s2">*&quot;</span><span class="p">);</span>
    <span class="n">commentEndExpression</span> <span class="o">=</span> <span class="n">QRegularExpression</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">*/&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The C++ language has two variations of comments: The single line comment (<code class="docutils literal"><span class="pre">//</span></code> ) and the multiline comment (<code class="docutils literal"><span class="pre">/*...*</span></code> <code class="docutils literal"><span class="pre">/</span></code> ). The single line comment can easily be defined through a highlighting rule similar to the previous ones. But the multiline comment needs special care due to the design of the <a class="reference internal" href="../PySide2/QtGui/QSyntaxHighlighter.html#PySide2.QtGui.QSyntaxHighlighter" title="PySide2.QtGui.QSyntaxHighlighter"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QSyntaxHighlighter</span></code></a> class.</p>
<p>After a <a class="reference internal" href="../PySide2/QtGui/QSyntaxHighlighter.html#PySide2.QtGui.QSyntaxHighlighter" title="PySide2.QtGui.QSyntaxHighlighter"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QSyntaxHighlighter</span></code></a> object is created, its <code class="xref py py-func docutils literal"><span class="pre">QSyntaxHighlighter.highlightBlock()</span></code> function will be called automatically whenever it is necessary by the rich text engine, highlighting the given text block. The problem appears when a comment spans several text blocks. We will take a closer look at how this problem can be solved when reviewing the implementation of the <code class="docutils literal"><span class="pre">Highlighter::highlightBlock()</span></code> function. At this point we only specify the multiline comment’s color.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">Highlighter</span><span class="p">::</span><span class="n">highlightBlock</span><span class="p">(</span><span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">foreach</span> <span class="p">(</span><span class="n">const</span> <span class="n">HighlightingRule</span> <span class="o">&amp;</span><span class="n">rule</span><span class="p">,</span> <span class="n">highlightingRules</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">QRegularExpressionMatchIterator</span> <span class="n">matchIterator</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">globalMatch</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">matchIterator</span><span class="o">.</span><span class="n">hasNext</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">QRegularExpressionMatch</span> <span class="n">match</span> <span class="o">=</span> <span class="n">matchIterator</span><span class="o">.</span><span class="n">next</span><span class="p">();</span>
            <span class="n">setFormat</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">capturedStart</span><span class="p">(),</span> <span class="n">match</span><span class="o">.</span><span class="n">capturedLength</span><span class="p">(),</span> <span class="n">rule</span><span class="o">.</span><span class="n">format</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>The highlightBlock() function is called automatically whenever it is necessary by the rich text engine, i.e. when there are text blocks that have changed.</p>
<p>First we apply the syntax highlighting rules that we stored in the <code class="docutils literal"><span class="pre">highlightingRules</span></code> vector. For each rule (i.e. for each HighlightingRule object) we search for the pattern in the given text block using the <code class="xref py py-func docutils literal"><span class="pre">QString.indexOf()</span></code> function. When the first occurrence of the pattern is found, we use the <code class="xref py py-func docutils literal"><span class="pre">QRegularExpressionMatch.capturedLength()</span></code> function to determine the string that will be formatted. <code class="xref py py-func docutils literal"><span class="pre">QRegularExpressionMatch.capturedLength()</span></code> returns the length of the last matched string, or 0 if there was no match.</p>
<p>To perform the actual formatting the <a class="reference internal" href="../PySide2/QtGui/QSyntaxHighlighter.html#PySide2.QtGui.QSyntaxHighlighter" title="PySide2.QtGui.QSyntaxHighlighter"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QSyntaxHighlighter</span></code></a> class provides the <code class="xref py py-func docutils literal"><span class="pre">QSyntaxHighlighter.setFormat()</span></code> function. This function operates on the text block that is passed as argument to the <code class="docutils literal"><span class="pre">highlightBlock()</span></code> function. The specified format is applied to the text from the given start position for the given length. The formatting properties set in the given format are merged at display time with the formatting information stored directly in the document. Note that the document itself remains unmodified by the format set through this function.</p>
<p>This process is repeated until the last occurrence of the pattern in the current text block is found.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">setCurrentBlockState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p>To deal with constructs that can span several text blocks (like the C++ multiline comment), it is necessary to know the end state of the previous text block (e.g. “in comment”). Inside your <code class="docutils literal"><span class="pre">highlightBlock()</span></code> implementation you can query the end state of the previous text block using the <code class="xref py py-func docutils literal"><span class="pre">QSyntaxHighlighter.previousBlockState()</span></code> function. After parsing the block you can save the last state using <code class="xref py py-func docutils literal"><span class="pre">QSyntaxHighlighter.setCurrentBlockState()</span></code> .</p>
<p>The <code class="xref py py-func docutils literal"><span class="pre">QSyntaxHighlighter.previousBlockState()</span></code> function return an int value. If no state is set, the returned value is -1. You can designate any other value to identify any given state using the <code class="xref py py-func docutils literal"><span class="pre">QSyntaxHighlighter.setCurrentBlockState()</span></code> function. Once the state is set, the <a class="reference internal" href="../PySide2/QtGui/QTextBlock.html#PySide2.QtGui.QTextBlock" title="PySide2.QtGui.QTextBlock"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QTextBlock</span></code></a> keeps that value until it is set again or until the corresponding paragraph of text is deleted.</p>
<p>In this example we have chosen to use 0 to represent the “not in comment” state, and 1 for the “in comment” state. When the stored syntax highlighting rules are applied we initialize the current block state to 0.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">previousBlockState</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">startIndex</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="n">commentStartExpression</span><span class="p">);</span>
</pre></div>
</div>
<p>If the previous block state was “in comment” (<code class="docutils literal"><span class="pre">previousBlockState()</span> <span class="pre">==</span> <span class="pre">1</span></code> ), we start the search for an end expression at the beginning of the text block. If the previousBlockState() returns 0, we start the search at the location of the first occurrence of a start expression.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="k">while</span> <span class="p">(</span><span class="n">startIndex</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">QRegularExpressionMatch</span> <span class="n">match</span> <span class="o">=</span> <span class="n">commentEndExpression</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">startIndex</span><span class="p">);</span>
        <span class="nb">int</span> <span class="n">endIndex</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">capturedStart</span><span class="p">();</span>
        <span class="nb">int</span> <span class="n">commentLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">endIndex</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">setCurrentBlockState</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
            <span class="n">commentLength</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">-</span> <span class="n">startIndex</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">commentLength</span> <span class="o">=</span> <span class="n">endIndex</span> <span class="o">-</span> <span class="n">startIndex</span>
                            <span class="o">+</span> <span class="n">match</span><span class="o">.</span><span class="n">capturedLength</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="n">setFormat</span><span class="p">(</span><span class="n">startIndex</span><span class="p">,</span> <span class="n">commentLength</span><span class="p">,</span> <span class="n">multiLineCommentFormat</span><span class="p">);</span>
        <span class="n">startIndex</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="n">commentStartExpression</span><span class="p">,</span> <span class="n">startIndex</span> <span class="o">+</span> <span class="n">commentLength</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When an end expression is found, we calculate the length of the comment and apply the multiline comment format. Then we search for the next occurrence of the start expression and repeat the process. If no end expression can be found in the current text block we set the current block state to 1, i.e. “in comment”.</p>
<p>This completes the <code class="docutils literal"><span class="pre">Highlighter</span></code> class implementation; it is now ready for use.</p>
</div></blockquote>
</div>
<div class="section" id="mainwindow-class-definition">
<span id="id4"></span><h2>MainWindow Class Definition<a class="headerlink" href="#mainwindow-class-definition" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Using a <a class="reference internal" href="../PySide2/QtGui/QSyntaxHighlighter.html#PySide2.QtGui.QSyntaxHighlighter" title="PySide2.QtGui.QSyntaxHighlighter"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QSyntaxHighlighter</span></code></a> subclass is simple; just provide your application with an instance of the class and pass it the document upon which you want the highlighting to be applied.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MainWindow</span> <span class="p">:</span> <span class="n">public</span> <span class="n">QMainWindow</span>
<span class="p">{</span>
    <span class="n">Q_OBJECT</span>

<span class="n">public</span><span class="p">:</span>
    <span class="n">MainWindow</span><span class="p">(</span><span class="n">QWidget</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>

<span class="n">public</span> <span class="n">slots</span><span class="p">:</span>
    <span class="n">void</span> <span class="n">about</span><span class="p">();</span>
    <span class="n">void</span> <span class="n">newFile</span><span class="p">();</span>
    <span class="n">void</span> <span class="n">openFile</span><span class="p">(</span><span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">path</span> <span class="o">=</span> <span class="n">QString</span><span class="p">());</span>

<span class="n">private</span><span class="p">:</span>
    <span class="n">void</span> <span class="n">setupEditor</span><span class="p">();</span>
    <span class="n">void</span> <span class="n">setupFileMenu</span><span class="p">();</span>
    <span class="n">void</span> <span class="n">setupHelpMenu</span><span class="p">();</span>

    <span class="n">QTextEdit</span> <span class="o">*</span><span class="n">editor</span><span class="p">;</span>
    <span class="n">Highlighter</span> <span class="o">*</span><span class="n">highlighter</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>In this example we declare a pointer to a <code class="docutils literal"><span class="pre">Highlighter</span></code> instance which we later will initialize in the private <code class="docutils literal"><span class="pre">setupEditor()</span></code> function.</p>
</div></blockquote>
</div>
<div class="section" id="mainwindow-class-implementation">
<span id="id5"></span><h2>MainWindow Class Implementation<a class="headerlink" href="#mainwindow-class-implementation" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The constructor of the main window is straight forward. We first set up the menus, then we initialize the editor and make it the central widget of the application. Finally we set the main window’s title.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MainWindow</span><span class="p">::</span><span class="n">MainWindow</span><span class="p">(</span><span class="n">QWidget</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
    <span class="p">:</span> <span class="n">QMainWindow</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">setupFileMenu</span><span class="p">();</span>
    <span class="n">setupHelpMenu</span><span class="p">();</span>
    <span class="n">setupEditor</span><span class="p">();</span>

    <span class="n">setCentralWidget</span><span class="p">(</span><span class="n">editor</span><span class="p">);</span>
    <span class="n">setWindowTitle</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Syntax Highlighter&quot;</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We initialize and install the <code class="docutils literal"><span class="pre">Highlighter</span></code> object in the private setupEditor() convenience function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">MainWindow</span><span class="p">::</span><span class="n">setupEditor</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">QFont</span> <span class="n">font</span><span class="p">;</span>
    <span class="n">font</span><span class="o">.</span><span class="n">setFamily</span><span class="p">(</span><span class="s2">&quot;Courier&quot;</span><span class="p">);</span>
    <span class="n">font</span><span class="o">.</span><span class="n">setFixedPitch</span><span class="p">(</span><span class="n">true</span><span class="p">);</span>
    <span class="n">font</span><span class="o">.</span><span class="n">setPointSize</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

    <span class="n">editor</span> <span class="o">=</span> <span class="n">new</span> <span class="n">QTextEdit</span><span class="p">;</span>
    <span class="n">editor</span><span class="o">-&gt;</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">);</span>

    <span class="n">highlighter</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Highlighter</span><span class="p">(</span><span class="n">editor</span><span class="o">-&gt;</span><span class="n">document</span><span class="p">());</span>

    <span class="n">QFile</span> <span class="n">file</span><span class="p">(</span><span class="s2">&quot;mainwindow.h&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">QFile</span><span class="p">::</span><span class="n">ReadOnly</span> <span class="o">|</span> <span class="n">QFile</span><span class="p">::</span><span class="n">Text</span><span class="p">))</span>
        <span class="n">editor</span><span class="o">-&gt;</span><span class="n">setPlainText</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">readAll</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>First we create the font we want to use in the editor, then we create the editor itself which is an instance of the <a class="reference internal" href="../PySide2/QtWidgets/QTextEdit.html#PySide2.QtWidgets.QTextEdit" title="PySide2.QtWidgets.QTextEdit"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QTextEdit</span></code></a> class. Before we initialize the editor with the <code class="docutils literal"><span class="pre">MainWindow</span></code> class definition file, we create a <code class="docutils literal"><span class="pre">Highlighter</span></code> instance passing the editor’s document as argument. This is the document that the highlighting will be applied to. Then we are done.</p>
<p>A <a class="reference internal" href="../PySide2/QtGui/QSyntaxHighlighter.html#PySide2.QtGui.QSyntaxHighlighter" title="PySide2.QtGui.QSyntaxHighlighter"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QSyntaxHighlighter</span></code></a> object can only be installed on one document at the time, but you can easily reinstall the highlighter on another document using the <code class="xref py py-func docutils literal"><span class="pre">QSyntaxHighlighter.setDocument()</span></code> function. The <a class="reference internal" href="../PySide2/QtGui/QSyntaxHighlighter.html#PySide2.QtGui.QSyntaxHighlighter" title="PySide2.QtGui.QSyntaxHighlighter"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QSyntaxHighlighter</span></code></a> class also provides the <code class="xref py py-func docutils literal"><span class="pre">QSyntaxHighlighter.document()</span></code> function which returns the currently set document.</p>
</div></blockquote>
</div>
<div class="section" id="other-code-editor-features">
<span id="id6"></span><h2>Other Code Editor Features<a class="headerlink" href="#other-code-editor-features" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>It is possible to implement parenthesis matching with <a class="reference internal" href="../PySide2/QtGui/QSyntaxHighlighter.html#PySide2.QtGui.QSyntaxHighlighter" title="PySide2.QtGui.QSyntaxHighlighter"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QSyntaxHighlighter</span></code></a> . The “Matching Parentheses with <a class="reference internal" href="../PySide2/QtGui/QSyntaxHighlighter.html#PySide2.QtGui.QSyntaxHighlighter" title="PySide2.QtGui.QSyntaxHighlighter"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QSyntaxHighlighter</span></code></a> ” article in Qt Quarterly 31 (<a class="reference external" href="http://doc.qt.io/archives/qq/">http://doc.qt.io/archives/qq/</a>) implements this. We also have the <a class="reference internal" href="qtwidgets-widgets-codeeditor-example.html#code-editor-example"><span class="std std-ref">Code Editor Example</span></a> , which shows how to implement line numbers and how to highlight the current line.</div></blockquote>
</div>
</div>
<div class="section" id="highlighter-cpp-example-file">
<h1>highlighter.cpp Example File<a class="headerlink" href="#highlighter-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="highlighter-h-example-file">
<h1>highlighter.h Example File<a class="headerlink" href="#highlighter-h-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="mainwindow-cpp-example-file">
<h1>mainwindow.cpp Example File<a class="headerlink" href="#mainwindow-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="mainwindow-h-example-file">
<h1>mainwindow.h Example File<a class="headerlink" href="#mainwindow-h-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="main-cpp-example-file">
<h1>main.cpp Example File<a class="headerlink" href="#main-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="syntaxhighlighter-pro-example-file">
<h1>syntaxhighlighter.pro Example File<a class="headerlink" href="#syntaxhighlighter-pro-example-file" title="Permalink to this headline">¶</a></h1>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <p>© 2018 The Qt Company Ltd. Documentation contributions included herein are the copyrights of their respective owners. The documentation provided herein is licensed under the terms of the <a href="http://www.gnu.org/license/fdl.html">GNU Free Documentation License version 1.3</a> as published by the Free Software Foundation. Qt and respective logos are trademarks of The Qt Company Ltd. in Finland and/or other countries worldwide. All other trademarks are property of their respective owners.</p>
    </div></div>
    <div id="footer" class="footer">
    </div>
</div>
  </body>
</html>