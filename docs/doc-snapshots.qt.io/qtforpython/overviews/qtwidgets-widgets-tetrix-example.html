
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Tetrix Example &#8212; Qt for Python (Technology Preview)</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.11.0~a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="search" title="Search" href="../search.html" />
  <link rel="stylesheet" type="text/css" href="/style/pyside.css" />
  <link rel="icon" type="image/png" href="/style/pyside-32px.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/style/pyside-16px.png" sizes="16x16" />
  <script type="text/javascript"> wpThemeFolder = 'http://qt.io/wp-content/themes/oneqt'; </script>
  <script type="text/javascript" src="/scripts/main.js"></script>
  <script type="text/javascript" src="/scripts/extras.js"></script>
  <script type="text/javascript">
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-54043535-2', 'qt.io');
    ga('set', 'forceSSL', true);
    ga('send', 'pageview');
  </script>

  </head>
  <body>
<div id="container">
    <div class="header">
        <div class="header_container">
            <header id="navbar">
            </header>
        </div>
    </div>
    <div class="main">
        <div class="main-rounded">
            <div class="navigationbar">
                <ul class="sub-navigation">
                    <li><a href="http://wiki.qt.io/">Wiki</a></li>
                    <li><a href="https://doc.qt.io/">Documentation</a></li>
                    <li><a href="http://forum.qt.io/">Forum</a></li>
                    <li><a href="https://bugreports.qt.io/">Bug Reports</a></li>
                    <li><a href="https://codereview.qt-project.org/">Code Review</a></li>
                </ul>
                <div id="main_title_bar"><h1>Qt Documentation</h1></div>
                <div class="related">
                    <ul>
                        <li><a href="../index.html">Qt for Python (Technology Preview)</a></li> 
                    </ul>
                </div>
            </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tetrix Example</a><ul>
<li><a class="reference internal" href="#tetrixwindow-class-definition">TetrixWindow Class Definition</a></li>
<li><a class="reference internal" href="#tetrixwindow-class-implementation">TetrixWindow Class Implementation</a></li>
<li><a class="reference internal" href="#tetrixpiece-class-definition">TetrixPiece Class Definition</a></li>
<li><a class="reference internal" href="#tetrixpiece-class-implementation">TetrixPiece Class Implementation</a></li>
<li><a class="reference internal" href="#tetrixboard-class-definition">TetrixBoard Class Definition</a></li>
<li><a class="reference internal" href="#tetrixboard-class-implementation">TetrixBoard Class Implementation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tetrixboard-cpp-example-file">tetrixboard.cpp Example File</a></li>
<li><a class="reference internal" href="#tetrixboard-h-example-file">tetrixboard.h Example File</a></li>
<li><a class="reference internal" href="#tetrixpiece-cpp-example-file">tetrixpiece.cpp Example File</a></li>
<li><a class="reference internal" href="#tetrixpiece-h-example-file">tetrixpiece.h Example File</a></li>
<li><a class="reference internal" href="#tetrixwindow-cpp-example-file">tetrixwindow.cpp Example File</a></li>
<li><a class="reference internal" href="#tetrixwindow-h-example-file">tetrixwindow.h Example File</a></li>
<li><a class="reference internal" href="#main-cpp-example-file">main.cpp Example File</a></li>
<li><a class="reference internal" href="#tetrix-pro-example-file">tetrix.pro Example File</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" id="q" size="18" />
      <input type="submit" value="Go" id="search_button" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tetrix-example">
<span id="id1"></span><h1>Tetrix Example<a class="headerlink" href="#tetrix-example" title="Permalink to this headline">¶</a></h1>
<p>Tetrix example is a Qt version of the classic Tetrix game</p>
<blockquote>
<div><p>The Tetrix example is a Qt version of the classic Tetrix game.</p>
<p>The object of the game is to stack pieces dropped from the top of the playing area so that they fill entire rows at the bottom of the playing area.</p>
<p>When a row is filled, all the blocks on that row are removed, the player earns a number of points, and the pieces above are moved down to occupy that row. If more than one row is filled, the blocks on each row are removed, and the player earns extra points.</p>
<p>The Left cursor key moves the current piece one space to the left, the Right cursor key moves it one space to the right, the Up cursor key rotates the piece counter-clockwise by 90 degrees, and the Down cursor key rotates the piece clockwise by 90 degrees.</p>
<p>To avoid waiting for a piece to fall to the bottom of the board, press D to immediately move the piece down by one row, or press the Space key to drop it as close to the bottom of the board as possible.</p>
<p>This example shows how a simple game can be created using only three classes:</p>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">TetrixWindow</span></code> class is used to display the player’s score, number of lives, and information about the next piece to appear.</li>
<li>The <code class="docutils literal"><span class="pre">TetrixBoard</span></code> class contains the game logic, handles keyboard input, and displays the pieces on the playing area.</li>
<li>The <code class="docutils literal"><span class="pre">TetrixPiece</span></code> class contains information about each piece.</li>
</ul>
<p>In this approach, the <code class="docutils literal"><span class="pre">TetrixBoard</span></code> class is the most complex class, since it handles the game logic and rendering. One benefit of this is that the <code class="docutils literal"><span class="pre">TetrixWindow</span></code> and <code class="docutils literal"><span class="pre">TetrixPiece</span></code> classes are very simple and contain only a minimum of code.</p>
</div></blockquote>
<div class="section" id="tetrixwindow-class-definition">
<span id="id2"></span><h2>TetrixWindow Class Definition<a class="headerlink" href="#tetrixwindow-class-definition" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The <code class="docutils literal"><span class="pre">TetrixWindow</span></code> class is used to display the game information and contains the playing area:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TetrixWindow</span> <span class="p">:</span> <span class="n">public</span> <span class="n">QWidget</span>
<span class="p">{</span>
    <span class="n">Q_OBJECT</span>

<span class="n">public</span><span class="p">:</span>
    <span class="n">TetrixWindow</span><span class="p">();</span>

<span class="n">private</span><span class="p">:</span>
    <span class="n">QLabel</span> <span class="o">*</span><span class="n">createLabel</span><span class="p">(</span><span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">);</span>

    <span class="n">TetrixBoard</span> <span class="o">*</span><span class="n">board</span><span class="p">;</span>
    <span class="n">QLabel</span> <span class="o">*</span><span class="n">nextPieceLabel</span><span class="p">;</span>
    <span class="n">QLCDNumber</span> <span class="o">*</span><span class="n">scoreLcd</span><span class="p">;</span>
    <span class="n">QLCDNumber</span> <span class="o">*</span><span class="n">levelLcd</span><span class="p">;</span>
    <span class="n">QLCDNumber</span> <span class="o">*</span><span class="n">linesLcd</span><span class="p">;</span>
    <span class="n">QPushButton</span> <span class="o">*</span><span class="n">startButton</span><span class="p">;</span>
    <span class="n">QPushButton</span> <span class="o">*</span><span class="n">quitButton</span><span class="p">;</span>
    <span class="n">QPushButton</span> <span class="o">*</span><span class="n">pauseButton</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>We use private member variables for the board, various display widgets, and buttons to allow the user to start a new game, pause the current game, and quit.</p>
<p>Although the window inherits <a class="reference internal" href="../PySide2/QtWidgets/QWidget.html#PySide2.QtWidgets.QWidget" title="PySide2.QtWidgets.QWidget"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QWidget</span></code></a> , the constructor does not provide an argument to allow a parent widget to be specified. This is because the window will always be used as a top-level widget.</p>
</div></blockquote>
</div>
<div class="section" id="tetrixwindow-class-implementation">
<span id="id3"></span><h2>TetrixWindow Class Implementation<a class="headerlink" href="#tetrixwindow-class-implementation" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The constructor sets up the user interface elements for the game:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TetrixWindow</span><span class="p">::</span><span class="n">TetrixWindow</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">board</span> <span class="o">=</span> <span class="n">new</span> <span class="n">TetrixBoard</span><span class="p">;</span>
</pre></div>
</div>
<p>We begin by constructing a <code class="docutils literal"><span class="pre">TetrixBoard</span></code> instance for the playing area and a label that shows the next piece to be dropped into the playing area; the label is initially empty.</p>
<p>Three <a class="reference internal" href="../PySide2/QtWidgets/QLCDNumber.html#PySide2.QtWidgets.QLCDNumber" title="PySide2.QtWidgets.QLCDNumber"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QLCDNumber</span></code></a> objects are used to display the score, number of lives, and lines removed. These initially show default values, and will be filled in when a game begins:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">scoreLcd</span> <span class="o">=</span> <span class="n">new</span> <span class="n">QLCDNumber</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="n">scoreLcd</span><span class="o">-&gt;</span><span class="n">setSegmentStyle</span><span class="p">(</span><span class="n">QLCDNumber</span><span class="p">::</span><span class="n">Filled</span><span class="p">);</span>
</pre></div>
</div>
<p>Three buttons with shortcuts are constructed so that the user can start a new game, pause the current game, and quit the application:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">startButton</span> <span class="o">=</span> <span class="n">new</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;&amp;Start&quot;</span><span class="p">));</span>
<span class="n">startButton</span><span class="o">-&gt;</span><span class="n">setFocusPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="p">::</span><span class="n">NoFocus</span><span class="p">);</span>
<span class="n">quitButton</span> <span class="o">=</span> <span class="n">new</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;&amp;Quit&quot;</span><span class="p">));</span>
<span class="n">quitButton</span><span class="o">-&gt;</span><span class="n">setFocusPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="p">::</span><span class="n">NoFocus</span><span class="p">);</span>
<span class="n">pauseButton</span> <span class="o">=</span> <span class="n">new</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;&amp;Pause&quot;</span><span class="p">));</span>
<span class="n">pauseButton</span><span class="o">-&gt;</span><span class="n">setFocusPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="p">::</span><span class="n">NoFocus</span><span class="p">);</span>
</pre></div>
</div>
<p>These buttons are configured so that they never receive the keyboard focus; we want the keyboard focus to remain with the <code class="docutils literal"><span class="pre">TetrixBoard</span></code> instance so that it receives all the keyboard events. Nonetheless, the buttons will still respond to Alt key shortcuts.</p>
<p>We connect <code class="xref py py-func docutils literal"><span class="pre">QAbstractButton.clicked()</span></code> signals from the Start and Pause buttons to the board, and from the Quit button to the application’s <code class="xref py py-func docutils literal"><span class="pre">QCoreApplication.quit()</span></code> slot.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">connect</span><span class="p">(</span><span class="n">startButton</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="n">clicked</span><span class="p">()),</span> <span class="n">board</span><span class="p">,</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">start</span><span class="p">()));</span>
<span class="n">connect</span><span class="p">(</span><span class="n">quitButton</span> <span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="n">clicked</span><span class="p">()),</span> <span class="n">qApp</span><span class="p">,</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">quit</span><span class="p">()));</span>
<span class="n">connect</span><span class="p">(</span><span class="n">pauseButton</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="n">clicked</span><span class="p">()),</span> <span class="n">board</span><span class="p">,</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">pause</span><span class="p">()));</span>
<span class="n">connect</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="n">scoreChanged</span><span class="p">(</span><span class="nb">int</span><span class="p">)),</span> <span class="n">scoreLcd</span><span class="p">,</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">display</span><span class="p">(</span><span class="nb">int</span><span class="p">)));</span>
<span class="n">connect</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="n">levelChanged</span><span class="p">(</span><span class="nb">int</span><span class="p">)),</span> <span class="n">levelLcd</span><span class="p">,</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">display</span><span class="p">(</span><span class="nb">int</span><span class="p">)));</span>
<span class="n">connect</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="n">linesRemovedChanged</span><span class="p">(</span><span class="nb">int</span><span class="p">)),</span>
        <span class="n">linesLcd</span><span class="p">,</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">display</span><span class="p">(</span><span class="nb">int</span><span class="p">)));</span>
</pre></div>
</div>
<p>Signals from the board are also connected to the LCD widgets for the purpose of updating the score, number of lives, and lines removed from the playing area.</p>
<p>We place the label, LCD widgets, and the board into a <a class="reference internal" href="../PySide2/QtWidgets/QGridLayout.html#PySide2.QtWidgets.QGridLayout" title="PySide2.QtWidgets.QGridLayout"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QGridLayout</span></code></a> along with some labels that we create with the <code class="docutils literal"><span class="pre">createLabel()</span></code> convenience function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">QGridLayout</span> <span class="o">*</span><span class="n">layout</span> <span class="o">=</span> <span class="n">new</span> <span class="n">QGridLayout</span><span class="p">;</span>
    <span class="n">layout</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">createLabel</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;NEXT&quot;</span><span class="p">)),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">layout</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">nextPieceLabel</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">layout</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">createLabel</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;LEVEL&quot;</span><span class="p">)),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">layout</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">levelLcd</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">layout</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">startButton</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">layout</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">layout</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">createLabel</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;SCORE&quot;</span><span class="p">)),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">layout</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">scoreLcd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">layout</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">createLabel</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;LINES REMOVED&quot;</span><span class="p">)),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">layout</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">linesLcd</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">layout</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">quitButton</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">layout</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pauseButton</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">);</span>

    <span class="n">setWindowTitle</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Tetrix&quot;</span><span class="p">));</span>
    <span class="n">resize</span><span class="p">(</span><span class="mi">550</span><span class="p">,</span> <span class="mi">370</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Finally, we set the grid layout on the widget, give the window a title, and resize it to an appropriate size.</p>
<p>The <code class="docutils literal"><span class="pre">createLabel()</span></code> convenience function simply creates a new label on the heap, gives it an appropriate alignment, and returns it to the caller:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">QLabel</span> <span class="o">*</span><span class="n">TetrixWindow</span><span class="p">::</span><span class="n">createLabel</span><span class="p">(</span><span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">QLabel</span> <span class="o">*</span><span class="n">lbl</span> <span class="o">=</span> <span class="n">new</span> <span class="n">QLabel</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
    <span class="n">lbl</span><span class="o">-&gt;</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="p">::</span><span class="n">AlignHCenter</span> <span class="o">|</span> <span class="n">Qt</span><span class="p">::</span><span class="n">AlignBottom</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">lbl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Since each label will be used in the widget’s layout, it will become a child of the <code class="docutils literal"><span class="pre">TetrixWindow</span></code> widget and, as a result, it will be deleted when the window is deleted.</p>
</div></blockquote>
</div>
<div class="section" id="tetrixpiece-class-definition">
<span id="id4"></span><h2>TetrixPiece Class Definition<a class="headerlink" href="#tetrixpiece-class-definition" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The <code class="docutils literal"><span class="pre">TetrixPiece</span></code> class holds information about a piece in the game’s playing area, including its shape, position, and the range of positions it can occupy on the board:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TetrixPiece</span>
<span class="p">{</span>
<span class="n">public</span><span class="p">:</span>
    <span class="n">TetrixPiece</span><span class="p">()</span> <span class="p">{</span> <span class="n">setShape</span><span class="p">(</span><span class="n">NoShape</span><span class="p">);</span> <span class="p">}</span>

    <span class="n">void</span> <span class="n">setRandomShape</span><span class="p">();</span>
    <span class="n">void</span> <span class="n">setShape</span><span class="p">(</span><span class="n">TetrixShape</span> <span class="n">shape</span><span class="p">);</span>

    <span class="n">TetrixShape</span> <span class="n">shape</span><span class="p">()</span> <span class="n">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">pieceShape</span><span class="p">;</span> <span class="p">}</span>
    <span class="nb">int</span> <span class="n">x</span><span class="p">(</span><span class="nb">int</span> <span class="n">index</span><span class="p">)</span> <span class="n">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">coords</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span> <span class="p">}</span>
    <span class="nb">int</span> <span class="n">y</span><span class="p">(</span><span class="nb">int</span> <span class="n">index</span><span class="p">)</span> <span class="n">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">coords</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span> <span class="p">}</span>
    <span class="nb">int</span> <span class="n">minX</span><span class="p">()</span> <span class="n">const</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">maxX</span><span class="p">()</span> <span class="n">const</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">minY</span><span class="p">()</span> <span class="n">const</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">maxY</span><span class="p">()</span> <span class="n">const</span><span class="p">;</span>
    <span class="n">TetrixPiece</span> <span class="n">rotatedLeft</span><span class="p">()</span> <span class="n">const</span><span class="p">;</span>
    <span class="n">TetrixPiece</span> <span class="n">rotatedRight</span><span class="p">()</span> <span class="n">const</span><span class="p">;</span>

<span class="n">private</span><span class="p">:</span>
    <span class="n">void</span> <span class="n">setX</span><span class="p">(</span><span class="nb">int</span> <span class="n">index</span><span class="p">,</span> <span class="nb">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">coords</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span> <span class="p">}</span>
    <span class="n">void</span> <span class="n">setY</span><span class="p">(</span><span class="nb">int</span> <span class="n">index</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="n">coords</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>

    <span class="n">TetrixShape</span> <span class="n">pieceShape</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">coords</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Each shape contains four blocks, and these are defined by the <code class="docutils literal"><span class="pre">coords</span></code> private member variable. Additionally, each piece has a high-level description that is stored internally in the <code class="docutils literal"><span class="pre">pieceShape</span></code> variable.</p>
<p>The constructor is written inline in the definition, and simply ensures that each piece is initially created with no shape. The <code class="docutils literal"><span class="pre">shape()</span></code> function simply returns the contents of the <code class="docutils literal"><span class="pre">pieceShape</span></code> variable, and the <code class="docutils literal"><span class="pre">x()</span></code> and <code class="docutils literal"><span class="pre">y()</span></code> functions return the x and y-coordinates of any given block in the shape.</p>
</div></blockquote>
</div>
<div class="section" id="tetrixpiece-class-implementation">
<span id="id5"></span><h2>TetrixPiece Class Implementation<a class="headerlink" href="#tetrixpiece-class-implementation" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The <code class="docutils literal"><span class="pre">setRandomShape()</span></code> function is used to select a random shape for a piece:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">TetrixPiece</span><span class="p">::</span><span class="n">setRandomShape</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">setShape</span><span class="p">(</span><span class="n">TetrixShape</span><span class="p">(</span><span class="n">QRandomGenerator</span><span class="p">::</span><span class="k">global</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">bounded</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For convenience, it simply chooses a random shape from the <code class="docutils literal"><span class="pre">TetrixShape</span></code> enum and calls the <code class="docutils literal"><span class="pre">setShape()</span></code> function to perform the task of positioning the blocks.</p>
<p>The <code class="docutils literal"><span class="pre">setShape()</span></code> function uses a look-up table of pieces to associate each shape with an array of block positions:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">TetrixPiece</span><span class="p">::</span><span class="n">setShape</span><span class="p">(</span><span class="n">TetrixShape</span> <span class="n">shape</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">static</span> <span class="n">const</span> <span class="nb">int</span> <span class="n">coordsTable</span><span class="p">[</span><span class="mi">8</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>   <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>   <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>   <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">}</span> <span class="p">},</span>
        <span class="p">{</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">},</span>  <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>   <span class="p">{</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>  <span class="p">{</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">},</span>
        <span class="p">{</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">},</span>  <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>   <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>   <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">},</span>
        <span class="p">{</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">},</span>  <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>   <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">},</span>   <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="p">}</span> <span class="p">},</span>
        <span class="p">{</span> <span class="p">{</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>  <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>   <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>   <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">},</span>
        <span class="p">{</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>   <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>   <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">},</span>   <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">},</span>
        <span class="p">{</span> <span class="p">{</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">},</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">},</span>  <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>   <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">},</span>
        <span class="p">{</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">},</span>  <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">},</span>  <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>   <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
            <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">coordsTable</span><span class="p">[</span><span class="n">shape</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="n">pieceShape</span> <span class="o">=</span> <span class="n">shape</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These positions are read from the table into the piece’s own array of positions, and the piece’s internal shape information is updated to use the new shape.</p>
<p>The <code class="docutils literal"><span class="pre">x()</span></code> and <code class="docutils literal"><span class="pre">y()</span></code> functions are implemented inline in the class definition, returning positions defined on a grid that extends horizontally and vertically with coordinates from -2 to 2. Although the predefined coordinates for each piece only vary horizontally from -1 to 1 and vertically from -1 to 2, each piece can be rotated by 90, 180, and 270 degrees.</p>
<p>The <code class="docutils literal"><span class="pre">minX()</span></code> and <code class="docutils literal"><span class="pre">maxX()</span></code> functions return the minimum and maximum horizontal coordinates occupied by the blocks that make up the piece:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">TetrixPiece</span><span class="p">::</span><span class="n">minX</span><span class="p">()</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="nb">int</span> <span class="nb">min</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="nb">min</span> <span class="o">=</span> <span class="n">qMin</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">int</span> <span class="n">TetrixPiece</span><span class="p">::</span><span class="n">maxX</span><span class="p">()</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="nb">int</span> <span class="nb">max</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="nb">max</span> <span class="o">=</span> <span class="n">qMax</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Similarly, the <code class="docutils literal"><span class="pre">minY()</span></code> and <code class="docutils literal"><span class="pre">maxY()</span></code> functions return the minimum and maximum vertical coordinates occupied by the blocks:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">TetrixPiece</span><span class="p">::</span><span class="n">minY</span><span class="p">()</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="nb">int</span> <span class="nb">min</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="nb">min</span> <span class="o">=</span> <span class="n">qMin</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">int</span> <span class="n">TetrixPiece</span><span class="p">::</span><span class="n">maxY</span><span class="p">()</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="nb">int</span> <span class="nb">max</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="nb">max</span> <span class="o">=</span> <span class="n">qMax</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">rotatedLeft()</span></code> function returns a new piece with the same shape as an existing piece, but rotated counter-clockwise by 90 degrees:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TetrixPiece</span> <span class="n">TetrixPiece</span><span class="p">::</span><span class="n">rotatedLeft</span><span class="p">()</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pieceShape</span> <span class="o">==</span> <span class="n">SquareShape</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">*</span><span class="n">this</span><span class="p">;</span>

    <span class="n">TetrixPiece</span> <span class="n">result</span><span class="p">;</span>
    <span class="n">result</span><span class="o">.</span><span class="n">pieceShape</span> <span class="o">=</span> <span class="n">pieceShape</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">result</span><span class="o">.</span><span class="n">setX</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
        <span class="n">result</span><span class="o">.</span><span class="n">setY</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>Similarly, the <code class="docutils literal"><span class="pre">rotatedRight()</span></code> function returns a new piece with the same shape as an existing piece, but rotated clockwise by 90 degrees:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TetrixPiece</span> <span class="n">TetrixPiece</span><span class="p">::</span><span class="n">rotatedRight</span><span class="p">()</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pieceShape</span> <span class="o">==</span> <span class="n">SquareShape</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">*</span><span class="n">this</span><span class="p">;</span>

    <span class="n">TetrixPiece</span> <span class="n">result</span><span class="p">;</span>
    <span class="n">result</span><span class="o">.</span><span class="n">pieceShape</span> <span class="o">=</span> <span class="n">pieceShape</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">result</span><span class="o">.</span><span class="n">setX</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
        <span class="n">result</span><span class="o">.</span><span class="n">setY</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>These last two functions enable each piece to create rotated copies of itself.</p>
</div></blockquote>
</div>
<div class="section" id="tetrixboard-class-definition">
<span id="id6"></span><h2>TetrixBoard Class Definition<a class="headerlink" href="#tetrixboard-class-definition" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The <code class="docutils literal"><span class="pre">TetrixBoard</span></code> class inherits from <a class="reference internal" href="../PySide2/QtWidgets/QFrame.html#PySide2.QtWidgets.QFrame" title="PySide2.QtWidgets.QFrame"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QFrame</span></code></a> and contains the game logic and display features:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TetrixBoard</span> <span class="p">:</span> <span class="n">public</span> <span class="n">QFrame</span>
<span class="p">{</span>
    <span class="n">Q_OBJECT</span>

<span class="n">public</span><span class="p">:</span>
    <span class="n">TetrixBoard</span><span class="p">(</span><span class="n">QWidget</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>

    <span class="n">void</span> <span class="n">setNextPieceLabel</span><span class="p">(</span><span class="n">QLabel</span> <span class="o">*</span><span class="n">label</span><span class="p">);</span>
    <span class="n">QSize</span> <span class="n">sizeHint</span><span class="p">()</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
    <span class="n">QSize</span> <span class="n">minimumSizeHint</span><span class="p">()</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>

<span class="n">public</span> <span class="n">slots</span><span class="p">:</span>
    <span class="n">void</span> <span class="n">start</span><span class="p">();</span>
    <span class="n">void</span> <span class="n">pause</span><span class="p">();</span>

<span class="n">signals</span><span class="p">:</span>
    <span class="n">void</span> <span class="n">scoreChanged</span><span class="p">(</span><span class="nb">int</span> <span class="n">score</span><span class="p">);</span>
    <span class="n">void</span> <span class="n">levelChanged</span><span class="p">(</span><span class="nb">int</span> <span class="n">level</span><span class="p">);</span>
    <span class="n">void</span> <span class="n">linesRemovedChanged</span><span class="p">(</span><span class="nb">int</span> <span class="n">numLines</span><span class="p">);</span>

<span class="n">protected</span><span class="p">:</span>
    <span class="n">void</span> <span class="n">paintEvent</span><span class="p">(</span><span class="n">QPaintEvent</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span> <span class="n">override</span><span class="p">;</span>
    <span class="n">void</span> <span class="n">keyPressEvent</span><span class="p">(</span><span class="n">QKeyEvent</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span> <span class="n">override</span><span class="p">;</span>
    <span class="n">void</span> <span class="n">timerEvent</span><span class="p">(</span><span class="n">QTimerEvent</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span> <span class="n">override</span><span class="p">;</span>
</pre></div>
</div>
<p>Apart from the <code class="docutils literal"><span class="pre">setNextPieceLabel()</span></code> function and the <code class="docutils literal"><span class="pre">start()</span></code> and <code class="docutils literal"><span class="pre">pause()</span></code> public slots, we only provide public functions to reimplement <code class="xref py py-func docutils literal"><span class="pre">QWidget.sizeHint()</span></code> and <code class="xref py py-func docutils literal"><span class="pre">QWidget.minimumSizeHint()</span></code> . The signals are used to communicate changes to the player’s information to the <code class="docutils literal"><span class="pre">TetrixWindow</span></code> instance.</p>
<p>The rest of the functionality is provided by reimplementations of protected event handlers and private functions:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">private</span><span class="p">:</span>
    <span class="n">enum</span> <span class="p">{</span> <span class="n">BoardWidth</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">BoardHeight</span> <span class="o">=</span> <span class="mi">22</span> <span class="p">};</span>

    <span class="n">TetrixShape</span> <span class="o">&amp;</span><span class="n">shapeAt</span><span class="p">(</span><span class="nb">int</span> <span class="n">x</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">board</span><span class="p">[(</span><span class="n">y</span> <span class="o">*</span> <span class="n">BoardWidth</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">];</span> <span class="p">}</span>
    <span class="nb">int</span> <span class="n">timeoutTime</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">1000</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">level</span><span class="p">);</span> <span class="p">}</span>
    <span class="nb">int</span> <span class="n">squareWidth</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">contentsRect</span><span class="p">()</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">/</span> <span class="n">BoardWidth</span><span class="p">;</span> <span class="p">}</span>
    <span class="nb">int</span> <span class="n">squareHeight</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">contentsRect</span><span class="p">()</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">/</span> <span class="n">BoardHeight</span><span class="p">;</span> <span class="p">}</span>
    <span class="n">void</span> <span class="n">clearBoard</span><span class="p">();</span>
    <span class="n">void</span> <span class="n">dropDown</span><span class="p">();</span>
    <span class="n">void</span> <span class="n">oneLineDown</span><span class="p">();</span>
    <span class="n">void</span> <span class="n">pieceDropped</span><span class="p">(</span><span class="nb">int</span> <span class="n">dropHeight</span><span class="p">);</span>
    <span class="n">void</span> <span class="n">removeFullLines</span><span class="p">();</span>
    <span class="n">void</span> <span class="n">newPiece</span><span class="p">();</span>
    <span class="n">void</span> <span class="n">showNextPiece</span><span class="p">();</span>
    <span class="nb">bool</span> <span class="n">tryMove</span><span class="p">(</span><span class="n">const</span> <span class="n">TetrixPiece</span> <span class="o">&amp;</span><span class="n">newPiece</span><span class="p">,</span> <span class="nb">int</span> <span class="n">newX</span><span class="p">,</span> <span class="nb">int</span> <span class="n">newY</span><span class="p">);</span>
    <span class="n">void</span> <span class="n">drawSquare</span><span class="p">(</span><span class="n">QPainter</span> <span class="o">&amp;</span><span class="n">painter</span><span class="p">,</span> <span class="nb">int</span> <span class="n">x</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y</span><span class="p">,</span> <span class="n">TetrixShape</span> <span class="n">shape</span><span class="p">);</span>

    <span class="n">QBasicTimer</span> <span class="n">timer</span><span class="p">;</span>
    <span class="n">QPointer</span><span class="o">&lt;</span><span class="n">QLabel</span><span class="o">&gt;</span> <span class="n">nextPieceLabel</span><span class="p">;</span>
    <span class="nb">bool</span> <span class="n">isStarted</span><span class="p">;</span>
    <span class="nb">bool</span> <span class="n">isPaused</span><span class="p">;</span>
    <span class="nb">bool</span> <span class="n">isWaitingAfterLine</span><span class="p">;</span>
    <span class="n">TetrixPiece</span> <span class="n">curPiece</span><span class="p">;</span>
    <span class="n">TetrixPiece</span> <span class="n">nextPiece</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">curX</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">curY</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">numLinesRemoved</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">numPiecesDropped</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">score</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">level</span><span class="p">;</span>
    <span class="n">TetrixShape</span> <span class="n">board</span><span class="p">[</span><span class="n">BoardWidth</span> <span class="o">*</span> <span class="n">BoardHeight</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The board is composed of a fixed-size array whose elements correspond to spaces for individual blocks. Each element in the array contains a <code class="docutils literal"><span class="pre">TetrixShape</span></code> value corresponding to the type of shape that occupies that element.</p>
<p>Each shape on the board will occupy four elements in the array, and these will all contain the enum value that corresponds to the type of the shape.</p>
<p>We use a <a class="reference internal" href="../PySide2/QtCore/QBasicTimer.html#PySide2.QtCore.QBasicTimer" title="PySide2.QtCore.QBasicTimer"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QBasicTimer</span></code></a> to control the rate at which pieces fall toward the bottom of the playing area. This allows us to provide an implementation of <code class="xref py py-func docutils literal"><span class="pre">QObject.timerEvent()</span></code> that we can use to update the widget.</p>
</div></blockquote>
</div>
<div class="section" id="tetrixboard-class-implementation">
<span id="id7"></span><h2>TetrixBoard Class Implementation<a class="headerlink" href="#tetrixboard-class-implementation" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>In the constructor, we customize the frame style of the widget, ensure that keyboard input will be received by the widget by using <code class="xref py py-attr docutils literal"><span class="pre">Qt.StrongFocus</span></code> for the focus policy, and initialize the game state:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TetrixBoard</span><span class="p">::</span><span class="n">TetrixBoard</span><span class="p">(</span><span class="n">QWidget</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
    <span class="p">:</span> <span class="n">QFrame</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">setFrameStyle</span><span class="p">(</span><span class="n">QFrame</span><span class="p">::</span><span class="n">Panel</span> <span class="o">|</span> <span class="n">QFrame</span><span class="p">::</span><span class="n">Sunken</span><span class="p">);</span>
    <span class="n">setFocusPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="p">::</span><span class="n">StrongFocus</span><span class="p">);</span>
    <span class="n">isStarted</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>
    <span class="n">isPaused</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>
    <span class="n">clearBoard</span><span class="p">();</span>

    <span class="n">nextPiece</span><span class="o">.</span><span class="n">setRandomShape</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The first (next) piece is also set up with a random shape.</p>
<p>The <code class="docutils literal"><span class="pre">setNextPieceLabel()</span></code> function is used to pass in an externally-constructed label to the board, so that it can be shown alongside the playing area:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">TetrixBoard</span><span class="p">::</span><span class="n">setNextPieceLabel</span><span class="p">(</span><span class="n">QLabel</span> <span class="o">*</span><span class="n">label</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">nextPieceLabel</span> <span class="o">=</span> <span class="n">label</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We provide a reasonable size hint and minimum size hint for the board, based on the size of the space for each block in the playing area:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">QSize</span> <span class="n">TetrixBoard</span><span class="p">::</span><span class="n">sizeHint</span><span class="p">()</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">QSize</span><span class="p">(</span><span class="n">BoardWidth</span> <span class="o">*</span> <span class="mi">15</span> <span class="o">+</span> <span class="n">frameWidth</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                 <span class="n">BoardHeight</span> <span class="o">*</span> <span class="mi">15</span> <span class="o">+</span> <span class="n">frameWidth</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">QSize</span> <span class="n">TetrixBoard</span><span class="p">::</span><span class="n">minimumSizeHint</span><span class="p">()</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">QSize</span><span class="p">(</span><span class="n">BoardWidth</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">frameWidth</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                 <span class="n">BoardHeight</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">frameWidth</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>By using a minimum size hint, we indicate to the layout in the parent widget that the board should not shrink below a minimum size.</p>
<p>A new game is started when the <code class="docutils literal"><span class="pre">start()</span></code> slot is called. This resets the game’s state, the player’s score and level, and the contents of the board:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">TetrixBoard</span><span class="p">::</span><span class="n">start</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isPaused</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">isStarted</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="n">isWaitingAfterLine</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>
    <span class="n">numLinesRemoved</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">numPiecesDropped</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">clearBoard</span><span class="p">();</span>

    <span class="n">emit</span> <span class="n">linesRemovedChanged</span><span class="p">(</span><span class="n">numLinesRemoved</span><span class="p">);</span>
    <span class="n">emit</span> <span class="n">scoreChanged</span><span class="p">(</span><span class="n">score</span><span class="p">);</span>
    <span class="n">emit</span> <span class="n">levelChanged</span><span class="p">(</span><span class="n">level</span><span class="p">);</span>

    <span class="n">newPiece</span><span class="p">();</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">timeoutTime</span><span class="p">(),</span> <span class="n">this</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We also emit signals to inform other components of these changes before creating a new piece that is ready to be dropped into the playing area. We start the timer that determines how often the piece drops down one row on the board.</p>
<p>The <code class="docutils literal"><span class="pre">pause()</span></code> slot is used to temporarily stop the current game by stopping the internal timer:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>void TetrixBoard::pause()
{
    if (!isStarted)
        return;

    isPaused = !isPaused;
    if (isPaused) {
        timer.stop();
    } else {
        timer.start(timeoutTime(), this);
    }
    update();
}
</pre></div>
</div>
<p>We perform checks to ensure that the game can only be paused if it is already running and not already paused.</p>
<p>The <code class="docutils literal"><span class="pre">paintEvent()</span></code> function is straightforward to implement. We begin by calling the base class’s implementation of <code class="xref py py-func docutils literal"><span class="pre">QWidget.paintEvent()</span></code> before constructing a <a class="reference internal" href="../PySide2/QtGui/QPainter.html#PySide2.QtGui.QPainter" title="PySide2.QtGui.QPainter"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QPainter</span></code></a> for use on the board:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">TetrixBoard</span><span class="p">::</span><span class="n">paintEvent</span><span class="p">(</span><span class="n">QPaintEvent</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">QFrame</span><span class="p">::</span><span class="n">paintEvent</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>

    <span class="n">QPainter</span> <span class="n">painter</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
    <span class="n">QRect</span> <span class="n">rect</span> <span class="o">=</span> <span class="n">contentsRect</span><span class="p">();</span>
</pre></div>
</div>
<p>Since the board is a subclass of <a class="reference internal" href="../PySide2/QtWidgets/QFrame.html#PySide2.QtWidgets.QFrame" title="PySide2.QtWidgets.QFrame"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QFrame</span></code></a> , we obtain a <a class="reference internal" href="../PySide2/QtCore/QRect.html#PySide2.QtCore.QRect" title="PySide2.QtCore.QRect"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QRect</span></code></a> that covers the area <em>inside</em> the frame decoration before drawing our own content.</p>
<p>If the game is paused, we want to hide the existing state of the board and show some text. We achieve this by painting text onto the widget and returning early from the function. The rest of the painting is performed after this point.</p>
<p>The position of the top of the board is found by subtracting the total height of each space on the board from the bottom of the frame’s internal rectangle. For each space on the board that is occupied by a piece, we call the <code class="docutils literal"><span class="pre">drawSquare()</span></code> function to draw a block at that position.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">boardTop</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">bottom</span><span class="p">()</span> <span class="o">-</span> <span class="n">BoardHeight</span><span class="o">*</span><span class="n">squareHeight</span><span class="p">();</span>

<span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">BoardHeight</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">BoardWidth</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">TetrixShape</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">shapeAt</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">BoardHeight</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">NoShape</span><span class="p">)</span>
            <span class="n">drawSquare</span><span class="p">(</span><span class="n">painter</span><span class="p">,</span> <span class="n">rect</span><span class="o">.</span><span class="n">left</span><span class="p">()</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">squareWidth</span><span class="p">(),</span>
                       <span class="n">boardTop</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">squareHeight</span><span class="p">(),</span> <span class="n">shape</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Spaces that are not occupied by blocks are left blank.</p>
<p>Unlike the existing pieces on the board, the current piece is drawn block-by-block at its current position:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="k">if</span> <span class="p">(</span><span class="n">curPiece</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span> <span class="o">!=</span> <span class="n">NoShape</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">curX</span> <span class="o">+</span> <span class="n">curPiece</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="nb">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">curY</span> <span class="o">-</span> <span class="n">curPiece</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="n">drawSquare</span><span class="p">(</span><span class="n">painter</span><span class="p">,</span> <span class="n">rect</span><span class="o">.</span><span class="n">left</span><span class="p">()</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">squareWidth</span><span class="p">(),</span>
                       <span class="n">boardTop</span> <span class="o">+</span> <span class="p">(</span><span class="n">BoardHeight</span> <span class="o">-</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">squareHeight</span><span class="p">(),</span>
                       <span class="n">curPiece</span><span class="o">.</span><span class="n">shape</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">keyPressEvent()</span></code> handler is called whenever the player presses a key while the <code class="docutils literal"><span class="pre">TetrixBoard</span></code> widget has the keyboard focus.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>void TetrixBoard::keyPressEvent(QKeyEvent *event)
{
    if (!isStarted || isPaused || curPiece.shape() == NoShape) {
        QFrame::keyPressEvent(event);
        return;
    }
</pre></div>
</div>
<p>If there is no current game, the game is running but paused, or if there is no current shape to control, we simply pass on the event to the base class.</p>
<p>We check whether the event is about any of the keys that the player uses to control the current piece and, if so, we call the relevant function to handle the input:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">switch</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">())</span> <span class="p">{</span>
<span class="n">case</span> <span class="n">Qt</span><span class="p">::</span><span class="n">Key_Left</span><span class="p">:</span>
    <span class="n">tryMove</span><span class="p">(</span><span class="n">curPiece</span><span class="p">,</span> <span class="n">curX</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">curY</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
<span class="n">case</span> <span class="n">Qt</span><span class="p">::</span><span class="n">Key_Right</span><span class="p">:</span>
    <span class="n">tryMove</span><span class="p">(</span><span class="n">curPiece</span><span class="p">,</span> <span class="n">curX</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">curY</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
<span class="n">case</span> <span class="n">Qt</span><span class="p">::</span><span class="n">Key_Down</span><span class="p">:</span>
    <span class="n">tryMove</span><span class="p">(</span><span class="n">curPiece</span><span class="o">.</span><span class="n">rotatedRight</span><span class="p">(),</span> <span class="n">curX</span><span class="p">,</span> <span class="n">curY</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
<span class="n">case</span> <span class="n">Qt</span><span class="p">::</span><span class="n">Key_Up</span><span class="p">:</span>
    <span class="n">tryMove</span><span class="p">(</span><span class="n">curPiece</span><span class="o">.</span><span class="n">rotatedLeft</span><span class="p">(),</span> <span class="n">curX</span><span class="p">,</span> <span class="n">curY</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
<span class="n">case</span> <span class="n">Qt</span><span class="p">::</span><span class="n">Key_Space</span><span class="p">:</span>
    <span class="n">dropDown</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
<span class="n">case</span> <span class="n">Qt</span><span class="p">::</span><span class="n">Key_D</span><span class="p">:</span>
    <span class="n">oneLineDown</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
<span class="n">default</span><span class="p">:</span>
    <span class="n">QFrame</span><span class="p">::</span><span class="n">keyPressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the case where the player presses a key that we are not interested in, we again pass on the event to the base class’s implementation of <code class="xref py py-func docutils literal"><span class="pre">QWidget.keyPressEvent()</span></code> .</p>
<p>The <code class="docutils literal"><span class="pre">timerEvent()</span></code> handler is called every time the class’s <a class="reference internal" href="../PySide2/QtCore/QBasicTimer.html#PySide2.QtCore.QBasicTimer" title="PySide2.QtCore.QBasicTimer"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QBasicTimer</span></code></a> instance times out. We need to check that the event we receive corresponds to our timer. If it does, we can update the board:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">TetrixBoard</span><span class="p">::</span><span class="n">timerEvent</span><span class="p">(</span><span class="n">QTimerEvent</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">timerId</span><span class="p">()</span> <span class="o">==</span> <span class="n">timer</span><span class="o">.</span><span class="n">timerId</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">isWaitingAfterLine</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">isWaitingAfterLine</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>
            <span class="n">newPiece</span><span class="p">();</span>
            <span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">timeoutTime</span><span class="p">(),</span> <span class="n">this</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">oneLineDown</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">QFrame</span><span class="p">::</span><span class="n">timerEvent</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If a row (or line) has just been filled, we create a new piece and reset the timer; otherwise we move the current piece down by one row. We let the base class handle other timer events that we receive.</p>
<p>The <code class="docutils literal"><span class="pre">clearBoard()</span></code> function simply fills the board with the <code class="docutils literal"><span class="pre">TetrixShape::NoShape</span></code> value:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">TetrixBoard</span><span class="p">::</span><span class="n">clearBoard</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">BoardHeight</span> <span class="o">*</span> <span class="n">BoardWidth</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">NoShape</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">dropDown()</span></code> function moves the current piece down as far as possible on the board, either until it is touching the bottom of the playing area or it is stacked on top of another piece:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>void TetrixBoard::dropDown()
{
    int dropHeight = 0;
    int newY = curY;
    while (newY &gt; 0) {
        if (!tryMove(curPiece, curX, newY - 1))
            break;
        --newY;
        ++dropHeight;
    }
    pieceDropped(dropHeight);
}
</pre></div>
</div>
<p>The number of rows the piece has dropped is recorded and passed to the <code class="docutils literal"><span class="pre">pieceDropped()</span></code> function so that the player’s score can be updated.</p>
<p>The <code class="docutils literal"><span class="pre">oneLineDown()</span></code> function is used to move the current piece down by one row (line), either when the user presses the D key or when the piece is scheduled to move:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>void TetrixBoard::oneLineDown()
{
    if (!tryMove(curPiece, curX, curY - 1))
        pieceDropped(0);
}
</pre></div>
</div>
<p>If the piece cannot drop down by one line, we call the <code class="docutils literal"><span class="pre">pieceDropped()</span></code> function with zero as the argument to indicate that it cannot fall any further, and that the player should receive no extra points for the fall.</p>
<p>The <code class="docutils literal"><span class="pre">pieceDropped()</span></code> function itself is responsible for awarding points to the player for positioning the current piece, checking for full rows on the board and, if no lines have been removed, creating a new piece to replace the current one:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>void TetrixBoard::pieceDropped(int dropHeight)
{
    for (int i = 0; i &lt; 4; ++i) {
        int x = curX + curPiece.x(i);
        int y = curY - curPiece.y(i);
        shapeAt(x, y) = curPiece.shape();
    }

    ++numPiecesDropped;
    if (numPiecesDropped % 25 == 0) {
        ++level;
        timer.start(timeoutTime(), this);
        emit levelChanged(level);
    }

    score += dropHeight + 7;
    emit scoreChanged(score);
    removeFullLines();

    if (!isWaitingAfterLine)
        newPiece();
}
</pre></div>
</div>
<p>We call <code class="docutils literal"><span class="pre">removeFullLines()</span></code> each time a piece has been dropped. This scans the board from bottom to top, looking for blank spaces on each row.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">TetrixBoard</span><span class="p">::</span><span class="n">removeFullLines</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nb">int</span> <span class="n">numFullLines</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">BoardHeight</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">bool</span> <span class="n">lineIsFull</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">BoardWidth</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">shapeAt</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">NoShape</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">lineIsFull</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">lineIsFull</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">++</span><span class="n">numFullLines</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">k</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">BoardHeight</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">BoardWidth</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
                    <span class="n">shapeAt</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">shapeAt</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">BoardWidth</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
                <span class="n">shapeAt</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">BoardHeight</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">NoShape</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>If a row contains no blank spaces, the rows above it are copied down by one row to compress the stack of pieces, the top row on the board is cleared, and the number of full lines found is incremented.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="k">if</span> <span class="p">(</span><span class="n">numFullLines</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">numLinesRemoved</span> <span class="o">+=</span> <span class="n">numFullLines</span><span class="p">;</span>
        <span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">numFullLines</span><span class="p">;</span>
        <span class="n">emit</span> <span class="n">linesRemovedChanged</span><span class="p">(</span><span class="n">numLinesRemoved</span><span class="p">);</span>
        <span class="n">emit</span> <span class="n">scoreChanged</span><span class="p">(</span><span class="n">score</span><span class="p">);</span>

        <span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="n">this</span><span class="p">);</span>
        <span class="n">isWaitingAfterLine</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
        <span class="n">curPiece</span><span class="o">.</span><span class="n">setShape</span><span class="p">(</span><span class="n">NoShape</span><span class="p">);</span>
        <span class="n">update</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If some lines have been removed, the player’s score and the total number of lines removed are updated. The <code class="docutils literal"><span class="pre">linesRemoved()</span></code> and <code class="docutils literal"><span class="pre">scoreChanged()</span></code> signals are emitted to send these new values to other widgets in the window.</p>
<p>Additionally, we set the timer to elapse after half a second, set the <code class="docutils literal"><span class="pre">isWaitingAfterLine</span></code> flag to indicate that lines have been removed, unset the piece’s shape to ensure that it is not drawn, and update the widget. The next time that the <code class="docutils literal"><span class="pre">timerEvent()</span></code> handler is called, a new piece will be created and the game will continue.</p>
<p>The <code class="docutils literal"><span class="pre">newPiece()</span></code> function places the next available piece at the top of the board, and creates a new piece with a random shape:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>void TetrixBoard::newPiece()
{
    curPiece = nextPiece;
    nextPiece.setRandomShape();
    showNextPiece();
    curX = BoardWidth / 2 + 1;
    curY = BoardHeight - 1 + curPiece.minY();

    if (!tryMove(curPiece, curX, curY)) {
        curPiece.setShape(NoShape);
        timer.stop();
        isStarted = false;
    }
}
</pre></div>
</div>
<p>We place a new piece in the middle of the board at the top. The game is over if the piece can’t move, so we unset its shape to prevent it from being drawn, stop the timer, and unset the <code class="docutils literal"><span class="pre">isStarted</span></code> flag.</p>
<p>The <code class="docutils literal"><span class="pre">showNextPiece()</span></code> function updates the label that shows the next piece to be dropped:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>void TetrixBoard::showNextPiece()
{
    if (!nextPieceLabel)
        return;

    int dx = nextPiece.maxX() - nextPiece.minX() + 1;
    int dy = nextPiece.maxY() - nextPiece.minY() + 1;

    QPixmap pixmap(dx * squareWidth(), dy * squareHeight());
    QPainter painter(&amp;pixmap);
    painter.fillRect(pixmap.rect(), nextPieceLabel-&gt;palette().background());

    for (int i = 0; i &lt; 4; ++i) {
        int x = nextPiece.x(i) - nextPiece.minX();
        int y = nextPiece.y(i) - nextPiece.minY();
        drawSquare(painter, x * squareWidth(), y * squareHeight(),
                   nextPiece.shape());
    }
    nextPieceLabel-&gt;setPixmap(pixmap);
}
</pre></div>
</div>
<p>We draw the piece’s component blocks onto a pixmap that is then set on the label.</p>
<p>The <code class="docutils literal"><span class="pre">tryMove()</span></code> function is used to determine whether a piece can be positioned at the specified coordinates:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">bool</span> <span class="n">TetrixBoard</span><span class="p">::</span><span class="n">tryMove</span><span class="p">(</span><span class="n">const</span> <span class="n">TetrixPiece</span> <span class="o">&amp;</span><span class="n">newPiece</span><span class="p">,</span> <span class="nb">int</span> <span class="n">newX</span><span class="p">,</span> <span class="nb">int</span> <span class="n">newY</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">newX</span> <span class="o">+</span> <span class="n">newPiece</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="nb">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">newY</span> <span class="o">-</span> <span class="n">newPiece</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">BoardWidth</span> <span class="o">||</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="n">BoardHeight</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">false</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">shapeAt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="n">NoShape</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">false</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>We examine the spaces on the board that the piece needs to occupy and, if they are already occupied by other pieces, we return <code class="docutils literal"><span class="pre">false</span></code> to indicate that the move has failed.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">curPiece</span> <span class="o">=</span> <span class="n">newPiece</span><span class="p">;</span>
    <span class="n">curX</span> <span class="o">=</span> <span class="n">newX</span><span class="p">;</span>
    <span class="n">curY</span> <span class="o">=</span> <span class="n">newY</span><span class="p">;</span>
    <span class="n">update</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the piece could be placed on the board at the desired location, we update the current piece and its position, update the widget, and return <code class="docutils literal"><span class="pre">true</span></code> to indicate success.</p>
<p>The <code class="docutils literal"><span class="pre">drawSquare()</span></code> function draws the blocks (normally squares) that make up each piece using different colors for pieces with different shapes:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">TetrixBoard</span><span class="p">::</span><span class="n">drawSquare</span><span class="p">(</span><span class="n">QPainter</span> <span class="o">&amp;</span><span class="n">painter</span><span class="p">,</span> <span class="nb">int</span> <span class="n">x</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y</span><span class="p">,</span> <span class="n">TetrixShape</span> <span class="n">shape</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">static</span> <span class="n">const</span> <span class="n">QRgb</span> <span class="n">colorTable</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mh">0x000000</span><span class="p">,</span> <span class="mh">0xCC6666</span><span class="p">,</span> <span class="mh">0x66CC66</span><span class="p">,</span> <span class="mh">0x6666CC</span><span class="p">,</span>
        <span class="mh">0xCCCC66</span><span class="p">,</span> <span class="mh">0xCC66CC</span><span class="p">,</span> <span class="mh">0x66CCCC</span><span class="p">,</span> <span class="mh">0xDAAA00</span>
    <span class="p">};</span>

    <span class="n">QColor</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colorTable</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">shape</span><span class="p">)];</span>
    <span class="n">painter</span><span class="o">.</span><span class="n">fillRect</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">squareWidth</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">squareHeight</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
                     <span class="n">color</span><span class="p">);</span>

    <span class="n">painter</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">light</span><span class="p">());</span>
    <span class="n">painter</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">squareHeight</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="n">painter</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">squareWidth</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>

    <span class="n">painter</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">dark</span><span class="p">());</span>
    <span class="n">painter</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">squareHeight</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">x</span> <span class="o">+</span> <span class="n">squareWidth</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">squareHeight</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">painter</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">squareWidth</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">squareHeight</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">x</span> <span class="o">+</span> <span class="n">squareWidth</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We obtain the color to use from a look-up table that relates each shape to an RGB value, and use the painter provided to draw the block at the specified coordinates.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="tetrixboard-cpp-example-file">
<h1>tetrixboard.cpp Example File<a class="headerlink" href="#tetrixboard-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="tetrixboard-h-example-file">
<h1>tetrixboard.h Example File<a class="headerlink" href="#tetrixboard-h-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="tetrixpiece-cpp-example-file">
<h1>tetrixpiece.cpp Example File<a class="headerlink" href="#tetrixpiece-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="tetrixpiece-h-example-file">
<h1>tetrixpiece.h Example File<a class="headerlink" href="#tetrixpiece-h-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="tetrixwindow-cpp-example-file">
<h1>tetrixwindow.cpp Example File<a class="headerlink" href="#tetrixwindow-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="tetrixwindow-h-example-file">
<h1>tetrixwindow.h Example File<a class="headerlink" href="#tetrixwindow-h-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="main-cpp-example-file">
<h1>main.cpp Example File<a class="headerlink" href="#main-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="tetrix-pro-example-file">
<h1>tetrix.pro Example File<a class="headerlink" href="#tetrix-pro-example-file" title="Permalink to this headline">¶</a></h1>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <p>© 2018 The Qt Company Ltd. Documentation contributions included herein are the copyrights of their respective owners. The documentation provided herein is licensed under the terms of the <a href="http://www.gnu.org/license/fdl.html">GNU Free Documentation License version 1.3</a> as published by the Free Software Foundation. Qt and respective logos are trademarks of The Qt Company Ltd. in Finland and/or other countries worldwide. All other trademarks are property of their respective owners.</p>
    </div></div>
    <div id="footer" class="footer">
    </div>
</div>
  </body>
</html>