
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Editable Tree Model Example &#8212; Qt for Python (Technology Preview)</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.11.0~a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="search" title="Search" href="../search.html" />
  <link rel="stylesheet" type="text/css" href="/style/pyside.css" />
  <link rel="icon" type="image/png" href="/style/pyside-32px.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/style/pyside-16px.png" sizes="16x16" />
  <script type="text/javascript"> wpThemeFolder = 'http://qt.io/wp-content/themes/oneqt'; </script>
  <script type="text/javascript" src="/scripts/main.js"></script>
  <script type="text/javascript" src="/scripts/extras.js"></script>
  <script type="text/javascript">
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-54043535-2', 'qt.io');
    ga('set', 'forceSSL', true);
    ga('send', 'pageview');
  </script>

  </head>
  <body>
<div id="container">
    <div class="header">
        <div class="header_container">
            <header id="navbar">
            </header>
        </div>
    </div>
    <div class="main">
        <div class="main-rounded">
            <div class="navigationbar">
                <ul class="sub-navigation">
                    <li><a href="http://wiki.qt.io/">Wiki</a></li>
                    <li><a href="https://doc.qt.io/">Documentation</a></li>
                    <li><a href="http://forum.qt.io/">Forum</a></li>
                    <li><a href="https://bugreports.qt.io/">Bug Reports</a></li>
                    <li><a href="https://codereview.qt-project.org/">Code Review</a></li>
                </ul>
                <div id="main_title_bar"><h1>Qt Documentation</h1></div>
                <div class="related">
                    <ul>
                        <li><a href="../index.html">Qt for Python (Technology Preview)</a></li> 
                    </ul>
                </div>
            </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Editable Tree Model Example</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#design">Design</a></li>
<li><a class="reference internal" href="#treeitem-class-definition">TreeItem Class Definition</a></li>
<li><a class="reference internal" href="#treeitem-class-implementation">TreeItem Class Implementation</a></li>
<li><a class="reference internal" href="#treemodel-class-definition">TreeModel Class Definition</a></li>
<li><a class="reference internal" href="#treemodel-class-implementation">TreeModel Class Implementation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mainwindow-cpp-example-file">mainwindow.cpp Example File</a></li>
<li><a class="reference internal" href="#mainwindow-h-example-file">mainwindow.h Example File</a></li>
<li><a class="reference internal" href="#mainwindow-ui-example-file">mainwindow.ui Example File</a></li>
<li><a class="reference internal" href="#treeitem-cpp-example-file">treeitem.cpp Example File</a></li>
<li><a class="reference internal" href="#treeitem-h-example-file">treeitem.h Example File</a></li>
<li><a class="reference internal" href="#treemodel-cpp-example-file">treemodel.cpp Example File</a></li>
<li><a class="reference internal" href="#treemodel-h-example-file">treemodel.h Example File</a></li>
<li><a class="reference internal" href="#main-cpp-example-file">main.cpp Example File</a></li>
<li><a class="reference internal" href="#editabletreemodel-pro-example-file">editabletreemodel.pro Example File</a></li>
<li><a class="reference internal" href="#editabletreemodel-qrc-example-file">editabletreemodel.qrc Example File</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" id="q" size="18" />
      <input type="submit" value="Go" id="search_button" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="editable-tree-model-example">
<span id="id1"></span><h1>Editable Tree Model Example<a class="headerlink" href="#editable-tree-model-example" title="Permalink to this headline">¶</a></h1>
<p>This example shows how to implement a simple item-based tree model that can be used with other classes the model/view framework</p>
<blockquote>
<div><p id="treemodel-setupmodeldata"><span id="treemodel-data"></span><span id="treemodel-parent"></span><span id="treemodel-index"></span><span id="treemodel-getitem"></span><span id="treeitem-setdata"></span><span id="treeitem-data"></span><span id="treeitem-child"></span><span id="treeitem-parent"></span><span id="relating-items-using-model-indexes"></span><span id="relations-between-internal-items"></span>This example shows how to implement a simple item-based tree model that can be used with other classes the model/view framework.</p>
<p>The model supports editable items, custom headers, and the ability to insert and remove rows and columns. With these features, it is also possible to insert new child items, and this is shown in the supporting example code.</p>
</div></blockquote>
<div class="section" id="overview">
<span id="id2"></span><h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>As described in the <a class="reference internal" href="model-view-programming.html#model-view-programming"><span class="std std-ref">Model Subclassing Reference</span></a> , models must provide implementations for the standard set of model functions: <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.flags()</span></code> , <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.data()</span></code> , <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.headerData()</span></code> , <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.columnCount()</span></code> , and <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.rowCount()</span></code> . In addition, hierarchical models, such as this one, need to provide implementations of <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.index()</span></code> and <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.parent()</span></code> .</p>
<p>An editable model needs to provide implementations of <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.setData()</span></code> and <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.setHeaderData()</span></code> , and must return a suitable combination of flags from its <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.flags()</span></code> function.</p>
<p>Since this example allows the dimensions of the model to be changed, we must also implement <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.insertRows()</span></code> , <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.insertColumns()</span></code> , <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.removeRows()</span></code> , and <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.removeColumns()</span></code> .</p>
</div></blockquote>
</div>
<div class="section" id="design">
<span id="id3"></span><h2>Design<a class="headerlink" href="#design" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>As with the <a class="reference internal" href="qtwidgets-itemviews-simpletreemodel-example.html#simple-tree-model-example"><span class="std std-ref">Simple Tree Model</span></a> example, the model simply acts as a wrapper around a collection of instances of a <code class="docutils literal"><span class="pre">TreeItem</span></code> class. Each <code class="docutils literal"><span class="pre">TreeItem</span></code> is designed to hold data for a row of items in a tree view, so it contains a list of values corresponding to the data shown in each column.</p>
<p>Since <a class="reference internal" href="../PySide2/QtWidgets/QTreeView.html#PySide2.QtWidgets.QTreeView" title="PySide2.QtWidgets.QTreeView"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QTreeView</span></code></a> provides a row-oriented view onto a model, it is natural to choose a row-oriented design for data structures that will supply data via a model to this kind of view. Although this makes the tree model less flexible, and possibly less useful for use with more sophisticated views, it makes it less complex to design and easier to implement.</p>
<p id="id4">++——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————–+
||**Relations between internal items**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
||                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
||    When designing a data structure for use with a custom model, it is useful to expose each item’s parent via a function like <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">TreeItem::parent()</span></a> because it will make writing the model’s own <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.parent()</span></code> function easier. Similarly, a function like <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">TreeItem::child()</span></a> is helpful when implementing the model’s <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.index()</span></code> function. As a result, each <code class="docutils literal"><span class="pre">TreeItem</span></code> maintains information about its parent and children, making it possible for us to traverse the tree structure.|
||                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
||    The diagram shows how <code class="docutils literal"><span class="pre">TreeItem</span></code> instances are connected via their <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">parent()</span></a> and <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">child()</span></a> functions.                                                                                                                                                                                                                                                                                                                                                                                                                        |
||                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
||    In the example shown, two top-level items, <strong>A</strong> and <strong>B</strong> , can be obtained from the root item by calling its child() function, and each of these items return the root node from their parent() functions, though this is only shown for item <strong>A</strong> .                                                                                                                                                                                                                                                                                                                                             |
++——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————–+</p>
<p>Each <code class="docutils literal"><span class="pre">TreeItem</span></code> stores data for each column in the row it represents in its <code class="docutils literal"><span class="pre">itemData</span></code> private member (a list of <code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QVariant</span></code> objects). Since there is a one-to-one mapping between each column in the view and each entry in the list, we provide a simple <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">data()</span></a> function to read entries in the <code class="docutils literal"><span class="pre">itemData</span></code> list and a <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">setData()</span></a> function to allow them to be modified. As with other functions in the item, this simplifies the implemention of the model’s <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.data()</span></code> and <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.setData()</span></code> functions.</p>
<p>We place an item at the root of the tree of items. This root item corresponds to the null model index, <code class="xref py py-func docutils literal"><span class="pre">QModelIndex.QModelIndex()</span></code> , that is used to represent the parent of a top-level item when handling model indexes. Although the root item does not have a visible representation in any of the standard views, we use its internal list of <code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QVariant</span></code> objects to store a list of strings that will be passed to views for use as horizontal header titles.</p>
<p>++———————————————————————————————————————————————————————————————————————————————–+
||**Accessing data via the model**                                                                                                                                                                                                               |
||                                                                                                                                                                                                                                               |
||    In the case shown in the diagram, the piece of information represented by <strong>a</strong> can be obtained using the standard model/view API:                                                                                                         |
||                                                                                                                                                                                                                                               |
||    ::                                                                                                                                                                                                                                         |
||                                                                                                                                                                                                                                               |
||                QVariant a = model-&gt;index(0, 0, QModelIndex()).data();                                                                                                                                                                         |
||                                                                                                                                                                                                                                               |
||                                                                                                                                                                                                                                               |
||    Since each items holds pieces of data for each column in a given row, there can be many model indexes that map to the same <code class="docutils literal"><span class="pre">TreeItem</span></code> object. For example, the information represented by <strong>b</strong> can be obtained using the following code:|
||                                                                                                                                                                                                                                               |
||    ::                                                                                                                                                                                                                                         |
||                                                                                                                                                                                                                                               |
||                QVariant b = model-&gt;index(1, 0, QModelIndex()).data();                                                                                                                                                                         |
||                                                                                                                                                                                                                                               |
||                                                                                                                                                                                                                                               |
||    The same underlying <code class="docutils literal"><span class="pre">TreeItem</span></code> would be accessed to obtain information for the other model indexes in the same row as <strong>b</strong> .                                                                                                            |
++———————————————————————————————————————————————————————————————————————————————–+</p>
<p>In the model class, <code class="docutils literal"><span class="pre">TreeModel</span></code> , we relate <code class="docutils literal"><span class="pre">TreeItem</span></code> objects to model indexes by passing a pointer for each item when we create its corresponding model index with <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.createIndex()</span></code> in our <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">index()</span></a> and <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">parent()</span></a> implementations. We can retrieve pointers stored in this way by calling the <code class="xref py py-func docutils literal"><span class="pre">QModelIndex.internalPointer()</span></code> function on the relevant model index - we create our own <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">getItem()</span></a> function to do the work for us, and call it from our <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">data()</span></a> and <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">parent()</span></a> implementations.</p>
<p>Storing pointers to items is convenient when we control how they are created and destroyed since we can assume that an address obtained from <code class="xref py py-func docutils literal"><span class="pre">QModelIndex.internalPointer()</span></code> is a valid pointer. However, some models need to handle items that are obtained from other components in a system, and in many cases it is not possible to fully control how items are created or destroyed. In such situations, a pure pointer-based approach needs to be supplemented by safeguards to ensure that the model does not attempt to access items that have been deleted.</p>
<p>+———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————–++
<a href="#id19"><span class="problematic" id="id20">|**Storing information in the underlying data structure**                                                                                                                                                                                                                                                                                                                                                                           ||</span></a>
|                                                                                                                                                                                                                                                                                                                                                                                                                                   ||
|    Several pieces of data are stored as <code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QVariant</span></code> objects in the <code class="docutils literal"><span class="pre">itemData</span></code> member of each <code class="docutils literal"><span class="pre">TreeItem</span></code> instance.                                                                                                                                                                                                                                                                                        ||
|                                                                                                                                                                                                                                                                                                                                                                                                                                   ||
|    The diagram shows how pieces of information, represented by the labels <strong>a</strong> , <strong>b</strong> and <strong>c</strong> in the previous two diagrams, are stored in items <strong>A</strong> , <strong>B</strong> and <strong>C</strong> in the underlying data structure. Note that pieces of information from the same row in the model are all obtained from the same item. Each element in a list corresponds to a piece of information exposed by each column in a given row in the model.||
+———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————–++</p>
<p>Since the <code class="docutils literal"><span class="pre">TreeModel</span></code> implementation has been designed for use with <a class="reference internal" href="../PySide2/QtWidgets/QTreeView.html#PySide2.QtWidgets.QTreeView" title="PySide2.QtWidgets.QTreeView"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QTreeView</span></code></a> , we have added a restriction on the way it uses <code class="docutils literal"><span class="pre">TreeItem</span></code> instances: each item must expose the same number of columns of data. This makes viewing the model consistent, allowing us to use the root item to determine the number of columns for any given row, and only adds the requirement that we create items containing enough data for the total number of columns. As a result, inserting and removing columns are time-consuming operations because we need to traverse the entire tree to modify every item.</p>
<p>An alternative approach would be to design the <code class="docutils literal"><span class="pre">TreeModel</span></code> class so that it truncates or expands the list of data in individual <code class="docutils literal"><span class="pre">TreeItem</span></code> instances as items of data are modified. However, this “lazy” resizing approach would only allow us to insert and remove columns at the end of each row and would not allow columns to be inserted or removed at arbitrary positions in each row.</p>
<p id="id5">++———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————+
||**Relating items using model indexes**                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
||                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
||    As with the <a class="reference internal" href="qtwidgets-itemviews-simpletreemodel-example.html#simple-tree-model-example"><span class="std std-ref">Simple Tree Model</span></a> example, the <code class="docutils literal"><span class="pre">TreeModel</span></code> needs to be able to take a model index, find the corresponding <code class="docutils literal"><span class="pre">TreeItem</span></code> , and return model indexes that correspond to its parents and children.                                                                                                                                                                                                                                                                   |
||                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
||    In the diagram, we show how the model’s <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">parent()</span></a> implementation obtains the model index corresponding to the parent of an item supplied by the caller, using the items shown in a <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">previous diagram</span></a> .                                                                                                                                                                                                                                     |
||                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
||    A pointer to item <strong>C</strong> is obtained from the corresponding model index using the <code class="xref py py-func docutils literal"><span class="pre">QModelIndex.internalPointer()</span></code> function. The pointer was stored internally in the index when it was created. Since the child contains a pointer to its parent, we use its <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">parent()</span></a> function to obtain a pointer to item <strong>B</strong> . The parent model index is created using the <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.createIndex()</span></code> function, passing the pointer to item <strong>B</strong> as the internal pointer.|
++———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————+</p>
</div></blockquote>
</div>
<div class="section" id="treeitem-class-definition">
<span id="id6"></span><h2>TreeItem Class Definition<a class="headerlink" href="#treeitem-class-definition" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The <code class="docutils literal"><span class="pre">TreeItem</span></code> class provides simple items that contain several pieces of data, including information about their parent and child items:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TreeItem</span>
<span class="p">{</span>
<span class="n">public</span><span class="p">:</span>
    <span class="n">explicit</span> <span class="n">TreeItem</span><span class="p">(</span><span class="n">const</span> <span class="n">QVector</span><span class="o">&lt;</span><span class="n">QVariant</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">TreeItem</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
    <span class="o">~</span><span class="n">TreeItem</span><span class="p">();</span>

    <span class="n">TreeItem</span> <span class="o">*</span><span class="n">child</span><span class="p">(</span><span class="nb">int</span> <span class="n">number</span><span class="p">);</span>
    <span class="nb">int</span> <span class="n">childCount</span><span class="p">()</span> <span class="n">const</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">columnCount</span><span class="p">()</span> <span class="n">const</span><span class="p">;</span>
    <span class="n">QVariant</span> <span class="n">data</span><span class="p">(</span><span class="nb">int</span> <span class="n">column</span><span class="p">)</span> <span class="n">const</span><span class="p">;</span>
    <span class="nb">bool</span> <span class="n">insertChildren</span><span class="p">(</span><span class="nb">int</span> <span class="n">position</span><span class="p">,</span> <span class="nb">int</span> <span class="n">count</span><span class="p">,</span> <span class="nb">int</span> <span class="n">columns</span><span class="p">);</span>
    <span class="nb">bool</span> <span class="n">insertColumns</span><span class="p">(</span><span class="nb">int</span> <span class="n">position</span><span class="p">,</span> <span class="nb">int</span> <span class="n">columns</span><span class="p">);</span>
    <span class="n">TreeItem</span> <span class="o">*</span><span class="n">parent</span><span class="p">();</span>
    <span class="nb">bool</span> <span class="n">removeChildren</span><span class="p">(</span><span class="nb">int</span> <span class="n">position</span><span class="p">,</span> <span class="nb">int</span> <span class="n">count</span><span class="p">);</span>
    <span class="nb">bool</span> <span class="n">removeColumns</span><span class="p">(</span><span class="nb">int</span> <span class="n">position</span><span class="p">,</span> <span class="nb">int</span> <span class="n">columns</span><span class="p">);</span>
    <span class="nb">int</span> <span class="n">childNumber</span><span class="p">()</span> <span class="n">const</span><span class="p">;</span>
    <span class="nb">bool</span> <span class="n">setData</span><span class="p">(</span><span class="nb">int</span> <span class="n">column</span><span class="p">,</span> <span class="n">const</span> <span class="n">QVariant</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>

<span class="n">private</span><span class="p">:</span>
    <span class="n">QList</span><span class="o">&lt;</span><span class="n">TreeItem</span><span class="o">*&gt;</span> <span class="n">childItems</span><span class="p">;</span>
    <span class="n">QVector</span><span class="o">&lt;</span><span class="n">QVariant</span><span class="o">&gt;</span> <span class="n">itemData</span><span class="p">;</span>
    <span class="n">TreeItem</span> <span class="o">*</span><span class="n">parentItem</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>We have designed the API to be similar to that provided by <a class="reference internal" href="../PySide2/QtCore/QAbstractItemModel.html#PySide2.QtCore.QAbstractItemModel" title="PySide2.QtCore.QAbstractItemModel"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QAbstractItemModel</span></code></a> by giving each item functions to return the number of columns of information, read and write data, and insert and remove columns. However, we make the relationship between items explicit by providing functions to deal with “children” rather than “rows”.</p>
<p>Each item contains a list of pointers to child items, a pointer to its parent item, and a list of <code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QVariant</span></code> objects that correspond to information held in columns in a given row in the model.</p>
</div></blockquote>
</div>
<div class="section" id="treeitem-class-implementation">
<span id="id7"></span><h2>TreeItem Class Implementation<a class="headerlink" href="#treeitem-class-implementation" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Each <code class="docutils literal"><span class="pre">TreeItem</span></code> is constructed with a list of data and an optional parent item:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TreeItem</span><span class="p">::</span><span class="n">TreeItem</span><span class="p">(</span><span class="n">const</span> <span class="n">QVector</span><span class="o">&lt;</span><span class="n">QVariant</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">TreeItem</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">parentItem</span> <span class="o">=</span> <span class="n">parent</span><span class="p">;</span>
    <span class="n">itemData</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Initially, each item has no children. These are added to the item’s internal <code class="docutils literal"><span class="pre">childItems</span></code> member using the <code class="docutils literal"><span class="pre">insertChildren()</span></code> function described later.</p>
<p>The destructor ensures that each child added to the item is deleted when the item itself is deleted:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TreeItem</span><span class="p">::</span><span class="o">~</span><span class="n">TreeItem</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">qDeleteAll</span><span class="p">(</span><span class="n">childItems</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p id="id8">Since each item stores a pointer to its parent, the <code class="docutils literal"><span class="pre">parent()</span></code> function is trivial:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TreeItem</span> <span class="o">*</span><span class="n">TreeItem</span><span class="p">::</span><span class="n">parent</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">parentItem</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p id="id9">Three functions provide information about the children of an item. <code class="docutils literal"><span class="pre">child()</span></code> returns a specific child from the internal list of children:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TreeItem</span> <span class="o">*</span><span class="n">TreeItem</span><span class="p">::</span><span class="n">child</span><span class="p">(</span><span class="nb">int</span> <span class="n">number</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">childItems</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">number</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">childCount()</span></code> function returns the total number of children:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">TreeItem</span><span class="p">::</span><span class="n">childCount</span><span class="p">()</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">childItems</span><span class="o">.</span><span class="n">count</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">childNumber()</span></code> function is used to determine the index of the child in its parent’s list of children. It accesses the parent’s <code class="docutils literal"><span class="pre">childItems</span></code> member directly to obtain this information:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">TreeItem</span><span class="p">::</span><span class="n">childNumber</span><span class="p">()</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">parentItem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parentItem</span><span class="o">-&gt;</span><span class="n">childItems</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="n">const_cast</span><span class="o">&lt;</span><span class="n">TreeItem</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">this</span><span class="p">));</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The root item has no parent item; for this item, we return zero to be consistent with the other items.</p>
<p>The <code class="docutils literal"><span class="pre">columnCount()</span></code> function simply returns the number of elements in the internal <code class="docutils literal"><span class="pre">itemData</span></code> list of <code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QVariant</span></code> objects:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">TreeItem</span><span class="p">::</span><span class="n">columnCount</span><span class="p">()</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">itemData</span><span class="o">.</span><span class="n">count</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p id="id10">Data is retrieved using the <code class="docutils literal"><span class="pre">data()</span></code> function, which accesses the appropriate element in the <code class="docutils literal"><span class="pre">itemData</span></code> list:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">QVariant</span> <span class="n">TreeItem</span><span class="p">::</span><span class="n">data</span><span class="p">(</span><span class="nb">int</span> <span class="n">column</span><span class="p">)</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">itemData</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">column</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p id="id11">Data is set using the <code class="docutils literal"><span class="pre">setData()</span></code> function, which only stores values in the <code class="docutils literal"><span class="pre">itemData</span></code> list for valid list indexes, corresponding to column values in the model:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">bool</span> <span class="n">TreeItem</span><span class="p">::</span><span class="n">setData</span><span class="p">(</span><span class="nb">int</span> <span class="n">column</span><span class="p">,</span> <span class="n">const</span> <span class="n">QVariant</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">column</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">column</span> <span class="o">&gt;=</span> <span class="n">itemData</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">false</span><span class="p">;</span>

    <span class="n">itemData</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To make implementation of the model easier, we return true to indicate that the data was set successfully.</p>
<p>Editable models often need to be resizable, enabling rows and columns to be inserted and removed. The insertion of rows beneath a given model index in the model leads to the insertion of new child items in the corresponding item, handled by the <code class="docutils literal"><span class="pre">insertChildren()</span></code> function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">bool</span> <span class="n">TreeItem</span><span class="p">::</span><span class="n">insertChildren</span><span class="p">(</span><span class="nb">int</span> <span class="n">position</span><span class="p">,</span> <span class="nb">int</span> <span class="n">count</span><span class="p">,</span> <span class="nb">int</span> <span class="n">columns</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">position</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">position</span> <span class="o">&gt;</span> <span class="n">childItems</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">false</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="o">++</span><span class="n">row</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">QVector</span><span class="o">&lt;</span><span class="n">QVariant</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">(</span><span class="n">columns</span><span class="p">);</span>
        <span class="n">TreeItem</span> <span class="o">*</span><span class="n">item</span> <span class="o">=</span> <span class="n">new</span> <span class="n">TreeItem</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">this</span><span class="p">);</span>
        <span class="n">childItems</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">item</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This ensures that new items are created with the required number of columns and inserted at a valid position in the internal <code class="docutils literal"><span class="pre">childItems</span></code> list. Items are removed with the <code class="docutils literal"><span class="pre">removeChildren()</span></code> function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">bool</span> <span class="n">TreeItem</span><span class="p">::</span><span class="n">removeChildren</span><span class="p">(</span><span class="nb">int</span> <span class="n">position</span><span class="p">,</span> <span class="nb">int</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">position</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">position</span> <span class="o">+</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">childItems</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">false</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="o">++</span><span class="n">row</span><span class="p">)</span>
        <span class="n">delete</span> <span class="n">childItems</span><span class="o">.</span><span class="n">takeAt</span><span class="p">(</span><span class="n">position</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As discussed above, the functions for inserting and removing columns are used differently to those for inserting and removing child items because they are expected to be called on every item in the tree. We do this by recursively calling this function on each child of the item:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">bool</span> <span class="n">TreeItem</span><span class="p">::</span><span class="n">insertColumns</span><span class="p">(</span><span class="nb">int</span> <span class="n">position</span><span class="p">,</span> <span class="nb">int</span> <span class="n">columns</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">position</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">position</span> <span class="o">&gt;</span> <span class="n">itemData</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">false</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">column</span> <span class="o">&lt;</span> <span class="n">columns</span><span class="p">;</span> <span class="o">++</span><span class="n">column</span><span class="p">)</span>
        <span class="n">itemData</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">());</span>

    <span class="n">foreach</span> <span class="p">(</span><span class="n">TreeItem</span> <span class="o">*</span><span class="n">child</span><span class="p">,</span> <span class="n">childItems</span><span class="p">)</span>
        <span class="n">child</span><span class="o">-&gt;</span><span class="n">insertColumns</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">columns</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="treemodel-class-definition">
<span id="id12"></span><h2>TreeModel Class Definition<a class="headerlink" href="#treemodel-class-definition" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The <code class="docutils literal"><span class="pre">TreeModel</span></code> class provides an implementation of the <a class="reference internal" href="../PySide2/QtCore/QAbstractItemModel.html#PySide2.QtCore.QAbstractItemModel" title="PySide2.QtCore.QAbstractItemModel"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QAbstractItemModel</span></code></a> class, exposing the necessary interface for a model that can be edited and resized.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TreeModel</span> <span class="p">:</span> <span class="n">public</span> <span class="n">QAbstractItemModel</span>
<span class="p">{</span>
    <span class="n">Q_OBJECT</span>

<span class="n">public</span><span class="p">:</span>
    <span class="n">TreeModel</span><span class="p">(</span><span class="n">const</span> <span class="n">QStringList</span> <span class="o">&amp;</span><span class="n">headers</span><span class="p">,</span> <span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span>
              <span class="n">QObject</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
    <span class="o">~</span><span class="n">TreeModel</span><span class="p">();</span>
</pre></div>
</div>
<p>The constructor and destructor are specific to this model.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">QVariant</span> <span class="n">data</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span> <span class="n">role</span><span class="p">)</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
<span class="n">QVariant</span> <span class="n">headerData</span><span class="p">(</span><span class="nb">int</span> <span class="n">section</span><span class="p">,</span> <span class="n">Qt</span><span class="p">::</span><span class="n">Orientation</span> <span class="n">orientation</span><span class="p">,</span>
                    <span class="nb">int</span> <span class="n">role</span> <span class="o">=</span> <span class="n">Qt</span><span class="p">::</span><span class="n">DisplayRole</span><span class="p">)</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>

<span class="n">QModelIndex</span> <span class="n">index</span><span class="p">(</span><span class="nb">int</span> <span class="n">row</span><span class="p">,</span> <span class="nb">int</span> <span class="n">column</span><span class="p">,</span>
                  <span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="p">())</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
<span class="n">QModelIndex</span> <span class="n">parent</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">)</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>

<span class="nb">int</span> <span class="n">rowCount</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="p">())</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
<span class="nb">int</span> <span class="n">columnCount</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="p">())</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
</pre></div>
</div>
<p>Read-only tree models only need to provide the above functions. The following public functions provide support for editing and resizing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">Qt</span><span class="p">::</span><span class="n">ItemFlags</span> <span class="n">flags</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">)</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
    <span class="nb">bool</span> <span class="n">setData</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">,</span> <span class="n">const</span> <span class="n">QVariant</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">,</span>
                 <span class="nb">int</span> <span class="n">role</span> <span class="o">=</span> <span class="n">Qt</span><span class="p">::</span><span class="n">EditRole</span><span class="p">)</span> <span class="n">override</span><span class="p">;</span>
    <span class="nb">bool</span> <span class="n">setHeaderData</span><span class="p">(</span><span class="nb">int</span> <span class="n">section</span><span class="p">,</span> <span class="n">Qt</span><span class="p">::</span><span class="n">Orientation</span> <span class="n">orientation</span><span class="p">,</span>
                       <span class="n">const</span> <span class="n">QVariant</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span> <span class="n">role</span> <span class="o">=</span> <span class="n">Qt</span><span class="p">::</span><span class="n">EditRole</span><span class="p">)</span> <span class="n">override</span><span class="p">;</span>

    <span class="nb">bool</span> <span class="n">insertColumns</span><span class="p">(</span><span class="nb">int</span> <span class="n">position</span><span class="p">,</span> <span class="nb">int</span> <span class="n">columns</span><span class="p">,</span>
                       <span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="p">())</span> <span class="n">override</span><span class="p">;</span>
    <span class="nb">bool</span> <span class="n">removeColumns</span><span class="p">(</span><span class="nb">int</span> <span class="n">position</span><span class="p">,</span> <span class="nb">int</span> <span class="n">columns</span><span class="p">,</span>
                       <span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="p">())</span> <span class="n">override</span><span class="p">;</span>
    <span class="nb">bool</span> <span class="n">insertRows</span><span class="p">(</span><span class="nb">int</span> <span class="n">position</span><span class="p">,</span> <span class="nb">int</span> <span class="n">rows</span><span class="p">,</span>
                    <span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="p">())</span> <span class="n">override</span><span class="p">;</span>
    <span class="nb">bool</span> <span class="n">removeRows</span><span class="p">(</span><span class="nb">int</span> <span class="n">position</span><span class="p">,</span> <span class="nb">int</span> <span class="n">rows</span><span class="p">,</span>
                    <span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="p">())</span> <span class="n">override</span><span class="p">;</span>

<span class="n">private</span><span class="p">:</span>
    <span class="n">void</span> <span class="n">setupModelData</span><span class="p">(</span><span class="n">const</span> <span class="n">QStringList</span> <span class="o">&amp;</span><span class="n">lines</span><span class="p">,</span> <span class="n">TreeItem</span> <span class="o">*</span><span class="n">parent</span><span class="p">);</span>
    <span class="n">TreeItem</span> <span class="o">*</span><span class="n">getItem</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">)</span> <span class="n">const</span><span class="p">;</span>

    <span class="n">TreeItem</span> <span class="o">*</span><span class="n">rootItem</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>To simplify this example, the data exposed by the model is organized into a data structure by the model’s <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">setupModelData()</span></a> function. Many real world models will not process the raw data at all, but simply work with an existing data structure or library API.</p>
</div></blockquote>
</div>
<div class="section" id="treemodel-class-implementation">
<span id="id13"></span><h2>TreeModel Class Implementation<a class="headerlink" href="#treemodel-class-implementation" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The constructor creates a root item and initializes it with the header data supplied:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TreeModel</span><span class="p">::</span><span class="n">TreeModel</span><span class="p">(</span><span class="n">const</span> <span class="n">QStringList</span> <span class="o">&amp;</span><span class="n">headers</span><span class="p">,</span> <span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">QObject</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
    <span class="p">:</span> <span class="n">QAbstractItemModel</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">QVector</span><span class="o">&lt;</span><span class="n">QVariant</span><span class="o">&gt;</span> <span class="n">rootData</span><span class="p">;</span>
    <span class="n">foreach</span> <span class="p">(</span><span class="n">QString</span> <span class="n">header</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
        <span class="n">rootData</span> <span class="o">&lt;&lt;</span> <span class="n">header</span><span class="p">;</span>

    <span class="n">rootItem</span> <span class="o">=</span> <span class="n">new</span> <span class="n">TreeItem</span><span class="p">(</span><span class="n">rootData</span><span class="p">);</span>
    <span class="n">setupModelData</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">QString</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)),</span> <span class="n">rootItem</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We call the internal <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">setupModelData()</span></a> function to convert the textual data supplied to a data structure we can use with the model. Other models may be initialized with a ready-made data structure, or use an API from a library that maintains its own data.</p>
<p>The destructor only has to delete the root item, which will cause all child items to be recursively deleted.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TreeModel</span><span class="p">::</span><span class="o">~</span><span class="n">TreeModel</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">delete</span> <span class="n">rootItem</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p id="id14">Since the model’s interface to the other model/view components is based on model indexes, and since the internal data structure is item-based, many of the functions implemented by the model need to be able to convert any given model index to its corresponding item. For convenience and consistency, we have defined a <code class="docutils literal"><span class="pre">getItem()</span></code> function to perform this repetitive task:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TreeItem</span> <span class="o">*</span><span class="n">TreeModel</span><span class="p">::</span><span class="n">getItem</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">)</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">isValid</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">TreeItem</span> <span class="o">*</span><span class="n">item</span> <span class="o">=</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="n">TreeItem</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">());</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">item</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">rootItem</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Each model index passed to this function should correspond to a valid item in memory. If the index is invalid, or its internal pointer does not refer to a valid item, the root item is returned instead.</p>
<p>The model’s <code class="docutils literal"><span class="pre">rowCount()</span></code> implementation is simple: it first uses the <code class="docutils literal"><span class="pre">getItem()</span></code> function to obtain the relevant item; then it returns the number of children it contains:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">TreeModel</span><span class="p">::</span><span class="n">rowCount</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">parent</span><span class="p">)</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="n">TreeItem</span> <span class="o">*</span><span class="n">parentItem</span> <span class="o">=</span> <span class="n">getItem</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">parentItem</span><span class="o">-&gt;</span><span class="n">childCount</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>By contrast, the <code class="docutils literal"><span class="pre">columnCount()</span></code> implementation does not need to look for a particular item because all items are defined to have the same number of columns associated with them.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">TreeModel</span><span class="p">::</span><span class="n">columnCount</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span> <span class="o">/*</span> <span class="n">parent</span> <span class="o">*/</span><span class="p">)</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">rootItem</span><span class="o">-&gt;</span><span class="n">columnCount</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As a result, the number of columns can be obtained directly from the root item.</p>
<p>To enable items to be edited and selected, the <code class="docutils literal"><span class="pre">flags()</span></code> function needs to be implemented so that it returns a combination of flags that includes the <code class="xref py py-attr docutils literal"><span class="pre">Qt.ItemIsEditable</span></code> and <code class="xref py py-attr docutils literal"><span class="pre">Qt.ItemIsSelectable</span></code> flags as well as <code class="xref py py-attr docutils literal"><span class="pre">Qt.ItemIsEnabled</span></code> :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Qt::ItemFlags TreeModel::flags(const QModelIndex &amp;index) const
{
    if (!index.isValid())
        return 0;

    return Qt::ItemIsEditable | QAbstractItemModel::flags(index);
}
</pre></div>
</div>
<p id="id15">The model needs to be able to generate model indexes to allow other components to request data and information about its structure. This task is performed by the <code class="docutils literal"><span class="pre">index()</span></code> function, which is used to obtain model indexes corresponding to children of a given parent item:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">QModelIndex</span> <span class="n">TreeModel</span><span class="p">::</span><span class="n">index</span><span class="p">(</span><span class="nb">int</span> <span class="n">row</span><span class="p">,</span> <span class="nb">int</span> <span class="n">column</span><span class="p">,</span> <span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">parent</span><span class="p">)</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">isValid</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">parent</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">QModelIndex</span><span class="p">();</span>
</pre></div>
</div>
<p>In this model, we only return model indexes for child items if the parent index is invalid (corresponding to the root item) or if it has a zero column number.</p>
<p>We use the custom <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">getItem()</span></a> function to obtain a <code class="docutils literal"><span class="pre">TreeItem</span></code> instance that corresponds to the model index supplied, and request its child item that corresponds to the specified row.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">TreeItem</span> <span class="o">*</span><span class="n">parentItem</span> <span class="o">=</span> <span class="n">getItem</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>

    <span class="n">TreeItem</span> <span class="o">*</span><span class="n">childItem</span> <span class="o">=</span> <span class="n">parentItem</span><span class="o">-&gt;</span><span class="n">child</span><span class="p">(</span><span class="n">row</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">childItem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">createIndex</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">childItem</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="k">return</span> <span class="n">QModelIndex</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Since each item contains information for an entire row of data, we create a model index to uniquely identify it by calling <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.createIndex()</span></code> it with the row and column numbers and a pointer to the item. In the <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">data()</span></a> function, we will use the item pointer and column number to access the data associated with the model index; in this model, the row number is not needed to identify data.</p>
<p id="id16">The <code class="docutils literal"><span class="pre">parent()</span></code> function supplies model indexes for parents of items by finding the corresponding item for a given model index, using its <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">parent()</span></a> function to obtain its parent item, then creating a model index to represent the parent. (See <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">the above diagram</span></a> ).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>QModelIndex TreeModel::parent(const QModelIndex &amp;index) const
{
    if (!index.isValid())
        return QModelIndex();

    TreeItem *childItem = getItem(index);
    TreeItem *parentItem = childItem-&gt;parent();

    if (parentItem == rootItem)
        return QModelIndex();

    return createIndex(parentItem-&gt;childNumber(), 0, parentItem);
}
</pre></div>
</div>
<p>Items without parents, including the root item, are handled by returning a null model index. Otherwise, a model index is created and returned as in the <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">index()</span></a> function, with a suitable row number, but with a zero column number to be consistent with the scheme used in the <a class="reference internal" href="#editable-tree-model-example"><span class="std std-ref">index()</span></a> implementation.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="mainwindow-cpp-example-file">
<span id="id18"></span><h1>mainwindow.cpp Example File<a class="headerlink" href="#mainwindow-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="mainwindow-h-example-file">
<h1>mainwindow.h Example File<a class="headerlink" href="#mainwindow-h-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="mainwindow-ui-example-file">
<h1>mainwindow.ui Example File<a class="headerlink" href="#mainwindow-ui-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="treeitem-cpp-example-file">
<h1>treeitem.cpp Example File<a class="headerlink" href="#treeitem-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="treeitem-h-example-file">
<h1>treeitem.h Example File<a class="headerlink" href="#treeitem-h-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="treemodel-cpp-example-file">
<h1>treemodel.cpp Example File<a class="headerlink" href="#treemodel-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="treemodel-h-example-file">
<h1>treemodel.h Example File<a class="headerlink" href="#treemodel-h-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="main-cpp-example-file">
<h1>main.cpp Example File<a class="headerlink" href="#main-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="editabletreemodel-pro-example-file">
<h1>editabletreemodel.pro Example File<a class="headerlink" href="#editabletreemodel-pro-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="editabletreemodel-qrc-example-file">
<h1>editabletreemodel.qrc Example File<a class="headerlink" href="#editabletreemodel-qrc-example-file" title="Permalink to this headline">¶</a></h1>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <p>© 2018 The Qt Company Ltd. Documentation contributions included herein are the copyrights of their respective owners. The documentation provided herein is licensed under the terms of the <a href="http://www.gnu.org/license/fdl.html">GNU Free Documentation License version 1.3</a> as published by the Free Software Foundation. Qt and respective logos are trademarks of The Qt Company Ltd. in Finland and/or other countries worldwide. All other trademarks are property of their respective owners.</p>
    </div></div>
    <div id="footer" class="footer">
    </div>
</div>
  </body>
</html>