
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Simple DOM Model Example &#8212; Qt for Python (Technology Preview)</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.11.0~a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="search" title="Search" href="../search.html" />
  <link rel="stylesheet" type="text/css" href="/style/pyside.css" />
  <link rel="icon" type="image/png" href="/style/pyside-32px.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/style/pyside-16px.png" sizes="16x16" />
  <script type="text/javascript"> wpThemeFolder = 'http://qt.io/wp-content/themes/oneqt'; </script>
  <script type="text/javascript" src="/scripts/main.js"></script>
  <script type="text/javascript" src="/scripts/extras.js"></script>
  <script type="text/javascript">
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-54043535-2', 'qt.io');
    ga('set', 'forceSSL', true);
    ga('send', 'pageview');
  </script>

  </head>
  <body>
<div id="container">
    <div class="header">
        <div class="header_container">
            <header id="navbar">
            </header>
        </div>
    </div>
    <div class="main">
        <div class="main-rounded">
            <div class="navigationbar">
                <ul class="sub-navigation">
                    <li><a href="http://wiki.qt.io/">Wiki</a></li>
                    <li><a href="https://doc.qt.io/">Documentation</a></li>
                    <li><a href="http://forum.qt.io/">Forum</a></li>
                    <li><a href="https://bugreports.qt.io/">Bug Reports</a></li>
                    <li><a href="https://codereview.qt-project.org/">Code Review</a></li>
                </ul>
                <div id="main_title_bar"><h1>Qt Documentation</h1></div>
                <div class="related">
                    <ul>
                        <li><a href="../index.html">Qt for Python (Technology Preview)</a></li> 
                    </ul>
                </div>
            </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Simple DOM Model Example</a><ul>
<li><a class="reference internal" href="#design-and-concepts">Design and Concepts</a></li>
<li><a class="reference internal" href="#dommodel-class-definition">DomModel Class Definition</a></li>
<li><a class="reference internal" href="#domitem-class-definition">DomItem Class Definition</a></li>
<li><a class="reference internal" href="#domitem-class-implementation">DomItem Class Implementation</a></li>
<li><a class="reference internal" href="#dommodel-class-implementation">DomModel Class Implementation</a></li>
<li><a class="reference internal" href="#basic-properties-of-the-model">Basic Properties of The Model</a></li>
<li><a class="reference internal" href="#navigating-the-document">Navigating The Document</a></li>
<li><a class="reference internal" href="#implementation-notes">Implementation Notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#domitem-cpp-example-file">domitem.cpp Example File</a></li>
<li><a class="reference internal" href="#domitem-h-example-file">domitem.h Example File</a></li>
<li><a class="reference internal" href="#dommodel-cpp-example-file">dommodel.cpp Example File</a></li>
<li><a class="reference internal" href="#dommodel-h-example-file">dommodel.h Example File</a></li>
<li><a class="reference internal" href="#mainwindow-cpp-example-file">mainwindow.cpp Example File</a></li>
<li><a class="reference internal" href="#mainwindow-h-example-file">mainwindow.h Example File</a></li>
<li><a class="reference internal" href="#main-cpp-example-file">main.cpp Example File</a></li>
<li><a class="reference internal" href="#simpledommodel-pro-example-file">simpledommodel.pro Example File</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" id="q" size="18" />
      <input type="submit" value="Go" id="search_button" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="simple-dom-model-example">
<span id="id1"></span><h1>Simple DOM Model Example<a class="headerlink" href="#simple-dom-model-example" title="Permalink to this headline">¶</a></h1>
<p>Simple DOM Model example shows how an existing class can be adapted for use with the model/view framework</p>
<blockquote>
<div><p>The Simple DOM Model example shows how an existing class can be adapted for use with the model/view framework.</p>
<p>Qt provides two complementary sets of classes for reading XML files: The classes based around <a class="reference internal" href="../PySide2/QtXml/QXmlReader.html#PySide2.QtXml.QXmlReader" title="PySide2.QtXml.QXmlReader"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QXmlReader</span></code></a> provide a SAX-style API for incremental reading of large files, and the classes based around <a class="reference internal" href="../PySide2/QtXml/QDomDocument.html#PySide2.QtXml.QDomDocument" title="PySide2.QtXml.QDomDocument"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QDomDocument</span></code></a> enable developers to access the contents of XML files using a Document Object Model (DOM) API.</p>
<p>In this example, we create a model that uses the DOM API to expose the structure and contents of XML documents to views via the standard QAbstractModel interface.</p>
</div></blockquote>
<div class="section" id="design-and-concepts">
<span id="id2"></span><h2>Design and Concepts<a class="headerlink" href="#design-and-concepts" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Reading an XML document with Qt’s DOM classes is a straightforward process. Typically, the contents of a file are supplied to <a class="reference internal" href="../PySide2/QtXml/QDomDocument.html#PySide2.QtXml.QDomDocument" title="PySide2.QtXml.QDomDocument"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QDomDocument</span></code></a> , and nodes are accessed using the functions provided by <a class="reference internal" href="../PySide2/QtXml/QDomNode.html#PySide2.QtXml.QDomNode" title="PySide2.QtXml.QDomNode"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QDomNode</span></code></a> and its subclasses.</p>
<p>The aim is to use the structure provided by <a class="reference internal" href="../PySide2/QtXml/QDomDocument.html#PySide2.QtXml.QDomDocument" title="PySide2.QtXml.QDomDocument"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QDomDocument</span></code></a> by wrapping <a class="reference internal" href="../PySide2/QtXml/QDomNode.html#PySide2.QtXml.QDomNode" title="PySide2.QtXml.QDomNode"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QDomNode</span></code></a> objects in item objects similar to the <code class="docutils literal"><span class="pre">TreeItem</span></code> objects used in the <a class="reference internal" href="qtwidgets-itemviews-simpletreemodel-example.html#simple-tree-model-example"><span class="std std-ref">Simple Tree Model</span></a> example.</p>
</div></blockquote>
</div>
<div class="section" id="dommodel-class-definition">
<span id="id3"></span><h2>DomModel Class Definition<a class="headerlink" href="#dommodel-class-definition" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Let us begin by examining the <code class="docutils literal"><span class="pre">DomModel</span></code> class:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DomModel</span> <span class="p">:</span> <span class="n">public</span> <span class="n">QAbstractItemModel</span>
<span class="p">{</span>
    <span class="n">Q_OBJECT</span>

<span class="n">public</span><span class="p">:</span>
    <span class="n">explicit</span> <span class="n">DomModel</span><span class="p">(</span><span class="n">QDomDocument</span> <span class="n">document</span><span class="p">,</span> <span class="n">QObject</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
    <span class="o">~</span><span class="n">DomModel</span><span class="p">();</span>

    <span class="n">QVariant</span> <span class="n">data</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span> <span class="n">role</span><span class="p">)</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
    <span class="n">Qt</span><span class="p">::</span><span class="n">ItemFlags</span> <span class="n">flags</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">)</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
    <span class="n">QVariant</span> <span class="n">headerData</span><span class="p">(</span><span class="nb">int</span> <span class="n">section</span><span class="p">,</span> <span class="n">Qt</span><span class="p">::</span><span class="n">Orientation</span> <span class="n">orientation</span><span class="p">,</span>
                        <span class="nb">int</span> <span class="n">role</span> <span class="o">=</span> <span class="n">Qt</span><span class="p">::</span><span class="n">DisplayRole</span><span class="p">)</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
    <span class="n">QModelIndex</span> <span class="n">index</span><span class="p">(</span><span class="nb">int</span> <span class="n">row</span><span class="p">,</span> <span class="nb">int</span> <span class="n">column</span><span class="p">,</span>
                      <span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="p">())</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
    <span class="n">QModelIndex</span> <span class="n">parent</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">child</span><span class="p">)</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">rowCount</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="p">())</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">columnCount</span><span class="p">(</span><span class="n">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="p">())</span> <span class="n">const</span> <span class="n">override</span><span class="p">;</span>

<span class="n">private</span><span class="p">:</span>
    <span class="n">QDomDocument</span> <span class="n">domDocument</span><span class="p">;</span>
    <span class="n">DomItem</span> <span class="o">*</span><span class="n">rootItem</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The class definition contains all the basic functions that are needed for a read-only model. Only the constructor and <code class="docutils literal"><span class="pre">document()</span></code> function are specific to this model. The private <code class="docutils literal"><span class="pre">domDocument</span></code> variable is used to hold the document that is exposed by the model; the <code class="docutils literal"><span class="pre">rootItem</span></code> variable contains a pointer to the root item in the model.</p>
</div></blockquote>
</div>
<div class="section" id="domitem-class-definition">
<span id="id4"></span><h2>DomItem Class Definition<a class="headerlink" href="#domitem-class-definition" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The <code class="docutils literal"><span class="pre">DomItem</span></code> class is used to hold information about a specific <a class="reference internal" href="../PySide2/QtXml/QDomNode.html#PySide2.QtXml.QDomNode" title="PySide2.QtXml.QDomNode"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QDomNode</span></code></a> in the document:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DomItem</span>
<span class="p">{</span>
<span class="n">public</span><span class="p">:</span>
    <span class="n">DomItem</span><span class="p">(</span><span class="n">QDomNode</span> <span class="o">&amp;</span><span class="n">node</span><span class="p">,</span> <span class="nb">int</span> <span class="n">row</span><span class="p">,</span> <span class="n">DomItem</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
    <span class="o">~</span><span class="n">DomItem</span><span class="p">();</span>
    <span class="n">DomItem</span> <span class="o">*</span><span class="n">child</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span><span class="p">);</span>
    <span class="n">DomItem</span> <span class="o">*</span><span class="n">parent</span><span class="p">();</span>
    <span class="n">QDomNode</span> <span class="n">node</span><span class="p">()</span> <span class="n">const</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">row</span><span class="p">();</span>

<span class="n">private</span><span class="p">:</span>
    <span class="n">QDomNode</span> <span class="n">domNode</span><span class="p">;</span>
    <span class="n">QHash</span><span class="o">&lt;</span><span class="nb">int</span><span class="p">,</span><span class="n">DomItem</span><span class="o">*&gt;</span> <span class="n">childItems</span><span class="p">;</span>
    <span class="n">DomItem</span> <span class="o">*</span><span class="n">parentItem</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">rowNumber</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Each <code class="docutils literal"><span class="pre">DomItem</span></code> provides a wrapper for a <a class="reference internal" href="../PySide2/QtXml/QDomNode.html#PySide2.QtXml.QDomNode" title="PySide2.QtXml.QDomNode"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QDomNode</span></code></a> obtained from the underlying document which contains a reference to the node, it’s location in the parent node’s list of child nodes, and a pointer to a parent wrapper item.</p>
<p>The <code class="docutils literal"><span class="pre">parent()</span></code> , <code class="docutils literal"><span class="pre">child()</span></code> , and <code class="docutils literal"><span class="pre">row()</span></code> functions are convenience functions for the <code class="docutils literal"><span class="pre">DomModel</span></code> to use that provide basic information about the item to be discovered quickly. The node() function provides access to the underlying <a class="reference internal" href="../PySide2/QtXml/QDomNode.html#PySide2.QtXml.QDomNode" title="PySide2.QtXml.QDomNode"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QDomNode</span></code></a> object.</p>
<p>As well as the information supplied in the constructor, the class maintains a cache of information about any child items. This is used to provide a collection of persistent item objects that the model can identify consistently and improve the performance of the model when accessing child items.</p>
</div></blockquote>
</div>
<div class="section" id="domitem-class-implementation">
<span id="id5"></span><h2>DomItem Class Implementation<a class="headerlink" href="#domitem-class-implementation" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Since the <code class="docutils literal"><span class="pre">DomItem</span></code> class is only a thin wrapper around <a class="reference internal" href="../PySide2/QtXml/QDomNode.html#PySide2.QtXml.QDomNode" title="PySide2.QtXml.QDomNode"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QDomNode</span></code></a> objects, with a few additional features to help improve performance and memory usage, we can provide a brief outline of the class before discussing the model itself.</p>
<p>The constructor simply records details of the <a class="reference internal" href="../PySide2/QtXml/QDomNode.html#PySide2.QtXml.QDomNode" title="PySide2.QtXml.QDomNode"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QDomNode</span></code></a> that needs to be wrapped:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DomItem</span><span class="p">::</span><span class="n">DomItem</span><span class="p">(</span><span class="n">QDomNode</span> <span class="o">&amp;</span><span class="n">node</span><span class="p">,</span> <span class="nb">int</span> <span class="n">row</span><span class="p">,</span> <span class="n">DomItem</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">domNode</span> <span class="o">=</span> <span class="n">node</span><span class="p">;</span>
    <span class="n">rowNumber</span> <span class="o">=</span> <span class="n">row</span><span class="p">;</span>
    <span class="n">parentItem</span> <span class="o">=</span> <span class="n">parent</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As a result, functions to provide the parent wrapper, the row number occupied by the item in its parent’s list of children, and the underlying <a class="reference internal" href="../PySide2/QtXml/QDomNode.html#PySide2.QtXml.QDomNode" title="PySide2.QtXml.QDomNode"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QDomNode</span></code></a> for each item are straightforward to write:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DomItem</span> <span class="o">*</span><span class="n">DomItem</span><span class="p">::</span><span class="n">parent</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">parentItem</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">int</span> <span class="n">DomItem</span><span class="p">::</span><span class="n">row</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">rowNumber</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">QDomNode</span> <span class="n">DomItem</span><span class="p">::</span><span class="n">node</span><span class="p">()</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">domNode</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is necessary to maintain a collection of items which can be consistently identified by the model. For that reason, we maintain a hash of child wrapper items that, to minimize memory usage, is initially empty. The model uses the item’s <code class="docutils literal"><span class="pre">child()</span></code> function to help create model indexes, and this constructs wrappers for the children of the item’s <a class="reference internal" href="../PySide2/QtXml/QDomNode.html#PySide2.QtXml.QDomNode" title="PySide2.QtXml.QDomNode"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QDomNode</span></code></a> , relating the row number of each child to the newly-constructed wrapper:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DomItem</span> <span class="o">*</span><span class="n">DomItem</span><span class="p">::</span><span class="n">child</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">childItems</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">childItems</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">domNode</span><span class="o">.</span><span class="n">childNodes</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">QDomNode</span> <span class="n">childNode</span> <span class="o">=</span> <span class="n">domNode</span><span class="o">.</span><span class="n">childNodes</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="n">DomItem</span> <span class="o">*</span><span class="n">childItem</span> <span class="o">=</span> <span class="n">new</span> <span class="n">DomItem</span><span class="p">(</span><span class="n">childNode</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">this</span><span class="p">);</span>
        <span class="n">childItems</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">childItem</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">childItem</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If a <a class="reference internal" href="../PySide2/QtXml/QDomNode.html#PySide2.QtXml.QDomNode" title="PySide2.QtXml.QDomNode"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QDomNode</span></code></a> was previously wrapped, the cached wrapper is returned; otherwise, a new wrapper is constructed and stored for valid children, and zero is returned for invalid ones.</p>
<p>The class’s destructor deletes all the child items of the wrapper:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DomItem</span><span class="p">::</span><span class="o">~</span><span class="n">DomItem</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">QHash</span><span class="o">&lt;</span><span class="nb">int</span><span class="p">,</span><span class="n">DomItem</span><span class="o">*&gt;</span><span class="p">::</span><span class="n">iterator</span> <span class="n">it</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">it</span> <span class="o">=</span> <span class="n">childItems</span><span class="o">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">childItems</span><span class="o">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span>
        <span class="n">delete</span> <span class="n">it</span><span class="o">.</span><span class="n">value</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These, in turn, will delete their children and free any <a class="reference internal" href="../PySide2/QtXml/QDomNode.html#PySide2.QtXml.QDomNode" title="PySide2.QtXml.QDomNode"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QDomNode</span></code></a> objects in use.</p>
</div></blockquote>
</div>
<div class="section" id="dommodel-class-implementation">
<span id="id6"></span><h2>DomModel Class Implementation<a class="headerlink" href="#dommodel-class-implementation" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The structure provided by the <code class="docutils literal"><span class="pre">DomItem</span></code> class makes the implementation of <code class="docutils literal"><span class="pre">DomModel</span></code> similar to the <code class="docutils literal"><span class="pre">TreeModel</span></code> shown in the <a class="reference internal" href="qtwidgets-itemviews-simpletreemodel-example.html#simple-tree-model-example"><span class="std std-ref">Simple Tree Model</span></a> example.</p>
<p>The constructor accepts an existing document and a parent object for the model:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DomModel</span><span class="p">::</span><span class="n">DomModel</span><span class="p">(</span><span class="n">QDomDocument</span> <span class="n">document</span><span class="p">,</span> <span class="n">QObject</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
    <span class="p">:</span> <span class="n">QAbstractItemModel</span><span class="p">(</span><span class="n">parent</span><span class="p">),</span> <span class="n">domDocument</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">rootItem</span> <span class="o">=</span> <span class="n">new</span> <span class="n">DomItem</span><span class="p">(</span><span class="n">domDocument</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A shallow copy of the document is stored for future reference, and a root item is created to provide a wrapper around the document. We assign the root item a row number of zero only to be consistent since the root item will have no siblings.</p>
<p>Since the model only contains information about the root item, the destructor only needs to delete this one item:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DomModel</span><span class="p">::</span><span class="o">~</span><span class="n">DomModel</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">delete</span> <span class="n">rootItem</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>All of the child items in the tree will be deleted by the <code class="docutils literal"><span class="pre">DomItem</span></code> destructor as their parent items are deleted.</p>
</div></blockquote>
</div>
<div class="section" id="basic-properties-of-the-model">
<span id="id7"></span><h2>Basic Properties of The Model<a class="headerlink" href="#basic-properties-of-the-model" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Some aspects of the model do not depend on the structure of the underlying document, and these are simple to implement.</p>
<p>The number of columns exposed by the model is returned by the <code class="docutils literal"><span class="pre">columnCount()</span></code> function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">3</span>
</pre></div>
</div>
<p>This value is fixed, and does not depend on the location or type of the underlying node in the document. We will use these three columns to display different kinds of data from the underlying document.</p>
<p>Since we only implement a read-only model, the <code class="docutils literal"><span class="pre">flags()</span></code> function is straightforward to write:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Qt::ItemFlags DomModel::flags(const QModelIndex &amp;index) const
{
    if (!index.isValid())
        return 0;

    return Qt::ItemIsEnabled | Qt::ItemIsSelectable;
}
</pre></div>
</div>
<p>Since the model is intended for use in a tree view, the <code class="docutils literal"><span class="pre">headerData()</span></code> function only provides a horizontal header:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">QVariant</span> <span class="n">DomModel</span><span class="p">::</span><span class="n">headerData</span><span class="p">(</span><span class="nb">int</span> <span class="n">section</span><span class="p">,</span> <span class="n">Qt</span><span class="p">::</span><span class="n">Orientation</span> <span class="n">orientation</span><span class="p">,</span>
                              <span class="nb">int</span> <span class="n">role</span><span class="p">)</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">orientation</span> <span class="o">==</span> <span class="n">Qt</span><span class="p">::</span><span class="n">Horizontal</span> <span class="o">&amp;&amp;</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="p">::</span><span class="n">DisplayRole</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">switch</span> <span class="p">(</span><span class="n">section</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">case</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">);</span>
            <span class="n">case</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Attributes&quot;</span><span class="p">);</span>
            <span class="n">case</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">);</span>
            <span class="n">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">QVariant</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">QVariant</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The model presents the names of nodes in the first column, element attributes in the second, and any node values in the third.</p>
</div></blockquote>
</div>
<div class="section" id="navigating-the-document">
<span id="id8"></span><h2>Navigating The Document<a class="headerlink" href="#navigating-the-document" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The index() function creates a model index for the item with the given row, column, and parent in the model:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>QModelIndex DomModel::index(int row, int column, const QModelIndex &amp;parent)
            const
{
    if (!hasIndex(row, column, parent))
        return QModelIndex();

    DomItem *parentItem;

    if (!parent.isValid())
        parentItem = rootItem;
    else
        parentItem = static_cast&lt;DomItem*&gt;(parent.internalPointer());
</pre></div>
</div>
<p>The function first has to relate the parent index to an item that contains a node from the underlying document. If the parent index is invalid, it refers to the root node in the document, so we retrieve the root item that wraps it; otherwise, we obtain a pointer to the relevant item using the <code class="xref py py-func docutils literal"><span class="pre">QModelIndex.internalPointer()</span></code> function. We are able to extract a pointer in this way because any valid model index will have been created by this function, and we store pointers to item objects in any new indexes that we create with <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.createIndex()</span></code> :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">DomItem</span> <span class="o">*</span><span class="n">childItem</span> <span class="o">=</span> <span class="n">parentItem</span><span class="o">-&gt;</span><span class="n">child</span><span class="p">(</span><span class="n">row</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">childItem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">createIndex</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">childItem</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="k">return</span> <span class="n">QModelIndex</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A child item for the given row is provided by the parent item’s <code class="docutils literal"><span class="pre">child()</span></code> function. If a suitable child item was found then we call <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.createIndex()</span></code> to produce a model index for the requested row and column, passing a pointer to the child item for it to store internally. If no suitable child item is found, an invalid model index is returned.</p>
<p>Note that the items themselves maintain ownership of their child items. This means that the model does not need to keep track of the child items that have been created, and can let the items themselves tidy up when they are deleted.</p>
<p>The number of rows beneath a given item in the model is returned by the <code class="docutils literal"><span class="pre">rowCount()</span></code> function, and is the number of child nodes contained by the node that corresponds to the specified model index:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>int DomModel::rowCount(const QModelIndex &amp;parent) const
{
    if (parent.column() &gt; 0)
        return 0;

    DomItem *parentItem;

    if (!parent.isValid())
        parentItem = rootItem;
    else
        parentItem = static_cast&lt;DomItem*&gt;(parent.internalPointer());

    return parentItem-&gt;node().childNodes().count();
}
</pre></div>
</div>
<p>To obtain the relevant node in the underlying document, we access the item via the internal pointer stored in the model index. If an invalid index is supplied, the root item is used instead. We use the item’s <code class="docutils literal"><span class="pre">node()</span></code> function to access the node itself, and simply count the number of child nodes it contains.</p>
<p>Since the model is used to represent a hierarchical data structure, it needs to provide an implementation for the <code class="docutils literal"><span class="pre">parent()</span></code> function. This returns a model index that corresponds to the parent of a child model index supplied as its argument:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>QModelIndex DomModel::parent(const QModelIndex &amp;child) const
{
    if (!child.isValid())
        return QModelIndex();

    DomItem *childItem = static_cast&lt;DomItem*&gt;(child.internalPointer());
    DomItem *parentItem = childItem-&gt;parent();

    if (!parentItem || parentItem == rootItem)
        return QModelIndex();

    return createIndex(parentItem-&gt;row(), 0, parentItem);
}
</pre></div>
</div>
<p>For valid indexes other than the index corresponding to the root item, we obtain a pointer to the relevant item using the method described in the <code class="docutils literal"><span class="pre">index()</span></code> function, and use the item’s <code class="docutils literal"><span class="pre">parent()</span></code> function to obtain a pointer to the parent item.</p>
<p>If no valid parent item exists, or if the parent item is the root item, we can simply follow convention and return an invalid model index. For all other parent items, we create a model index containing the appropriate row and column numbers, and a pointer to the parent item we just obtained.</p>
<p>Data is provided by the <code class="docutils literal"><span class="pre">data()</span></code> function. For simplicity, we only provide data for the <code class="xref py py-attr docutils literal"><span class="pre">display</span> <span class="pre">role</span></code> , returning an invalid variant for all other requests:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>QVariant DomModel::data(const QModelIndex &amp;index, int role) const
{
    if (!index.isValid())
        return QVariant();

    if (role != Qt::DisplayRole)
        return QVariant();

    DomItem *item = static_cast&lt;DomItem*&gt;(index.internalPointer());

    QDomNode node = item-&gt;node();
</pre></div>
</div>
<p>As before, we obtain an item pointer for the index supplied, and use it to obtain the underlying document node. Depending on the column specified, the data we return is obtained in different ways:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">QStringList</span> <span class="n">attributes</span><span class="p">;</span>
    <span class="n">QDomNamedNodeMap</span> <span class="n">attributeMap</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">attributes</span><span class="p">();</span>

    <span class="n">switch</span> <span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">case</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeName</span><span class="p">();</span>
        <span class="n">case</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">attributeMap</span><span class="o">.</span><span class="n">count</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">QDomNode</span> <span class="n">attribute</span> <span class="o">=</span> <span class="n">attributeMap</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                <span class="n">attributes</span> <span class="o">&lt;&lt;</span> <span class="n">attribute</span><span class="o">.</span><span class="n">nodeName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;=</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
                              <span class="o">+</span><span class="n">attribute</span><span class="o">.</span><span class="n">nodeValue</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">attributes</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>
        <span class="n">case</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeValue</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>
        <span class="n">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">QVariant</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For the first column, we return the node’s name. For the second column, we read any attributes that the node may have, and return a string that contains a space-separated list of attribute-value assignments. For the third column, we return any value that the node may have; this allows the contents of text nodes to be displayed in a view.</p>
<p>If data from any other column is requested, an invalid variant is returned.</p>
</div></blockquote>
</div>
<div class="section" id="implementation-notes">
<span id="id9"></span><h2>Implementation Notes<a class="headerlink" href="#implementation-notes" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Ideally, we would rely on the structure provided by <a class="reference internal" href="../PySide2/QtXml/QDomDocument.html#PySide2.QtXml.QDomDocument" title="PySide2.QtXml.QDomDocument"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QDomDocument</span></code></a> to help us write the <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.parent()</span></code> and <code class="xref py py-func docutils literal"><span class="pre">QAbstractItemModel.index()</span></code> functions that are required when subclassing <a class="reference internal" href="../PySide2/QtCore/QAbstractItemModel.html#PySide2.QtCore.QAbstractItemModel" title="PySide2.QtCore.QAbstractItemModel"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QAbstractItemModel</span></code></a> . However, since Qt’s DOM classes use their own system for dynamically allocating memory for DOM nodes, we cannot guarantee that the <a class="reference internal" href="../PySide2/QtXml/QDomNode.html#PySide2.QtXml.QDomNode" title="PySide2.QtXml.QDomNode"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QDomNode</span></code></a> objects returned for a given piece of information will be the same for subsequent accesses to the document.</p>
<p>We use item wrappers for each <a class="reference internal" href="../PySide2/QtXml/QDomNode.html#PySide2.QtXml.QDomNode" title="PySide2.QtXml.QDomNode"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtXml.QDomNode</span></code></a> to provide consistent pointers that the model can use to navigate the document structure.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="domitem-cpp-example-file">
<h1>domitem.cpp Example File<a class="headerlink" href="#domitem-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="domitem-h-example-file">
<h1>domitem.h Example File<a class="headerlink" href="#domitem-h-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="dommodel-cpp-example-file">
<h1>dommodel.cpp Example File<a class="headerlink" href="#dommodel-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="dommodel-h-example-file">
<h1>dommodel.h Example File<a class="headerlink" href="#dommodel-h-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="mainwindow-cpp-example-file">
<h1>mainwindow.cpp Example File<a class="headerlink" href="#mainwindow-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="mainwindow-h-example-file">
<h1>mainwindow.h Example File<a class="headerlink" href="#mainwindow-h-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="main-cpp-example-file">
<h1>main.cpp Example File<a class="headerlink" href="#main-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="simpledommodel-pro-example-file">
<h1>simpledommodel.pro Example File<a class="headerlink" href="#simpledommodel-pro-example-file" title="Permalink to this headline">¶</a></h1>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <p>© 2018 The Qt Company Ltd. Documentation contributions included herein are the copyrights of their respective owners. The documentation provided herein is licensed under the terms of the <a href="http://www.gnu.org/license/fdl.html">GNU Free Documentation License version 1.3</a> as published by the Free Software Foundation. Qt and respective logos are trademarks of The Qt Company Ltd. in Finland and/or other countries worldwide. All other trademarks are property of their respective owners.</p>
    </div></div>
    <div id="footer" class="footer">
    </div>
</div>
  </body>
</html>