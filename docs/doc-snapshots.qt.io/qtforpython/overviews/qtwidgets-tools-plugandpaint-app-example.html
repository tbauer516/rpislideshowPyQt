
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Plug &amp; Paint Example &#8212; Qt for Python (Technology Preview)</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.11.0~a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="search" title="Search" href="../search.html" />
  <link rel="stylesheet" type="text/css" href="/style/pyside.css" />
  <link rel="icon" type="image/png" href="/style/pyside-32px.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/style/pyside-16px.png" sizes="16x16" />
  <script type="text/javascript"> wpThemeFolder = 'http://qt.io/wp-content/themes/oneqt'; </script>
  <script type="text/javascript" src="/scripts/main.js"></script>
  <script type="text/javascript" src="/scripts/extras.js"></script>
  <script type="text/javascript">
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-54043535-2', 'qt.io');
    ga('set', 'forceSSL', true);
    ga('send', 'pageview');
  </script>

  </head>
  <body>
<div id="container">
    <div class="header">
        <div class="header_container">
            <header id="navbar">
            </header>
        </div>
    </div>
    <div class="main">
        <div class="main-rounded">
            <div class="navigationbar">
                <ul class="sub-navigation">
                    <li><a href="http://wiki.qt.io/">Wiki</a></li>
                    <li><a href="https://doc.qt.io/">Documentation</a></li>
                    <li><a href="http://forum.qt.io/">Forum</a></li>
                    <li><a href="https://bugreports.qt.io/">Bug Reports</a></li>
                    <li><a href="https://codereview.qt-project.org/">Code Review</a></li>
                </ul>
                <div id="main_title_bar"><h1>Qt Documentation</h1></div>
                <div class="related">
                    <ul>
                        <li><a href="../index.html">Qt for Python (Technology Preview)</a></li> 
                    </ul>
                </div>
            </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Plug &amp; Paint Example</a><ul>
<li><a class="reference internal" href="#the-plugin-interfaces">The Plugin Interfaces</a></li>
<li><a class="reference internal" href="#the-mainwindow-class">The MainWindow Class</a></li>
<li><a class="reference internal" href="#the-paintarea-class">The PaintArea Class</a></li>
<li><a class="reference internal" href="#the-plugindialog-class">The PluginDialog Class</a></li>
<li><a class="reference internal" href="#importing-static-plugins">Importing Static Plugins</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interfaces-h-example-file">interfaces.h Example File</a></li>
<li><a class="reference internal" href="#mainwindow-cpp-example-file">mainwindow.cpp Example File</a></li>
<li><a class="reference internal" href="#mainwindow-h-example-file">mainwindow.h Example File</a></li>
<li><a class="reference internal" href="#paintarea-cpp-example-file">paintarea.cpp Example File</a></li>
<li><a class="reference internal" href="#paintarea-h-example-file">paintarea.h Example File</a></li>
<li><a class="reference internal" href="#plugindialog-cpp-example-file">plugindialog.cpp Example File</a></li>
<li><a class="reference internal" href="#plugindialog-h-example-file">plugindialog.h Example File</a></li>
<li><a class="reference internal" href="#main-cpp-example-file">main.cpp Example File</a></li>
<li><a class="reference internal" href="#app-pro-example-file">app.pro Example File</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" id="q" size="18" />
      <input type="submit" value="Go" id="search_button" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="plug-paint-example">
<span id="id1"></span><h1>Plug &amp; Paint Example<a class="headerlink" href="#plug-paint-example" title="Permalink to this headline">¶</a></h1>
<p>Demonstrates how to extend Qt applications using plugins</p>
<blockquote>
<div><p>Demonstrates how to extend Qt applications using plugins.</p>
<p>A plugin is a dynamic library that can be loaded at run-time to extend an application. Qt makes it possible to create custom plugins and to load them using <a class="reference internal" href="../PySide2/QtCore/QPluginLoader.html#PySide2.QtCore.QPluginLoader" title="PySide2.QtCore.QPluginLoader"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QPluginLoader</span></code></a> . To ensure that plugins don’t get lost, it is also possible to link them statically to the executable. The Plug &amp; Paint example uses plugins to support custom brushes, shapes, and image filters. A single plugin can provide multiple brushes, shapes, and/or filters.</p>
<p>If you want to learn how to make your own application extensible through plugins, we recommend that you start by reading this overview, which explains how to make an application use plugins. Afterwards, you can read the <a class="reference internal" href="qtwidgets-tools-plugandpaint-plugins-basictools-example.html#plug-paint-basic-tools-example"><span class="std std-ref">Basic Tools</span></a> and <a class="reference internal" href="qtwidgets-tools-plugandpaint-plugins-extrafilters-example.html#plug-paint-extra-filters-example"><span class="std std-ref">Extra Filters</span></a> overviews, which show how to implement static and dynamic plugins, respectively.</p>
<p>Plug &amp; Paint consists of the following classes:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">MainWindow</span></code> is a <a class="reference internal" href="../PySide2/QtWidgets/QMainWindow.html#PySide2.QtWidgets.QMainWindow" title="PySide2.QtWidgets.QMainWindow"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QMainWindow</span></code></a> subclass that provides the menu system and that contains a <code class="docutils literal"><span class="pre">PaintArea</span></code> as the central widget.</li>
<li><code class="docutils literal"><span class="pre">PaintArea</span></code> is a <a class="reference internal" href="../PySide2/QtWidgets/QWidget.html#PySide2.QtWidgets.QWidget" title="PySide2.QtWidgets.QWidget"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QWidget</span></code></a> that allows the user to draw using a brush and to insert shapes.</li>
<li><code class="docutils literal"><span class="pre">PluginDialog</span></code> is a dialog that shows information about the plugins detected by the application.</li>
<li><code class="docutils literal"><span class="pre">BrushInterface</span></code>, <code class="docutils literal"><span class="pre">ShapeInterface</span></code>, and <code class="docutils literal"><span class="pre">FilterInterface</span></code> are abstract base classes that can be implemented by plugins to provide custom brushes, shapes, and image filters.</li>
</ul>
</div></blockquote>
<div class="section" id="the-plugin-interfaces">
<span id="id2"></span><h2>The Plugin Interfaces<a class="headerlink" href="#the-plugin-interfaces" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>We will start by reviewing the interfaces defined in <code class="docutils literal"><span class="pre">interfaces.h</span></code> . These interfaces are used by the Plug &amp; Paint application to access extra functionality. They are implemented in the plugins.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BrushInterface</span>
<span class="p">{</span>
<span class="n">public</span><span class="p">:</span>
    <span class="n">virtual</span> <span class="o">~</span><span class="n">BrushInterface</span><span class="p">()</span> <span class="p">{}</span>

    <span class="n">virtual</span> <span class="n">QStringList</span> <span class="n">brushes</span><span class="p">()</span> <span class="n">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">virtual</span> <span class="n">QRect</span> <span class="n">mousePress</span><span class="p">(</span><span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">brush</span><span class="p">,</span> <span class="n">QPainter</span> <span class="o">&amp;</span><span class="n">painter</span><span class="p">,</span>
                             <span class="n">const</span> <span class="n">QPoint</span> <span class="o">&amp;</span><span class="n">pos</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">virtual</span> <span class="n">QRect</span> <span class="n">mouseMove</span><span class="p">(</span><span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">brush</span><span class="p">,</span> <span class="n">QPainter</span> <span class="o">&amp;</span><span class="n">painter</span><span class="p">,</span>
                            <span class="n">const</span> <span class="n">QPoint</span> <span class="o">&amp;</span><span class="n">oldPos</span><span class="p">,</span> <span class="n">const</span> <span class="n">QPoint</span> <span class="o">&amp;</span><span class="n">newPos</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">virtual</span> <span class="n">QRect</span> <span class="n">mouseRelease</span><span class="p">(</span><span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">brush</span><span class="p">,</span> <span class="n">QPainter</span> <span class="o">&amp;</span><span class="n">painter</span><span class="p">,</span>
                               <span class="n">const</span> <span class="n">QPoint</span> <span class="o">&amp;</span><span class="n">pos</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">BrushInterface</span></code> class declares four pure virtual functions. The first pure virtual function, <code class="docutils literal"><span class="pre">brushes()</span></code> , returns a list of strings that identify the brushes provided by the plugin. By returning a <code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QStringList</span></code> instead of a <code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QString</span></code> , we make it possible for a single plugin to provide multiple brushes. The other functions have a <code class="docutils literal"><span class="pre">brush</span></code> parameter to identify which brush (among those returned by <code class="docutils literal"><span class="pre">brushes()</span></code> ) is used.</p>
<p><code class="docutils literal"><span class="pre">mousePress()</span></code> , <code class="docutils literal"><span class="pre">mouseMove()</span></code> , and <code class="docutils literal"><span class="pre">mouseRelease()</span></code> take a <a class="reference internal" href="../PySide2/QtGui/QPainter.html#PySide2.QtGui.QPainter" title="PySide2.QtGui.QPainter"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QPainter</span></code></a> and one or two <a class="reference internal" href="../PySide2/QtCore/QPoint.html#PySide2.QtCore.QPoint" title="PySide2.QtCore.QPoint"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QPoint</span></code></a> s, and return a <a class="reference internal" href="../PySide2/QtCore/QRect.html#PySide2.QtCore.QRect" title="PySide2.QtCore.QRect"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QRect</span></code></a> identifying which portion of the image was altered by the brush.</p>
<p>The class also has a virtual destructor. Interface classes usually don’t need such a destructor (because it would make little sense to <code class="docutils literal"><span class="pre">delete</span></code> the object that implements the interface through a pointer to the interface), but some compilers emit a warning for classes that declare virtual functions but no virtual destructor. We provide the destructor to keep these compilers happy.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ShapeInterface</span>
<span class="p">{</span>
<span class="n">public</span><span class="p">:</span>
    <span class="n">virtual</span> <span class="o">~</span><span class="n">ShapeInterface</span><span class="p">()</span> <span class="p">{}</span>

    <span class="n">virtual</span> <span class="n">QStringList</span> <span class="n">shapes</span><span class="p">()</span> <span class="n">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">virtual</span> <span class="n">QPainterPath</span> <span class="n">generateShape</span><span class="p">(</span><span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">shape</span><span class="p">,</span>
                                       <span class="n">QWidget</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">ShapeInterface</span></code> class declares a <code class="docutils literal"><span class="pre">shapes()</span></code> function that works the same as <code class="docutils literal"><span class="pre">BrushInterface</span></code> ‘s <code class="docutils literal"><span class="pre">brushes()</span></code> function, and a <code class="docutils literal"><span class="pre">generateShape()</span></code> function that has a <code class="docutils literal"><span class="pre">shape</span></code> parameter. Shapes are represented by a <a class="reference internal" href="../PySide2/QtGui/QPainterPath.html#PySide2.QtGui.QPainterPath" title="PySide2.QtGui.QPainterPath"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QPainterPath</span></code></a> , a data type that can represent arbitrary 2D shapes or combinations of shapes. The <code class="docutils literal"><span class="pre">parent</span></code> parameter can be used by the plugin to pop up a dialog asking the user to specify more information.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FilterInterface</span>
<span class="p">{</span>
<span class="n">public</span><span class="p">:</span>
    <span class="n">virtual</span> <span class="o">~</span><span class="n">FilterInterface</span><span class="p">()</span> <span class="p">{}</span>

    <span class="n">virtual</span> <span class="n">QStringList</span> <span class="n">filters</span><span class="p">()</span> <span class="n">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">virtual</span> <span class="n">QImage</span> <span class="n">filterImage</span><span class="p">(</span><span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="nb">filter</span><span class="p">,</span> <span class="n">const</span> <span class="n">QImage</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">,</span>
                               <span class="n">QWidget</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">FilterInterface</span></code> class declares a <code class="docutils literal"><span class="pre">filters()</span></code> function that returns a list of filter names, and a <code class="docutils literal"><span class="pre">filterImage()</span></code> function that applies a filter to an image.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#define BrushInterface_iid &quot;org.qt-project.Qt.Examples.PlugAndPaint.BrushInterface&quot;</span>

<span class="n">Q_DECLARE_INTERFACE</span><span class="p">(</span><span class="n">BrushInterface</span><span class="p">,</span> <span class="n">BrushInterface_iid</span><span class="p">)</span>


<span class="c1">#define ShapeInterface_iid  &quot;org.qt-project.Qt.Examples.PlugAndPaint.ShapeInterface&quot;</span>

<span class="n">Q_DECLARE_INTERFACE</span><span class="p">(</span><span class="n">ShapeInterface</span><span class="p">,</span> <span class="n">ShapeInterface_iid</span><span class="p">)</span>

<span class="c1">#define FilterInterface_iid &quot;org.qt-project.Qt.Examples.PlugAndPaint.FilterInterface&quot;</span>

<span class="n">Q_DECLARE_INTERFACE</span><span class="p">(</span><span class="n">FilterInterface</span><span class="p">,</span> <span class="n">FilterInterface_iid</span><span class="p">)</span>
</pre></div>
</div>
<p>To make it possible to query at run-time whether a plugin implements a given interface, we must use the <code class="docutils literal"><span class="pre">Q_DECLARE_INTERFACE()</span></code> macro. The first argument is the name of the interface. The second argument is a string identifying the interface in a unique way. By convention, we use a “Java package name” syntax to identify interfaces. If we later change the interfaces, we must use a different string to identify the new interface; otherwise, the application might crash. It is therefore a good idea to include a version number in the string, as we did above.</p>
<p>The <a class="reference internal" href="qtwidgets-tools-plugandpaint-plugins-basictools-example.html#plug-paint-basic-tools-example"><span class="std std-ref">Basic Tools</span></a> plugin and the <a class="reference internal" href="qtwidgets-tools-plugandpaint-plugins-extrafilters-example.html#plug-paint-extra-filters-example"><span class="std std-ref">Extra Filters</span></a> plugin shows how to derive from <code class="docutils literal"><span class="pre">BrushInterface</span></code> , <code class="docutils literal"><span class="pre">ShapeInterface</span></code> , and <code class="docutils literal"><span class="pre">FilterInterface</span></code> .</p>
<p>A note on naming: It might have been tempting to give the <code class="docutils literal"><span class="pre">brushes()</span></code> , <code class="docutils literal"><span class="pre">shapes()</span></code> , and <code class="docutils literal"><span class="pre">filters()</span></code> functions a more generic name, such as <code class="docutils literal"><span class="pre">keys()</span></code> or <code class="docutils literal"><span class="pre">features()</span></code> . However, that would have made multiple inheritance impractical. When creating interfaces, we should always try to give unique names to the pure virtual functions.</p>
</div></blockquote>
</div>
<div class="section" id="the-mainwindow-class">
<span id="id3"></span><h2>The MainWindow Class<a class="headerlink" href="#the-mainwindow-class" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The <code class="docutils literal"><span class="pre">MainWindow</span></code> class is a standard <a class="reference internal" href="../PySide2/QtWidgets/QMainWindow.html#PySide2.QtWidgets.QMainWindow" title="PySide2.QtWidgets.QMainWindow"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QMainWindow</span></code></a> subclass, as found in many of the other examples (e.g., <a class="reference internal" href="qtwidgets-mainwindows-application-example.html#application-example"><span class="std std-ref">Application</span></a> ). Here, we’ll concentrate on the parts of the code that are related to plugins.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">MainWindow</span><span class="p">::</span><span class="n">loadPlugins</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">foreach</span> <span class="p">(</span><span class="n">QObject</span> <span class="o">*</span><span class="n">plugin</span><span class="p">,</span> <span class="n">QPluginLoader</span><span class="p">::</span><span class="n">staticInstances</span><span class="p">())</span>
        <span class="n">populateMenus</span><span class="p">(</span><span class="n">plugin</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">loadPlugins()</span></code> function is called from the <code class="docutils literal"><span class="pre">MainWindow</span></code> constructor to detect plugins and update the Brush, Shapes, and Filters menus. We start by handling static plugins (available through <code class="xref py py-func docutils literal"><span class="pre">QPluginLoader.staticInstances()</span></code> )</p>
<p>To the application that uses the plugin, a Qt plugin is simply a <a class="reference internal" href="../PySide2/QtCore/QObject.html#PySide2.QtCore.QObject" title="PySide2.QtCore.QObject"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QObject</span></code></a> . That <a class="reference internal" href="../PySide2/QtCore/QObject.html#PySide2.QtCore.QObject" title="PySide2.QtCore.QObject"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QObject</span></code></a> implements plugin interfaces using multiple inheritance.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">pluginsDir</span> <span class="o">=</span> <span class="n">QDir</span><span class="p">(</span><span class="n">qApp</span><span class="o">-&gt;</span><span class="n">applicationDirPath</span><span class="p">());</span>

<span class="c1">#if defined(Q_OS_WIN)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pluginsDir</span><span class="o">.</span><span class="n">dirName</span><span class="p">()</span><span class="o">.</span><span class="n">toLower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;debug&quot;</span> <span class="o">||</span> <span class="n">pluginsDir</span><span class="o">.</span><span class="n">dirName</span><span class="p">()</span><span class="o">.</span><span class="n">toLower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;release&quot;</span><span class="p">)</span>
        <span class="n">pluginsDir</span><span class="o">.</span><span class="n">cdUp</span><span class="p">();</span>
<span class="c1">#elif defined(Q_OS_MAC)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pluginsDir</span><span class="o">.</span><span class="n">dirName</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;MacOS&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pluginsDir</span><span class="o">.</span><span class="n">cdUp</span><span class="p">();</span>
        <span class="n">pluginsDir</span><span class="o">.</span><span class="n">cdUp</span><span class="p">();</span>
        <span class="n">pluginsDir</span><span class="o">.</span><span class="n">cdUp</span><span class="p">();</span>
    <span class="p">}</span>
<span class="c1">#endif</span>
    <span class="n">pluginsDir</span><span class="o">.</span><span class="n">cd</span><span class="p">(</span><span class="s2">&quot;plugins&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The next step is to load dynamic plugins. We initialize the <code class="docutils literal"><span class="pre">pluginsDir</span></code> member variable to refer to the <code class="docutils literal"><span class="pre">plugins</span></code> subdirectory of the Plug &amp; Paint example. On Unix, this is just a matter of initializing the <a class="reference internal" href="../PySide2/QtCore/QDir.html#PySide2.QtCore.QDir" title="PySide2.QtCore.QDir"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QDir</span></code></a> variable with <code class="xref py py-func docutils literal"><span class="pre">QApplication.applicationDirPath()</span></code> , the path of the executable file, and to do a <code class="xref py py-func docutils literal"><span class="pre">QDir.cd()</span></code> . On Windows and <span class="xref std std-ref">macOS</span> , this file is usually located in a subdirectory, so we need to take this into account.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">foreach</span> <span class="p">(</span><span class="n">QString</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">pluginsDir</span><span class="o">.</span><span class="n">entryList</span><span class="p">(</span><span class="n">QDir</span><span class="p">::</span><span class="n">Files</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">QPluginLoader</span> <span class="n">loader</span><span class="p">(</span><span class="n">pluginsDir</span><span class="o">.</span><span class="n">absoluteFilePath</span><span class="p">(</span><span class="n">fileName</span><span class="p">));</span>
    <span class="n">QObject</span> <span class="o">*</span><span class="n">plugin</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">instance</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plugin</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">populateMenus</span><span class="p">(</span><span class="n">plugin</span><span class="p">);</span>
        <span class="n">pluginFileNames</span> <span class="o">+=</span> <span class="n">fileName</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We use <code class="xref py py-func docutils literal"><span class="pre">QDir.entryList()</span></code> to get a list of all files in that directory. Then we iterate over the result using <span class="xref std std-ref">foreach</span> and try to load the plugin using <a class="reference internal" href="../PySide2/QtCore/QPluginLoader.html#PySide2.QtCore.QPluginLoader" title="PySide2.QtCore.QPluginLoader"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QPluginLoader</span></code></a> .</p>
<p>The <a class="reference internal" href="../PySide2/QtCore/QObject.html#PySide2.QtCore.QObject" title="PySide2.QtCore.QObject"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QObject</span></code></a> provided by the plugin is accessible through <code class="xref py py-func docutils literal"><span class="pre">QPluginLoader.instance()</span></code> . If the dynamic library isn’t a Qt plugin, or if it was compiled against an incompatible version of the Qt library, <code class="xref py py-func docutils literal"><span class="pre">QPluginLoader.instance()</span></code> returns a null pointer.</p>
<p>If <code class="xref py py-func docutils literal"><span class="pre">QPluginLoader.instance()</span></code> is non-null, we add it to the menus.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    brushMenu-&gt;setEnabled(!brushActionGroup-&gt;actions().isEmpty());
    shapesMenu-&gt;setEnabled(!shapesMenu-&gt;actions().isEmpty());
    filterMenu-&gt;setEnabled(!filterMenu-&gt;actions().isEmpty());
}
</pre></div>
</div>
<p>At the end, we enable or disable the Brush, Shapes, and Filters menus based on whether they contain any items.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">MainWindow</span><span class="p">::</span><span class="n">populateMenus</span><span class="p">(</span><span class="n">QObject</span> <span class="o">*</span><span class="n">plugin</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">BrushInterface</span> <span class="o">*</span><span class="n">iBrush</span> <span class="o">=</span> <span class="n">qobject_cast</span><span class="o">&lt;</span><span class="n">BrushInterface</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">plugin</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iBrush</span><span class="p">)</span>
        <span class="n">addToMenu</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">iBrush</span><span class="o">-&gt;</span><span class="n">brushes</span><span class="p">(),</span> <span class="n">brushMenu</span><span class="p">,</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">changeBrush</span><span class="p">()),</span>
                  <span class="n">brushActionGroup</span><span class="p">);</span>

    <span class="n">ShapeInterface</span> <span class="o">*</span><span class="n">iShape</span> <span class="o">=</span> <span class="n">qobject_cast</span><span class="o">&lt;</span><span class="n">ShapeInterface</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">plugin</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iShape</span><span class="p">)</span>
        <span class="n">addToMenu</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">iShape</span><span class="o">-&gt;</span><span class="n">shapes</span><span class="p">(),</span> <span class="n">shapesMenu</span><span class="p">,</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">insertShape</span><span class="p">()));</span>

    <span class="n">FilterInterface</span> <span class="o">*</span><span class="n">iFilter</span> <span class="o">=</span> <span class="n">qobject_cast</span><span class="o">&lt;</span><span class="n">FilterInterface</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">plugin</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iFilter</span><span class="p">)</span>
        <span class="n">addToMenu</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">iFilter</span><span class="o">-&gt;</span><span class="n">filters</span><span class="p">(),</span> <span class="n">filterMenu</span><span class="p">,</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">applyFilter</span><span class="p">()));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For each plugin (static or dynamic), we check which interfaces it implements using <code class="xref py py-func docutils literal"><span class="pre">qobject_cast()</span></code> . First, we try to cast the plugin instance to a <code class="docutils literal"><span class="pre">BrushInterface</span></code> ; if it works, we call the private function <code class="docutils literal"><span class="pre">addToMenu()</span></code> with the list of brushes returned by <code class="docutils literal"><span class="pre">brushes()</span></code> . Then we do the same with the <code class="docutils literal"><span class="pre">ShapeInterface</span></code> and the <code class="docutils literal"><span class="pre">FilterInterface</span></code> .</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">MainWindow</span><span class="p">::</span><span class="n">aboutPlugins</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">PluginDialog</span> <span class="n">dialog</span><span class="p">(</span><span class="n">pluginsDir</span><span class="o">.</span><span class="n">path</span><span class="p">(),</span> <span class="n">pluginFileNames</span><span class="p">,</span> <span class="n">this</span><span class="p">);</span>
    <span class="n">dialog</span><span class="o">.</span><span class="n">exec</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">aboutPlugins()</span></code> slot is called on startup and can be invoked at any time through the About Plugins action. It pops up a <code class="docutils literal"><span class="pre">PluginDialog</span></code> , providing information about the loaded plugins.</p>
<p>The <code class="docutils literal"><span class="pre">addToMenu()</span></code> function is called from <code class="docutils literal"><span class="pre">loadPlugin()</span></code> to create <a class="reference internal" href="../PySide2/QtWidgets/QAction.html#PySide2.QtWidgets.QAction" title="PySide2.QtWidgets.QAction"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QAction</span></code></a> s for custom brushes, shapes, or filters and add them to the relevant menu. The <a class="reference internal" href="../PySide2/QtWidgets/QAction.html#PySide2.QtWidgets.QAction" title="PySide2.QtWidgets.QAction"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QAction</span></code></a> is created with the plugin from which it comes from as the parent; this makes it convenient to get access to the plugin later.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">MainWindow</span><span class="p">::</span><span class="n">changeBrush</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">QAction</span> <span class="o">*</span><span class="n">action</span> <span class="o">=</span> <span class="n">qobject_cast</span><span class="o">&lt;</span><span class="n">QAction</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">sender</span><span class="p">());</span>
    <span class="n">BrushInterface</span> <span class="o">*</span><span class="n">iBrush</span> <span class="o">=</span> <span class="n">qobject_cast</span><span class="o">&lt;</span><span class="n">BrushInterface</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">action</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">());</span>
    <span class="n">const</span> <span class="n">QString</span> <span class="n">brush</span> <span class="o">=</span> <span class="n">action</span><span class="o">-&gt;</span><span class="n">text</span><span class="p">();</span>

    <span class="n">paintArea</span><span class="o">-&gt;</span><span class="n">setBrush</span><span class="p">(</span><span class="n">iBrush</span><span class="p">,</span> <span class="n">brush</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">changeBrush()</span></code> slot is invoked when the user chooses one of the brushes from the Brush menu. We start by finding out which action invoked the slot using <code class="xref py py-func docutils literal"><span class="pre">QObject.sender()</span></code> . Then we get the <code class="docutils literal"><span class="pre">BrushInterface</span></code> out of the plugin (which we conveniently passed as the <a class="reference internal" href="../PySide2/QtWidgets/QAction.html#PySide2.QtWidgets.QAction" title="PySide2.QtWidgets.QAction"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QAction</span></code></a> ‘s parent) and we call <code class="docutils literal"><span class="pre">PaintArea::setBrush()</span></code> with the <code class="docutils literal"><span class="pre">BrushInterface</span></code> and the string identifying the brush. Next time the user draws on the paint area, <code class="docutils literal"><span class="pre">PaintArea</span></code> will use this brush.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>void MainWindow::insertShape()
{
    QAction *action = qobject_cast&lt;QAction *&gt;(sender());
    ShapeInterface *iShape = qobject_cast&lt;ShapeInterface *&gt;(action-&gt;parent());

    const QPainterPath path = iShape-&gt;generateShape(action-&gt;text(), this);
    if (!path.isEmpty())
        paintArea-&gt;insertShape(path);
}
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">insertShape()</span></code> is invoked when the use chooses one of the shapes from the Shapes menu. We retrieve the <a class="reference internal" href="../PySide2/QtWidgets/QAction.html#PySide2.QtWidgets.QAction" title="PySide2.QtWidgets.QAction"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QAction</span></code></a> that invoked the slot, then the <code class="docutils literal"><span class="pre">ShapeInterface</span></code> associated with that <a class="reference internal" href="../PySide2/QtWidgets/QAction.html#PySide2.QtWidgets.QAction" title="PySide2.QtWidgets.QAction"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QAction</span></code></a> , and finally we call <code class="docutils literal"><span class="pre">ShapeInterface::generateShape()</span></code> to obtain a <a class="reference internal" href="../PySide2/QtGui/QPainterPath.html#PySide2.QtGui.QPainterPath" title="PySide2.QtGui.QPainterPath"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtGui.QPainterPath</span></code></a> .</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">MainWindow</span><span class="p">::</span><span class="n">applyFilter</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">QAction</span> <span class="o">*</span><span class="n">action</span> <span class="o">=</span> <span class="n">qobject_cast</span><span class="o">&lt;</span><span class="n">QAction</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">sender</span><span class="p">());</span>
    <span class="n">FilterInterface</span> <span class="o">*</span><span class="n">iFilter</span> <span class="o">=</span>
            <span class="n">qobject_cast</span><span class="o">&lt;</span><span class="n">FilterInterface</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">action</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">());</span>

    <span class="n">const</span> <span class="n">QImage</span> <span class="n">image</span> <span class="o">=</span> <span class="n">iFilter</span><span class="o">-&gt;</span><span class="n">filterImage</span><span class="p">(</span><span class="n">action</span><span class="o">-&gt;</span><span class="n">text</span><span class="p">(),</span> <span class="n">paintArea</span><span class="o">-&gt;</span><span class="n">image</span><span class="p">(),</span>
                                              <span class="n">this</span><span class="p">);</span>
    <span class="n">paintArea</span><span class="o">-&gt;</span><span class="n">setImage</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">applyFilter()</span></code> slot is similar: We retrieve the <a class="reference internal" href="../PySide2/QtWidgets/QAction.html#PySide2.QtWidgets.QAction" title="PySide2.QtWidgets.QAction"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QAction</span></code></a> that invoked the slot, then the <code class="docutils literal"><span class="pre">FilterInterface</span></code> associated to that <a class="reference internal" href="../PySide2/QtWidgets/QAction.html#PySide2.QtWidgets.QAction" title="PySide2.QtWidgets.QAction"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtWidgets.QAction</span></code></a> , and finally we call <code class="docutils literal"><span class="pre">FilterInterface::filterImage()</span></code> to apply the filter onto the current image.</p>
</div></blockquote>
</div>
<div class="section" id="the-paintarea-class">
<span id="id4"></span><h2>The PaintArea Class<a class="headerlink" href="#the-paintarea-class" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The <code class="docutils literal"><span class="pre">PaintArea</span></code> class contains some code that deals with <code class="docutils literal"><span class="pre">BrushInterface</span></code> , so we’ll review it briefly.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">PaintArea</span><span class="p">::</span><span class="n">setBrush</span><span class="p">(</span><span class="n">BrushInterface</span> <span class="o">*</span><span class="n">brushInterface</span><span class="p">,</span> <span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">brush</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">this</span><span class="o">-&gt;</span><span class="n">brushInterface</span> <span class="o">=</span> <span class="n">brushInterface</span><span class="p">;</span>
    <span class="n">this</span><span class="o">-&gt;</span><span class="n">brush</span> <span class="o">=</span> <span class="n">brush</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In <code class="docutils literal"><span class="pre">setBrush()</span></code> , we simply store the <code class="docutils literal"><span class="pre">BrushInterface</span></code> and the brush that are given to us by <code class="docutils literal"><span class="pre">MainWindow</span></code> .</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">PaintArea</span><span class="p">::</span><span class="n">mouseMoveEvent</span><span class="p">(</span><span class="n">QMouseEvent</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">buttons</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">Qt</span><span class="p">::</span><span class="n">LeftButton</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">lastPos</span> <span class="o">!=</span> <span class="n">QPoint</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">brushInterface</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">QPainter</span> <span class="n">painter</span><span class="p">(</span><span class="o">&amp;</span><span class="n">theImage</span><span class="p">);</span>
            <span class="n">setupPainter</span><span class="p">(</span><span class="n">painter</span><span class="p">);</span>
            <span class="n">const</span> <span class="n">QRect</span> <span class="n">rect</span> <span class="o">=</span> <span class="n">brushInterface</span><span class="o">-&gt;</span><span class="n">mouseMove</span><span class="p">(</span><span class="n">brush</span><span class="p">,</span> <span class="n">painter</span><span class="p">,</span> <span class="n">lastPos</span><span class="p">,</span>
                                                         <span class="n">event</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">());</span>
            <span class="n">update</span><span class="p">(</span><span class="n">rect</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">lastPos</span> <span class="o">=</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the <code class="xref py py-func docutils literal"><span class="pre">mouse</span> <span class="pre">move</span> <span class="pre">event</span> <span class="pre">handler</span></code> , we call the <code class="docutils literal"><span class="pre">BrushInterface::mouseMove()</span></code> function on the current <code class="docutils literal"><span class="pre">BrushInterface</span></code> , with the current brush. The mouse press and mouse release handlers are very similar.</p>
</div></blockquote>
</div>
<div class="section" id="the-plugindialog-class">
<span id="id5"></span><h2>The PluginDialog Class<a class="headerlink" href="#the-plugindialog-class" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The <code class="docutils literal"><span class="pre">PluginDialog</span></code> class provides information about the loaded plugins to the user. Its constructor takes a path to the plugins and a list of plugin file names. It calls <code class="docutils literal"><span class="pre">findPlugins()</span></code> to fill the QTreeWdiget with information about the plugins:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">PluginDialog</span><span class="p">::</span><span class="n">findPlugins</span><span class="p">(</span><span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">path</span><span class="p">,</span>
                               <span class="n">const</span> <span class="n">QStringList</span> <span class="o">&amp;</span><span class="n">fileNames</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">label</span><span class="o">-&gt;</span><span class="n">setText</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Plug &amp; Paint found the following plugins</span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;(looked in %1):&quot;</span><span class="p">)</span>
                   <span class="o">.</span><span class="n">arg</span><span class="p">(</span><span class="n">QDir</span><span class="p">::</span><span class="n">toNativeSeparators</span><span class="p">(</span><span class="n">path</span><span class="p">)));</span>

    <span class="n">const</span> <span class="n">QDir</span> <span class="nb">dir</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>

    <span class="n">foreach</span> <span class="p">(</span><span class="n">QObject</span> <span class="o">*</span><span class="n">plugin</span><span class="p">,</span> <span class="n">QPluginLoader</span><span class="p">::</span><span class="n">staticInstances</span><span class="p">())</span>
        <span class="n">populateTreeWidget</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">tr</span><span class="p">(</span><span class="s2">&quot;%1 (Static Plugin)&quot;</span><span class="p">)</span>
                                   <span class="o">.</span><span class="n">arg</span><span class="p">(</span><span class="n">plugin</span><span class="o">-&gt;</span><span class="n">metaObject</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">className</span><span class="p">()));</span>

    <span class="n">foreach</span> <span class="p">(</span><span class="n">QString</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">fileNames</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">QPluginLoader</span> <span class="n">loader</span><span class="p">(</span><span class="nb">dir</span><span class="o">.</span><span class="n">absoluteFilePath</span><span class="p">(</span><span class="n">fileName</span><span class="p">));</span>
        <span class="n">QObject</span> <span class="o">*</span><span class="n">plugin</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">instance</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">plugin</span><span class="p">)</span>
            <span class="n">populateTreeWidget</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">fileName</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">findPlugins()</span></code> is very similar to <code class="docutils literal"><span class="pre">MainWindow::loadPlugins()</span></code> . It uses <a class="reference internal" href="../PySide2/QtCore/QPluginLoader.html#PySide2.QtCore.QPluginLoader" title="PySide2.QtCore.QPluginLoader"><code class="xref py py-class docutils literal"><span class="pre">PySide2.QtCore.QPluginLoader</span></code></a> to access the static and dynamic plugins. Its helper function <code class="docutils literal"><span class="pre">populateTreeWidget()</span></code> uses <code class="xref py py-func docutils literal"><span class="pre">qobject_cast()</span></code> to find out which interfaces are implemented by the plugins:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">PluginDialog</span><span class="p">::</span><span class="n">populateTreeWidget</span><span class="p">(</span><span class="n">QObject</span> <span class="o">*</span><span class="n">plugin</span><span class="p">,</span> <span class="n">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">QTreeWidgetItem</span> <span class="o">*</span><span class="n">pluginItem</span> <span class="o">=</span> <span class="n">new</span> <span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="n">treeWidget</span><span class="p">);</span>
    <span class="n">pluginItem</span><span class="o">-&gt;</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">text</span><span class="p">);</span>
    <span class="n">treeWidget</span><span class="o">-&gt;</span><span class="n">setItemExpanded</span><span class="p">(</span><span class="n">pluginItem</span><span class="p">,</span> <span class="n">true</span><span class="p">);</span>

    <span class="n">QFont</span> <span class="n">boldFont</span> <span class="o">=</span> <span class="n">pluginItem</span><span class="o">-&gt;</span><span class="n">font</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">boldFont</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="n">true</span><span class="p">);</span>
    <span class="n">pluginItem</span><span class="o">-&gt;</span><span class="n">setFont</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">boldFont</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">plugin</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">BrushInterface</span> <span class="o">*</span><span class="n">iBrush</span> <span class="o">=</span> <span class="n">qobject_cast</span><span class="o">&lt;</span><span class="n">BrushInterface</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">plugin</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">iBrush</span><span class="p">)</span>
            <span class="n">addItems</span><span class="p">(</span><span class="n">pluginItem</span><span class="p">,</span> <span class="s2">&quot;BrushInterface&quot;</span><span class="p">,</span> <span class="n">iBrush</span><span class="o">-&gt;</span><span class="n">brushes</span><span class="p">());</span>

        <span class="n">ShapeInterface</span> <span class="o">*</span><span class="n">iShape</span> <span class="o">=</span> <span class="n">qobject_cast</span><span class="o">&lt;</span><span class="n">ShapeInterface</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">plugin</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">iShape</span><span class="p">)</span>
            <span class="n">addItems</span><span class="p">(</span><span class="n">pluginItem</span><span class="p">,</span> <span class="s2">&quot;ShapeInterface&quot;</span><span class="p">,</span> <span class="n">iShape</span><span class="o">-&gt;</span><span class="n">shapes</span><span class="p">());</span>

        <span class="n">FilterInterface</span> <span class="o">*</span><span class="n">iFilter</span> <span class="o">=</span>
                <span class="n">qobject_cast</span><span class="o">&lt;</span><span class="n">FilterInterface</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">plugin</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">iFilter</span><span class="p">)</span>
            <span class="n">addItems</span><span class="p">(</span><span class="n">pluginItem</span><span class="p">,</span> <span class="s2">&quot;FilterInterface&quot;</span><span class="p">,</span> <span class="n">iFilter</span><span class="o">-&gt;</span><span class="n">filters</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="importing-static-plugins">
<span id="id6"></span><h2>Importing Static Plugins<a class="headerlink" href="#importing-static-plugins" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The <a class="reference internal" href="qtwidgets-tools-plugandpaint-plugins-basictools-example.html#plug-paint-basic-tools-example"><span class="std std-ref">Basic Tools</span></a> plugin is built as a static plugin, to ensure that it is always available to the application. This requires using the <code class="xref py py-func docutils literal"><span class="pre">Q_IMPORT_PLUGIN()</span></code> macro somewhere in the application (in a <code class="docutils literal"><span class="pre">.cpp</span></code> file) and specifying the plugin in the <code class="docutils literal"><span class="pre">.pro</span></code> file.</p>
<p>For Plug &amp; Paint, we have chosen to put <code class="xref py py-func docutils literal"><span class="pre">Q_IMPORT_PLUGIN()</span></code> in <code class="docutils literal"><span class="pre">main.cpp</span></code> :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#include &quot;mainwindow.h&quot;</span>
<span class="c1">#include &lt;QtPlugin&gt;</span>
<span class="c1">#include &lt;QApplication&gt;</span>

<span class="n">Q_IMPORT_PLUGIN</span><span class="p">(</span><span class="n">BasicToolsPlugin</span><span class="p">)</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">(</span><span class="nb">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="n">QApplication</span> <span class="n">app</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
    <span class="n">MainWindow</span> <span class="n">window</span><span class="p">;</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">exec</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The argument to <code class="xref py py-func docutils literal"><span class="pre">Q_IMPORT_PLUGIN()</span></code> is the plugin name, which corresponds with the name of the class that declares metadata for the plugin with <code class="xref py py-func docutils literal"><span class="pre">Q_PLUGIN_METADATA()</span></code> .</p>
<p>In the <code class="docutils literal"><span class="pre">.pro</span></code> file, we need to specify the static library. Here’s the project file for building Plug &amp; Paint:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">Code</span> <span class="n">snippet</span> <span class="s2">&quot;tools/plugandpaint/app/app.pro:0&quot;</span> <span class="ow">not</span> <span class="n">found</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">LIBS</span></code> line variable specifies the library <code class="docutils literal"><span class="pre">pnp_basictools</span></code> located in the <code class="docutils literal"><span class="pre">../plugandpaint/plugins/basictools</span></code> directory. (Although the <code class="docutils literal"><span class="pre">LIBS</span></code> syntax has a distinct Unix flavor, <code class="docutils literal"><span class="pre">qmake</span></code> supports it on all platforms.)</p>
<p>The <code class="docutils literal"><span class="pre">CONFIG()</span></code> code at the end is necessary for this example because the example is part of the Qt distribution and Qt can be configured to be built simultaneously in debug and in release modes. You don’t need to for your own plugin applications.</p>
<p>This completes our review of the Plug &amp; Paint application. At this point, you might want to take a look at the <a class="reference internal" href="qtwidgets-tools-plugandpaint-plugins-basictools-example.html#plug-paint-basic-tools-example"><span class="std std-ref">Basic Tools</span></a> example plugin.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="interfaces-h-example-file">
<h1>interfaces.h Example File<a class="headerlink" href="#interfaces-h-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="mainwindow-cpp-example-file">
<h1>mainwindow.cpp Example File<a class="headerlink" href="#mainwindow-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="mainwindow-h-example-file">
<h1>mainwindow.h Example File<a class="headerlink" href="#mainwindow-h-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="paintarea-cpp-example-file">
<h1>paintarea.cpp Example File<a class="headerlink" href="#paintarea-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="paintarea-h-example-file">
<h1>paintarea.h Example File<a class="headerlink" href="#paintarea-h-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="plugindialog-cpp-example-file">
<h1>plugindialog.cpp Example File<a class="headerlink" href="#plugindialog-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="plugindialog-h-example-file">
<h1>plugindialog.h Example File<a class="headerlink" href="#plugindialog-h-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="main-cpp-example-file">
<h1>main.cpp Example File<a class="headerlink" href="#main-cpp-example-file" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="app-pro-example-file">
<h1>app.pro Example File<a class="headerlink" href="#app-pro-example-file" title="Permalink to this headline">¶</a></h1>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <p>© 2018 The Qt Company Ltd. Documentation contributions included herein are the copyrights of their respective owners. The documentation provided herein is licensed under the terms of the <a href="http://www.gnu.org/license/fdl.html">GNU Free Documentation License version 1.3</a> as published by the Free Software Foundation. Qt and respective logos are trademarks of The Qt Company Ltd. in Finland and/or other countries worldwide. All other trademarks are property of their respective owners.</p>
    </div></div>
    <div id="footer" class="footer">
    </div>
</div>
  </body>
</html>